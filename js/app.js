!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var i=n(41);i.install(),n(55),n(51),n(2),n(52),n(54),n(17),n(50);var o=n(8),r=n(15);o.setBackend(r.default),o.fetchUsers()},function(t,e,n){var i,o;!function(r,s,a){function u(){var t=r.L;c.noConflict=function(){return r.L=t,this},r.L=c}var c={version:"1.0.2"};"object"==typeof t&&"object"==typeof t.exports?t.exports=c:(i=c,o="function"==typeof i?i.call(e,n,e,t):i,!(o!==a&&(t.exports=o))),"undefined"!=typeof r&&u(),c.Util={extend:function(t){var e,n,i,o;for(n=1,i=arguments.length;n<i;n++){o=arguments[n];for(e in o)t[e]=o[e]}return t},create:Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}(),bind:function(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var i=n.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(n.call(arguments)):arguments)}},stamp:function(t){return t._leaflet_id=t._leaflet_id||++c.Util.lastId,t._leaflet_id},lastId:0,throttle:function(t,e,n){var i,o,r,s;return s=function(){i=!1,o&&(r.apply(n,o),o=!1)},r=function(){i?o=arguments:(t.apply(n,arguments),setTimeout(s,e),i=!0)}},wrapNum:function(t,e,n){var i=e[1],o=e[0],r=i-o;return t===i&&n?t:((t-o)%r+r)%r+o},falseFn:function(){return!1},formatNum:function(t,e){var n=Math.pow(10,e||5);return Math.round(t*n)/n},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return c.Util.trim(t).split(/\s+/)},setOptions:function(t,e){t.hasOwnProperty("options")||(t.options=t.options?c.Util.create(t.options):{});for(var n in e)t.options[n]=e[n];return t.options},getParamString:function(t,e,n){var i=[];for(var o in t)i.push(encodeURIComponent(n?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&e.indexOf("?")!==-1?"&":"?")+i.join("&")},template:function(t,e){return t.replace(c.Util.templateRe,function(t,n){var i=e[n];if(i===a)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(e)),i})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},indexOf:function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function t(t){return r["webkit"+t]||r["moz"+t]||r["ms"+t]}function e(t){var e=+new Date,i=Math.max(0,16-(e-n));return n=e+i,r.setTimeout(t,i)}var n=0,i=r.requestAnimationFrame||t("RequestAnimationFrame")||e,o=r.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(t){r.clearTimeout(t)};c.Util.requestAnimFrame=function(t,n,o){return o&&i===e?void t.call(n):i.call(r,c.bind(t,n))},c.Util.cancelAnimFrame=function(t){t&&o.call(r,t)}}(),c.extend=c.Util.extend,c.bind=c.Util.bind,c.stamp=c.Util.stamp,c.setOptions=c.Util.setOptions,c.Class=function(){},c.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=e.__super__=this.prototype,i=c.Util.create(n);i.constructor=e,e.prototype=i;for(var o in this)this.hasOwnProperty(o)&&"prototype"!==o&&(e[o]=this[o]);return t.statics&&(c.extend(e,t.statics),delete t.statics),t.includes&&(c.Util.extend.apply(null,[i].concat(t.includes)),delete t.includes),i.options&&(t.options=c.Util.extend(c.Util.create(i.options),t.options)),c.extend(i,t),i._initHooks=[],i.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=i._initHooks.length;t<e;t++)i._initHooks[t].call(this)}},e},c.Class.include=function(t){return c.extend(this.prototype,t),this},c.Class.mergeOptions=function(t){return c.extend(this.prototype.options,t),this},c.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this},c.Evented=c.Class.extend({on:function(t,e,n){if("object"==typeof t)for(var i in t)this._on(i,t[i],e);else{t=c.Util.splitWords(t);for(var o=0,r=t.length;o<r;o++)this._on(t[o],e,n)}return this},off:function(t,e,n){if(t)if("object"==typeof t)for(var i in t)this._off(i,t[i],e);else{t=c.Util.splitWords(t);for(var o=0,r=t.length;o<r;o++)this._off(t[o],e,n)}else delete this._events;return this},_on:function(t,e,n){this._events=this._events||{};var i=this._events[t];i||(i=[],this._events[t]=i),n===this&&(n=a);for(var o={fn:e,ctx:n},r=i,s=0,u=r.length;s<u;s++)if(r[s].fn===e&&r[s].ctx===n)return;r.push(o),i.count++},_off:function(t,e,n){var i,o,r;if(this._events&&(i=this._events[t])){if(!e){for(o=0,r=i.length;o<r;o++)i[o].fn=c.Util.falseFn;return void delete this._events[t]}if(n===this&&(n=a),i)for(o=0,r=i.length;o<r;o++){var s=i[o];if(s.ctx===n&&s.fn===e)return s.fn=c.Util.falseFn,this._firingCount&&(this._events[t]=i=i.slice()),void i.splice(o,1)}}},fire:function(t,e,n){if(!this.listens(t,n))return this;var i=c.Util.extend({},e,{type:t,target:this});if(this._events){var o=this._events[t];if(o){this._firingCount=this._firingCount+1||1;for(var r=0,s=o.length;r<s;r++){var a=o[r];a.fn.call(a.ctx||this,i)}this._firingCount--}}return n&&this._propagateEvent(i),this},listens:function(t,e){var n=this._events&&this._events[t];if(n&&n.length)return!0;if(e)for(var i in this._eventParents)if(this._eventParents[i].listens(t,e))return!0;return!1},once:function(t,e,n){if("object"==typeof t){for(var i in t)this.once(i,t[i],e);return this}var o=c.bind(function(){this.off(t,e,n).off(t,o,n)},this);return this.on(t,e,n).on(t,o,n)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[c.stamp(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[c.stamp(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,c.extend({layer:t.target},t),!0)}});var l=c.Evented.prototype;l.addEventListener=l.on,l.removeEventListener=l.clearAllEventListeners=l.off,l.addOneTimeEventListener=l.once,l.fireEvent=l.fire,l.hasEventListeners=l.listens,c.Mixin={Events:l},function(){var t=navigator.userAgent.toLowerCase(),e=s.documentElement,n="ActiveXObject"in r,i=t.indexOf("webkit")!==-1,o=t.indexOf("phantom")!==-1,a=t.search("android [23]")!==-1,u=t.indexOf("chrome")!==-1,l=t.indexOf("gecko")!==-1&&!i&&!r.opera&&!n,h=0===navigator.platform.indexOf("Win"),d="undefined"!=typeof orientation||t.indexOf("mobile")!==-1,f=!r.PointerEvent&&r.MSPointerEvent,p=r.PointerEvent||f,m=n&&"transition"in e.style,_="WebKitCSSMatrix"in r&&"m11"in new r.WebKitCSSMatrix&&!a,v="MozPerspective"in e.style,g="OTransition"in e.style,y=!r.L_NO_TOUCH&&(p||"ontouchstart"in r||r.DocumentTouch&&s instanceof r.DocumentTouch);c.Browser={ie:n,ielt9:n&&!s.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in s),webkit:i,gecko:l,android:t.indexOf("android")!==-1,android23:a,chrome:u,safari:!u&&t.indexOf("safari")!==-1,win:h,ie3d:m,webkit3d:_,gecko3d:v,opera12:g,any3d:!r.L_DISABLE_3D&&(m||_||v)&&!g&&!o,mobile:d,mobileWebkit:d&&i,mobileWebkit3d:d&&_,mobileOpera:d&&r.opera,mobileGecko:d&&l,touch:!!y,msPointer:!!f,pointer:!!p,retina:(r.devicePixelRatio||r.screen.deviceXDPI/r.screen.logicalXDPI)>1}}(),c.Point=function(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e},c.Point.prototype={clone:function(){return new c.Point(this.x,this.y)},add:function(t){return this.clone()._add(c.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(c.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new c.Point(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new c.Point(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(t){t=c.point(t);var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return t=c.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=c.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+c.Util.formatNum(this.x)+", "+c.Util.formatNum(this.y)+")"}},c.point=function(t,e,n){return t instanceof c.Point?t:c.Util.isArray(t)?new c.Point(t[0],t[1]):t===a||null===t?t:"object"==typeof t&&"x"in t&&"y"in t?new c.Point(t.x,t.y):new c.Point(t,e,n)},c.Bounds=function(t,e){if(t)for(var n=e?[t,e]:t,i=0,o=n.length;i<o;i++)this.extend(n[i])},c.Bounds.prototype={extend:function(t){return t=c.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new c.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new c.Point(this.min.x,this.max.y)},getTopRight:function(){return new c.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return t="number"==typeof t[0]||t instanceof c.Point?c.point(t):c.bounds(t),t instanceof c.Bounds?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=c.bounds(t);var e=this.min,n=this.max,i=t.min,o=t.max,r=o.x>=e.x&&i.x<=n.x,s=o.y>=e.y&&i.y<=n.y;return r&&s},overlaps:function(t){t=c.bounds(t);var e=this.min,n=this.max,i=t.min,o=t.max,r=o.x>e.x&&i.x<n.x,s=o.y>e.y&&i.y<n.y;return r&&s},isValid:function(){return!(!this.min||!this.max)}},c.bounds=function(t,e){return!t||t instanceof c.Bounds?t:new c.Bounds(t,e)},c.Transformation=function(t,e,n,i){this._a=t,this._b=e,this._c=n,this._d=i},c.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new c.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},c.DomUtil={get:function(t){return"string"==typeof t?s.getElementById(t):t},getStyle:function(t,e){var n=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!n||"auto"===n)&&s.defaultView){var i=s.defaultView.getComputedStyle(t,null);n=i?i[e]:null}return"auto"===n?null:n},create:function(t,e,n){var i=s.createElement(t);return i.className=e||"",n&&n.appendChild(i),i},remove:function(t){var e=t.parentNode;e&&e.removeChild(t)},empty:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},toFront:function(t){t.parentNode.appendChild(t)},toBack:function(t){var e=t.parentNode;e.insertBefore(t,e.firstChild)},hasClass:function(t,e){if(t.classList!==a)return t.classList.contains(e);var n=c.DomUtil.getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==a)for(var n=c.Util.splitWords(e),i=0,o=n.length;i<o;i++)t.classList.add(n[i]);else if(!c.DomUtil.hasClass(t,e)){var r=c.DomUtil.getClass(t);c.DomUtil.setClass(t,(r?r+" ":"")+e)}},removeClass:function(t,e){t.classList!==a?t.classList.remove(e):c.DomUtil.setClass(t,c.Util.trim((" "+c.DomUtil.getClass(t)+" ").replace(" "+e+" "," ")))},setClass:function(t,e){t.className.baseVal===a?t.className=e:t.className.baseVal=e},getClass:function(t){return t.className.baseVal===a?t.className:t.className.baseVal},setOpacity:function(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&c.DomUtil._setOpacityIE(t,e)},_setOpacityIE:function(t,e){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=t.filters.item(i)}catch(t){if(1===e)return}e=Math.round(100*e),n?(n.Enabled=100!==e,n.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"},testProp:function(t){for(var e=s.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1},setTransform:function(t,e,n){var i=e||new c.Point(0,0);t.style[c.DomUtil.TRANSFORM]=(c.Browser.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")},setPosition:function(t,e){t._leaflet_pos=e,c.Browser.any3d?c.DomUtil.setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos||new c.Point(0,0)}},function(){c.DomUtil.TRANSFORM=c.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var t=c.DomUtil.TRANSITION=c.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);if(c.DomUtil.TRANSITION_END="webkitTransition"===t||"OTransition"===t?t+"End":"transitionend","onselectstart"in s)c.DomUtil.disableTextSelection=function(){c.DomEvent.on(r,"selectstart",c.DomEvent.preventDefault)},c.DomUtil.enableTextSelection=function(){c.DomEvent.off(r,"selectstart",c.DomEvent.preventDefault)};else{var e=c.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);c.DomUtil.disableTextSelection=function(){if(e){var t=s.documentElement.style;this._userSelect=t[e],t[e]="none"}},c.DomUtil.enableTextSelection=function(){e&&(s.documentElement.style[e]=this._userSelect,delete this._userSelect)}}c.DomUtil.disableImageDrag=function(){c.DomEvent.on(r,"dragstart",c.DomEvent.preventDefault)},c.DomUtil.enableImageDrag=function(){c.DomEvent.off(r,"dragstart",c.DomEvent.preventDefault)},c.DomUtil.preventOutline=function(t){for(;t.tabIndex===-1;)t=t.parentNode;t&&t.style&&(c.DomUtil.restoreOutline(),this._outlineElement=t,this._outlineStyle=t.style.outline,t.style.outline="none",c.DomEvent.on(r,"keydown",c.DomUtil.restoreOutline,this))},c.DomUtil.restoreOutline=function(){this._outlineElement&&(this._outlineElement.style.outline=this._outlineStyle,delete this._outlineElement,delete this._outlineStyle,c.DomEvent.off(r,"keydown",c.DomUtil.restoreOutline,this))}}(),c.LatLng=function(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,n!==a&&(this.alt=+n)},c.LatLng.prototype={equals:function(t,e){if(!t)return!1;t=c.latLng(t);var n=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return n<=(e===a?1e-9:e)},toString:function(t){return"LatLng("+c.Util.formatNum(this.lat,t)+", "+c.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){return c.CRS.Earth.distance(this,c.latLng(t))},wrap:function(){return c.CRS.Earth.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return c.latLngBounds([this.lat-e,this.lng-n],[this.lat+e,this.lng+n])},clone:function(){return new c.LatLng(this.lat,this.lng,this.alt)}},c.latLng=function(t,e,n){return t instanceof c.LatLng?t:c.Util.isArray(t)&&"object"!=typeof t[0]?3===t.length?new c.LatLng(t[0],t[1],t[2]):2===t.length?new c.LatLng(t[0],t[1]):null:t===a||null===t?t:"object"==typeof t&&"lat"in t?new c.LatLng(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===a?null:new c.LatLng(t,e,n)},c.LatLngBounds=function(t,e){if(t)for(var n=e?[t,e]:t,i=0,o=n.length;i<o;i++)this.extend(n[i])},c.LatLngBounds.prototype={extend:function(t){var e,n,i=this._southWest,o=this._northEast;if(t instanceof c.LatLng)e=t,n=t;else{if(!(t instanceof c.LatLngBounds))return t?this.extend(c.latLng(t)||c.latLngBounds(t)):this;if(e=t._southWest,n=t._northEast,!e||!n)return this}return i||o?(i.lat=Math.min(e.lat,i.lat),i.lng=Math.min(e.lng,i.lng),o.lat=Math.max(n.lat,o.lat),o.lng=Math.max(n.lng,o.lng)):(this._southWest=new c.LatLng(e.lat,e.lng),this._northEast=new c.LatLng(n.lat,n.lng)),this},pad:function(t){var e=this._southWest,n=this._northEast,i=Math.abs(e.lat-n.lat)*t,o=Math.abs(e.lng-n.lng)*t;return new c.LatLngBounds(new c.LatLng(e.lat-i,e.lng-o),new c.LatLng(n.lat+i,n.lng+o))},getCenter:function(){return new c.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new c.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new c.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof c.LatLng?c.latLng(t):c.latLngBounds(t);var e,n,i=this._southWest,o=this._northEast;return t instanceof c.LatLngBounds?(e=t.getSouthWest(),n=t.getNorthEast()):e=n=t,e.lat>=i.lat&&n.lat<=o.lat&&e.lng>=i.lng&&n.lng<=o.lng},intersects:function(t){t=c.latLngBounds(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),o=t.getNorthEast(),r=o.lat>=e.lat&&i.lat<=n.lat,s=o.lng>=e.lng&&i.lng<=n.lng;return r&&s},overlaps:function(t){t=c.latLngBounds(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),o=t.getNorthEast(),r=o.lat>e.lat&&i.lat<n.lat,s=o.lng>e.lng&&i.lng<n.lng;return r&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return!!t&&(t=c.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast()))},isValid:function(){return!(!this._southWest||!this._northEast)}},c.latLngBounds=function(t,e){return t instanceof c.LatLngBounds?t:new c.LatLngBounds(t,e)},c.Projection={},c.Projection.LonLat={project:function(t){return new c.Point(t.lng,t.lat)},unproject:function(t){return new c.LatLng(t.y,t.x)},bounds:c.bounds([-180,-90],[180,90])},c.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,t.lat),-n),o=Math.sin(i*e);return new c.Point(this.R*t.lng*e,this.R*Math.log((1+o)/(1-o))/2)},unproject:function(t){var e=180/Math.PI;return new c.LatLng((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return c.bounds([-t,-t],[t,t])}()},c.CRS={latLngToPoint:function(t,e){var n=this.projection.project(t),i=this.scale(e);return this.transformation._transform(n,i)},pointToLatLng:function(t,e){var n=this.scale(e),i=this.transformation.untransform(t,n);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,n=this.scale(t),i=this.transformation.transform(e.min,n),o=this.transformation.transform(e.max,n);return c.bounds(i,o)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?c.Util.wrapNum(t.lng,this.wrapLng,!0):t.lng,n=this.wrapLat?c.Util.wrapNum(t.lat,this.wrapLat,!0):t.lat,i=t.alt;return c.latLng(n,e,i)}},c.CRS.Simple=c.extend({},c.CRS,{projection:c.Projection.LonLat,transformation:new c.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(n*n+i*i)},infinite:!0}),c.CRS.Earth=c.extend({},c.CRS,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,i=t.lat*n,o=e.lat*n,r=Math.sin(i)*Math.sin(o)+Math.cos(i)*Math.cos(o)*Math.cos((e.lng-t.lng)*n);return this.R*Math.acos(Math.min(r,1))}}),c.CRS.EPSG3857=c.extend({},c.CRS.Earth,{code:"EPSG:3857",projection:c.Projection.SphericalMercator,transformation:function(){var t=.5/(Math.PI*c.Projection.SphericalMercator.R);return new c.Transformation(t,.5,-t,.5)}()}),c.CRS.EPSG900913=c.extend({},c.CRS.EPSG3857,{code:"EPSG:900913"}),c.CRS.EPSG4326=c.extend({},c.CRS.Earth,{code:"EPSG:4326",projection:c.Projection.LonLat,transformation:new c.Transformation(1/180,1,-1/180,.5)}),c.Map=c.Evented.extend({options:{crs:c.CRS.EPSG3857,center:a,zoom:a,minZoom:a,maxZoom:a,layers:[],maxBounds:a,renderer:a,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=c.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=c.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.zoom!==a&&(this._zoom=this._limitZoom(e.zoom)),e.center&&e.zoom!==a&&this.setView(c.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._zoomAnimated=c.DomUtil.TRANSITION&&c.Browser.any3d&&!c.Browser.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),c.DomEvent.on(this._proxy,c.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,n){if(e=e===a?this._zoom:this._limitZoom(e),t=this._limitCenter(c.latLng(t),e,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==a&&(n.zoom=c.extend({animate:n.animate},n.zoom),n.pan=c.extend({animate:n.animate,duration:n.duration},n.pan));var i=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(i)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(c.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(c.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,n){var i=this.getZoomScale(e),o=this.getSize().divideBy(2),r=t instanceof c.Point?t:this.latLngToContainerPoint(t),s=r.subtract(o).multiplyBy(1-1/i),a=this.containerPointToLatLng(o.add(s));return this.setView(a,e,{zoom:n})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():c.latLngBounds(t);var n=c.point(e.paddingTopLeft||e.padding||[0,0]),i=c.point(e.paddingBottomRight||e.padding||[0,0]),o=this.getBoundsZoom(t,!1,n.add(i));o="number"==typeof e.maxZoom?Math.min(e.maxZoom,o):o;var r=i.subtract(n).divideBy(2),s=this.project(t.getSouthWest(),o),a=this.project(t.getNorthEast(),o),u=this.unproject(s.add(a).divideBy(2).add(r),o);return{center:u,zoom:o}},fitBounds:function(t,e){if(t=c.latLngBounds(t),!t.isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(t,e);return this.setView(n.center,n.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=c.point(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new c.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){c.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){function i(t){var e=t?-1:1,n=t?g:v,i=g*g-v*v+e*w*w*y*y,o=2*n*w*y,r=i/o,s=Math.sqrt(r*r+1)-r,a=s<1e-9?-18:Math.log(s);return a}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function r(t){return(Math.exp(t)+Math.exp(-t))/2}function s(t){return o(t)/r(t)}function u(t){return v*(r(L)/r(L+b*t))}function l(t){return v*(r(L)*s(L+b*t)-o(L))/w}function h(t){return 1-Math.pow(1-t,1.5)}function d(){var n=(Date.now()-x)/C,i=h(n)*E;n<=1?(this._flyToFrame=c.Util.requestAnimFrame(d,this),this._move(this.unproject(f.add(p.subtract(f).multiplyBy(l(i)/y)),_),this.getScaleZoom(v/u(i),_),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}if(n=n||{},n.animate===!1||!c.Browser.any3d)return this.setView(t,e,n);this._stop();var f=this.project(this.getCenter()),p=this.project(t),m=this.getSize(),_=this._zoom;t=c.latLng(t),e=e===a?_:e;var v=Math.max(m.x,m.y),g=v*this.getZoomScale(_,e),y=p.distanceTo(f)||1,b=1.42,w=b*b,L=i(0),x=Date.now(),E=(i(1)-L)/b,C=n.duration?1e3*n.duration:1e3*E*.8;return this._moveStart(!0),d.call(this),this},flyToBounds:function(t,e){var n=this._getBoundsCenterZoom(t,e);return this.flyTo(n.center,n.zoom,e)},setMaxBounds:function(t){return t=c.latLngBounds(t),t.isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){return this.options.minZoom=t,this._loaded&&this.getZoom()<this.options.minZoom?this.setZoom(t):this},setMaxZoom:function(t){return this.options.maxZoom=t,this._loaded&&this.getZoom()>this.options.maxZoom?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var n=this.getCenter(),i=this._limitCenter(n,this._zoom,c.latLngBounds(t));return n.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this},invalidateSize:function(t){if(!this._loaded)return this;t=c.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var n=this.getSize(),i=e.divideBy(2).round(),o=n.divideBy(2).round(),r=i.subtract(o);return r.x||r.y?(t.animate&&t.pan?this.panBy(r):(t.pan&&this._rawPanBy(r),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(c.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:n})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=c.extend({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=c.bind(this._handleGeolocationResponse,this),n=c.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,n,t):navigator.geolocation.getCurrentPosition(e,n,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,n=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,n=t.coords.longitude,i=new c.LatLng(e,n),o=i.toBounds(t.coords.accuracy),r=this._locateOptions;if(r.setView){var s=this.getBoundsZoom(o);this.setView(i,r.maxZoom?Math.min(s,r.maxZoom):s)}var a={latlng:i,bounds:o,timestamp:t.timestamp};for(var u in t.coords)"number"==typeof t.coords[u]&&(a[u]=t.coords[u]);this.fire("locationfound",a)},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=a,this._containerId=a}c.DomUtil.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload");for(var t in this._layers)this._layers[t].remove();return this},createPane:function(t,e){var n="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),i=c.DomUtil.create("div",n,e||this._mapPane);return t&&(this._panes[t]=i),i},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),n=this.unproject(t.getTopRight());return new c.LatLngBounds(e,n)},getMinZoom:function(){return this.options.minZoom===a?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===a?this._layersMaxZoom===a?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=c.latLngBounds(t),n=c.point(n||[0,0]);var i=this.getZoom()||0,o=this.getMinZoom(),r=this.getMaxZoom(),s=t.getNorthWest(),a=t.getSouthEast(),u=this.getSize().subtract(n),l=this.project(a,i).subtract(this.project(s,i)),h=c.Browser.any3d?this.options.zoomSnap:1,d=Math.min(u.x/l.x,u.y/l.y);return i=this.getScaleZoom(d,i),h&&(i=Math.round(i/(h/100))*(h/100),i=e?Math.ceil(i/h)*h:Math.floor(i/h)*h),Math.max(o,Math.min(r,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new c.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var n=this._getTopLeftPoint(t,e);return new c.Bounds(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===a?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=e===a?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=e===a?this._zoom:e;var i=n.zoom(t*n.scale(e));return isNaN(i)?1/0:i},project:function(t,e){return e=e===a?this._zoom:e,this.options.crs.latLngToPoint(c.latLng(t),e)},unproject:function(t,e){return e=e===a?this._zoom:e,this.options.crs.pointToLatLng(c.point(t),e)},layerPointToLatLng:function(t){var e=c.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(c.latLng(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(c.latLng(t))},distance:function(t,e){return this.options.crs.distance(c.latLng(t),c.latLng(e))},containerPointToLayerPoint:function(t){return c.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return c.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(c.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(c.latLng(t)))},mouseEventToContainerPoint:function(t){return c.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=c.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");c.DomEvent.addListener(e,"scroll",this._onScroll,this),this._containerId=c.Util.stamp(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&c.Browser.any3d,
c.DomUtil.addClass(t,"leaflet-container"+(c.Browser.touch?" leaflet-touch":"")+(c.Browser.retina?" leaflet-retina":"")+(c.Browser.ielt9?" leaflet-oldie":"")+(c.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=c.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),c.DomUtil.setPosition(this._mapPane,new c.Point(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(c.DomUtil.addClass(t.markerPane,"leaflet-zoom-hide"),c.DomUtil.addClass(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){c.DomUtil.setPosition(this._mapPane,new c.Point(0,0));var n=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var i=this._zoom!==e;this._moveStart(i)._move(t,e)._moveEnd(i),this.fire("viewreset"),n&&this.fire("load")},_moveStart:function(t){return t&&this.fire("zoomstart"),this.fire("movestart")},_move:function(t,e,n){e===a&&(e=this._zoom);var i=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(i||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return c.Util.cancelAnimFrame(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){c.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){if(c.DomEvent){this._targets={},this._targets[c.stamp(this._container)]=this;var e=t?"off":"on";c.DomEvent[e](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&c.DomEvent[e](r,"resize",this._onResize,this),c.Browser.any3d&&this.options.transform3DLimit&&this[e]("moveend",this._onMoveEnd)}},_onResize:function(){c.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=c.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var n,i=[],o="mouseout"===e||"mouseover"===e,r=t.target||t.srcElement,s=!1;r;){if(n=this._targets[c.stamp(r)],n&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(n)){s=!0;break}if(n&&n.listens(e,!0)){if(o&&!c.DomEvent._isExternalTarget(r,t))break;if(i.push(n),o)break}if(r===this._container)break;r=r.parentNode}return i.length||s||o||!c.DomEvent._isExternalTarget(r,t)||(i=[this]),i},_handleDOMEvent:function(t){if(this._loaded&&!c.DomEvent._skipped(t)){var e="keypress"===t.type&&13===t.keyCode?"click":t.type;"mousedown"===e&&c.DomUtil.preventOutline(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_fireDOMEvent:function(t,e,n){if("click"===t.type){var i=c.Util.extend({},t);i.type="preclick",this._fireDOMEvent(i,i.type,n)}if(!t._stopped&&(n=(n||[]).concat(this._findEventTargets(t,e)),n.length)){var o=n[0];"contextmenu"===e&&o.listens(e,!0)&&c.DomEvent.preventDefault(t);var r={originalEvent:t};if("keypress"!==t.type){var s=o instanceof c.Marker;r.containerPoint=s?this.latLngToContainerPoint(o.getLatLng()):this.mouseEventToContainerPoint(t),r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.latlng=s?o.getLatLng():this.layerPointToLatLng(r.layerPoint)}for(var a=0;a<n.length;a++)if(n[a].fire(e,r,!0),r.originalEvent._stopped||n[a].options.nonBubblingEvents&&c.Util.indexOf(n[a].options.nonBubblingEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return c.DomUtil.getPosition(this._mapPane)||new c.Point(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var n=t&&e!==a?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return n.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,n){var i=this._getNewPixelOrigin(n,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,n){var i=this._getNewPixelOrigin(n,e);return c.bounds([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var i=this.project(t,e),o=this.getSize().divideBy(2),r=new c.Bounds(i.subtract(o),i.add(o)),s=this._getBoundsOffset(r,n,e);return s.round().equals([0,0])?t:this.unproject(i.add(s),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),i=new c.Bounds(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,n){var i=c.bounds(this.project(e.getNorthEast(),n),this.project(e.getSouthWest(),n)),o=i.min.subtract(t.min),r=i.max.subtract(t.max),s=this._rebound(o.x,-r.x),a=this._rebound(o.y,-r.y);return new c.Point(s,a)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom(),i=c.Browser.any3d?this.options.zoomSnap:1;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(n,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){c.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._floor();return!((e&&e.animate)!==!0&&!this.getSize().contains(n))&&(this.panBy(n,e),!0)},_createAnimProxy:function(){var t=this._proxy=c.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var n=c.DomUtil.TRANSFORM,i=t.style[n];c.DomUtil.setTransform(t,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),i===t.style[n]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var e=this.getCenter(),n=this.getZoom();c.DomUtil.setTransform(t,this.project(e,n),this.getZoomScale(n,1))},this)},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||n.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/i);return!(n.animate!==!0&&!this.getSize().contains(o))&&(c.Util.requestAnimFrame(function(){this._moveStart(!0)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,n,i){n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,c.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:i}),setTimeout(c.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){this._animatingZoom&&(c.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),c.Util.requestAnimFrame(function(){this._moveEnd(!0)},this))}}),c.map=function(t,e){return new c.Map(t,e)},c.Layer=c.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[],attribution:null},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[c.stamp(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[c.stamp(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var n=this.getEvents();e.on(n,this),this.once("remove",function(){e.off(n,this)},this)}this.onAdd(e),this.getAttribution&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}}),c.Map.include({addLayer:function(t){var e=c.stamp(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=c.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&c.stamp(t)in this._layers},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},_addLayers:function(t){t=t?c.Util.isArray(t)?t:[t]:[];for(var e=0,n=t.length;e<n;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[c.stamp(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=c.stamp(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-(1/0),n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var o=this._zoomBoundLayers[i].options;t=o.minZoom===a?t:Math.min(t,o.minZoom),e=o.maxZoom===a?e:Math.max(e,o.maxZoom)}this._layersMaxZoom=e===-(1/0)?a:e,this._layersMinZoom=t===1/0?a:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===a&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===a&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var h="_leaflet_events";c.DomEvent={on:function(t,e,n,i){if("object"==typeof e)for(var o in e)this._on(t,o,e[o],n);else{e=c.Util.splitWords(e);for(var r=0,s=e.length;r<s;r++)this._on(t,e[r],n,i)}return this},off:function(t,e,n,i){if("object"==typeof e)for(var o in e)this._off(t,o,e[o],n);else{e=c.Util.splitWords(e);for(var r=0,s=e.length;r<s;r++)this._off(t,e[r],n,i)}return this},_on:function(t,e,n,i){var o=e+c.stamp(n)+(i?"_"+c.stamp(i):"");if(t[h]&&t[h][o])return this;var s=function(e){return n.call(i||t,e||r.event)},a=s;return c.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,s,o):c.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener?this.addDoubleTapListener(t,s,o):"addEventListener"in t?"mousewheel"===e?t.addEventListener("onwheel"in t?"wheel":"mousewheel",s,!1):"mouseenter"===e||"mouseleave"===e?(s=function(e){e=e||r.event,c.DomEvent._isExternalTarget(t,e)&&a(e)},t.addEventListener("mouseenter"===e?"mouseover":"mouseout",s,!1)):("click"===e&&c.Browser.android&&(s=function(t){return c.DomEvent._filterClick(t,a)}),t.addEventListener(e,s,!1)):"attachEvent"in t&&t.attachEvent("on"+e,s),t[h]=t[h]||{},t[h][o]=s,this},_off:function(t,e,n,i){var o=e+c.stamp(n)+(i?"_"+c.stamp(i):""),r=t[h]&&t[h][o];return r?(c.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,o):c.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,o):"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",r,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,r,!1):"detachEvent"in t&&t.detachEvent("on"+e,r),t[h][o]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,c.DomEvent._skipped(t),this},disableScrollPropagation:function(t){return c.DomEvent.on(t,"mousewheel",c.DomEvent.stopPropagation)},disableClickPropagation:function(t){var e=c.DomEvent.stopPropagation;return c.DomEvent.on(t,c.Draggable.START.join(" "),e),c.DomEvent.on(t,{click:c.DomEvent._fakeStop,dblclick:e})},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return c.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new c.Point(t.clientX,t.clientY);var n=e.getBoundingClientRect();return new c.Point(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},_wheelPxFactor:c.Browser.win&&c.Browser.chrome?2:c.Browser.gecko?r.devicePixelRatio:1,getWheelDelta:function(t){return c.Browser.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/c.DomEvent._wheelPxFactor:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0},_skipEvents:{},_fakeStop:function(t){c.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_isExternalTarget:function(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(t){return!1}return n!==t},_filterClick:function(t,e){var n=t.timeStamp||t.originalEvent&&t.originalEvent.timeStamp,i=c.DomEvent._lastClick&&n-c.DomEvent._lastClick;return i&&i>100&&i<500||t.target._simulatedClick&&!t._simulated?void c.DomEvent.stop(t):(c.DomEvent._lastClick=n,void e(t))}},c.DomEvent.addListener=c.DomEvent.on,c.DomEvent.removeListener=c.DomEvent.off,c.PosAnimation=c.Evented.extend({run:function(t,e,n,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=c.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=c.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,n=1e3*this._duration;e<n?this._runFrame(this._easeOut(e/n),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var n=this._startPos.add(this._offset.multiplyBy(t));e&&n._round(),c.DomUtil.setPosition(this._el,n),this.fire("step")},_complete:function(){c.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),c.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:c.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,n=this.R,i=t.lat*e,o=this.R_MINOR/n,r=Math.sqrt(1-o*o),s=r*Math.sin(i),a=Math.tan(Math.PI/4-i/2)/Math.pow((1-s)/(1+s),r/2);return i=-n*Math.log(Math.max(a,1e-10)),new c.Point(t.lng*e*n,i)},unproject:function(t){for(var e,n=180/Math.PI,i=this.R,o=this.R_MINOR/i,r=Math.sqrt(1-o*o),s=Math.exp(-t.y/i),a=Math.PI/2-2*Math.atan(s),u=0,l=.1;u<15&&Math.abs(l)>1e-7;u++)e=r*Math.sin(a),e=Math.pow((1-e)/(1+e),r/2),l=Math.PI/2-2*Math.atan(s*e)-a,a+=l;return new c.LatLng(a*n,t.x*n/i)}},c.CRS.EPSG3395=c.extend({},c.CRS.Earth,{code:"EPSG:3395",projection:c.Projection.Mercator,transformation:function(){var t=.5/(Math.PI*c.Projection.Mercator.R);return new c.Transformation(t,.5,-t,.5)}()}),c.GridLayer=c.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:c.Browser.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:a,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){c.setOptions(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),c.DomUtil.remove(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=null},bringToFront:function(){return this._map&&(c.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(c.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return s.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof c.Point?t:new c.Point(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==a&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,n=this.getPane().children,i=-t(-(1/0),1/0),o=0,r=n.length;o<r;o++)e=n[o].style.zIndex,n[o]!==this._container&&e&&(i=t(i,+e));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!c.Browser.ielt9){c.DomUtil.setOpacity(this._container,this.options.opacity);var t=+new Date,e=!1,n=!1;for(var i in this._tiles){var o=this._tiles[i];if(o.current&&o.loaded){var r=Math.min(1,(t-o.loaded)/200);c.DomUtil.setOpacity(o.el,r),r<1?e=!0:(o.active&&(n=!0),o.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),e&&(c.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=c.Util.requestAnimFrame(this._updateOpacity,this))}},_initContainer:function(){this._container||(this._container=c.DomUtil.create("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t===a)return a;for(var n in this._levels)this._levels[n].el.children.length||n===t?this._levels[n].el.style.zIndex=e-Math.abs(t-n):(c.DomUtil.remove(this._levels[n].el),this._removeTilesAtZoom(n),delete this._levels[n]);var i=this._levels[t],o=this._map;return i||(i=this._levels[t]={},i.el=c.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=e,i.origin=o.project(o.unproject(o.getPixelOrigin()),t).round(),i.zoom=t,this._setZoomTransform(i,o.getCenter(),o.getZoom()),c.Util.falseFn(i.el.offsetWidth)),this._level=i,i},_pruneTiles:function(){if(this._map){var t,e,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)return void this._removeAllTiles();for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)c.DomUtil.remove(this._levels[t].el),delete this._levels[t];this._removeAllTiles(),this._tileZoom=null},_retainParent:function(t,e,n,i){var o=Math.floor(t/2),r=Math.floor(e/2),s=n-1,a=new c.Point(+o,+r);a.z=+s;var u=this._tileCoordsToKey(a),l=this._tiles[u];return l&&l.active?(l.retain=!0,!0):(l&&l.loaded&&(l.retain=!0),s>i&&this._retainParent(o,r,s,i))},_retainChildren:function(t,e,n,i){for(var o=2*t;o<2*t+2;o++)for(var r=2*e;r<2*e+2;r++){var s=new c.Point(o,r);s.z=n+1;var a=this._tileCoordsToKey(s),u=this._tiles[a];u&&u.active?u.retain=!0:(u&&u.loaded&&(u.retain=!0),n+1<i&&this._retainChildren(o,r,n+1,i))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_setView:function(t,e,n,i){var o=Math.round(e);(this.options.maxZoom!==a&&o>this.options.maxZoom||this.options.minZoom!==a&&o<this.options.minZoom)&&(o=a);var r=this.options.updateWhenZooming&&o!==this._tileZoom;i&&!r||(this._tileZoom=o,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),o!==a&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var n in this._levels)this._setZoomTransform(this._levels[n],t,e)},_setZoomTransform:function(t,e,n){var i=this._map.getZoomScale(n,t.zoom),o=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,n)).round();c.Browser.any3d?c.DomUtil.setTransform(t.el,o,i):c.DomUtil.setPosition(t.el,o)},_resetGrid:function(){var t=this._map,e=t.options.crs,n=this._tileSize=this.getTileSize(),i=this._tileZoom,o=this._map.getPixelWorldBounds(this._tileZoom);o&&(this._globalTileRange=this._pxBoundsToTileRange(o)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/n.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/n.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/n.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,n=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(n,this._tileZoom),o=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*i);return new c.Bounds(o.subtract(r),o.add(r))},_update:function(t){var e=this._map;if(e){var n=e.getZoom();if(t===a&&(t=e.getCenter()),this._tileZoom!==a){var i=this._getTiledPixelBounds(t),o=this._pxBoundsToTileRange(i),r=o.getCenter(),u=[],l=this.options.keepBuffer,h=new c.Bounds(o.getBottomLeft().subtract([l,-l]),o.getTopRight().add([l,-l]));for(var d in this._tiles){var f=this._tiles[d].coords;f.z===this._tileZoom&&h.contains(c.point(f.x,f.y))||(this._tiles[d].current=!1)}if(Math.abs(n-this._tileZoom)>1)return void this._setView(t,n);for(var p=o.min.y;p<=o.max.y;p++)for(var m=o.min.x;m<=o.max.x;m++){var _=new c.Point(m,p);if(_.z=this._tileZoom,this._isValidTile(_)){var v=this._tiles[this._tileCoordsToKey(_)];v?v.current=!0:u.push(_)}}if(u.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)}),0!==u.length){this._loading||(this._loading=!0,this.fire("loading"));var g=s.createDocumentFragment();for(m=0;m<u.length;m++)this._addTile(u[m],g);this._level.el.appendChild(g)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var n=this._globalTileRange;if(!e.wrapLng&&(t.x<n.min.x||t.x>n.max.x)||!e.wrapLat&&(t.y<n.min.y||t.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(t);return c.latLngBounds(this.options.bounds).overlaps(i)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToBounds:function(t){var e=this._map,n=this.getTileSize(),i=t.scaleBy(n),o=i.add(n),r=e.unproject(i,t.z),s=e.unproject(o,t.z);return this.options.noWrap||(r=e.wrapLatLng(r),s=e.wrapLatLng(s)),new c.LatLngBounds(r,s)},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),n=new c.Point(+e[0],+e[1]);return n.z=+e[2],n},_removeTile:function(t){var e=this._tiles[t];e&&(c.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){c.DomUtil.addClass(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=c.Util.falseFn,t.onmousemove=c.Util.falseFn,c.Browser.ielt9&&this.options.opacity<1&&c.DomUtil.setOpacity(t,this.options.opacity),c.Browser.android&&!c.Browser.android23&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var n=this._getTilePos(t),i=this._tileCoordsToKey(t),o=this.createTile(this._wrapCoords(t),c.bind(this._tileReady,this,t));this._initTile(o),this.createTile.length<2&&c.Util.requestAnimFrame(c.bind(this._tileReady,this,t,null,o)),c.DomUtil.setPosition(o,n),this._tiles[i]={el:o,coords:t,current:!0},e.appendChild(o),this.fire("tileloadstart",{tile:o,coords:t})},_tileReady:function(t,e,n){if(this._map){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var i=this._tileCoordsToKey(t);n=this._tiles[i],n&&(n.loaded=+new Date,this._map._fadeAnimated?(c.DomUtil.setOpacity(n.el,0),c.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=c.Util.requestAnimFrame(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(c.DomUtil.addClass(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),c.Browser.ielt9||!this._map._fadeAnimated?c.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(c.bind(this._pruneTiles,this),250)))}},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new c.Point(this._wrapX?c.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?c.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new c.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),c.gridLayer=function(t){return new c.GridLayer(t)},c.TileLayer=c.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,minNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,e=c.setOptions(this,e),e.detectRetina&&c.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),c.Browser.android||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=s.createElement("img");return c.DomEvent.on(n,"load",c.bind(this._tileOnLoad,this,e,n)),c.DomEvent.on(n,"error",c.bind(this._tileOnError,this,e,n)),this.options.crossOrigin&&(n.crossOrigin=""),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:c.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var n=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=n),e["-y"]=n}return c.Util.template(this._url,c.extend(e,this.options))},_tileOnLoad:function(t,e){c.Browser.ielt9?setTimeout(c.bind(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,n){var i=this.options.errorTileUrl;i&&(e.src=i),t(n,e)},getTileSize:function(){var t=this._map,e=c.GridLayer.prototype.getTileSize.call(this),n=this._tileZoom+this.options.zoomOffset,i=this.options.minNativeZoom,o=this.options.maxNativeZoom;return null!==i&&n<i?e.divideBy(t.getZoomScale(i,n)).round():null!==o&&n>o?e.divideBy(t.getZoomScale(o,n)).round():e},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,n=this.options.zoomReverse,i=this.options.zoomOffset,o=this.options.minNativeZoom,r=this.options.maxNativeZoom;return n&&(t=e-t),t+=i,null!==o&&t<o?o:null!==r&&t>r?r:t},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=c.Util.falseFn,e.onerror=c.Util.falseFn,e.complete||(e.src=c.Util.emptyImageUrl,c.DomUtil.remove(e)))}}),c.tileLayer=function(t,e){return new c.TileLayer(t,e)},c.TileLayer.WMS=c.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var n=c.extend({},this.defaultWmsParams);for(var i in e)i in this.options||(n[i]=e[i]);e=c.setOptions(this,e),n.width=n.height=e.tileSize*(e.detectRetina&&c.Browser.retina?2:1),this.wmsParams=n},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,c.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToBounds(t),n=this._crs.project(e.getNorthWest()),i=this._crs.project(e.getSouthEast()),o=(this._wmsVersion>=1.3&&this._crs===c.CRS.EPSG4326?[i.y,n.x,n.y,i.x]:[n.x,i.y,i.x,n.y]).join(","),r=c.TileLayer.prototype.getTileUrl.call(this,t);return r+c.Util.getParamString(this.wmsParams,r,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+o},setParams:function(t,e){return c.extend(this.wmsParams,t),e||this.redraw(),this}}),c.tileLayer.wms=function(t,e){return new c.TileLayer.WMS(t,e)},c.ImageOverlay=c.Layer.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1},initialize:function(t,e,n){this._url=t,this._bounds=c.latLngBounds(e),c.setOptions(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(c.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){c.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&c.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&c.DomUtil.toBack(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=t,this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._image=c.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));t.onselectstart=c.Util.falseFn,t.onmousemove=c.Util.falseFn,t.onload=c.bind(this.fire,this,"load"),this.options.crossOrigin&&(t.crossOrigin=""),t.src=this._url,t.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;
c.DomUtil.setTransform(this._image,n,e)},_reset:function(){var t=this._image,e=new c.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=e.getSize();c.DomUtil.setPosition(t,e.min),t.style.width=n.x+"px",t.style.height=n.y+"px"},_updateOpacity:function(){c.DomUtil.setOpacity(this._image,this.options.opacity)}}),c.imageOverlay=function(t,e,n){return new c.ImageOverlay(t,e,n)},c.Icon=c.Class.extend({initialize:function(t){c.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(n,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),i},_setIconStyles:function(t,e){var n=this.options,i=n[e+"Size"];"number"==typeof i&&(i=[i,i]);var o=c.point(i),r=c.point("shadow"===e&&n.shadowAnchor||n.iconAnchor||o&&o.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(n.className||""),r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},_createImg:function(t,e){return e=e||s.createElement("img"),e.src=t,e},_getIconUrl:function(t){return c.Browser.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),c.icon=function(t){return new c.Icon(t)},c.Icon.Default=c.Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return c.Icon.Default.imagePath||(c.Icon.Default.imagePath=this._detectIconPath()),(this.options.imagePath||c.Icon.Default.imagePath)+c.Icon.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=c.DomUtil.create("div","leaflet-default-icon-path",s.body),e=c.DomUtil.getStyle(t,"background-image")||c.DomUtil.getStyle(t,"backgroundImage");return s.body.removeChild(t),0===e.indexOf("url")?e.replace(/^url\([\"\']?/,"").replace(/marker-icon\.png[\"\']?\)$/,""):""}}),c.Marker=c.Layer.extend({options:{icon:new c.Icon.Default,interactive:!0,draggable:!1,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(t,e){c.setOptions(this,e),this._latlng=c.latLng(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=c.latLng(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=t.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(n.title=t.title),t.alt&&(n.alt=t.alt)),c.DomUtil.addClass(n,e),t.keyboard&&(n.tabIndex="0"),this._icon=n,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var o=t.icon.createShadow(this._shadow),r=!1;o!==this._shadow&&(this._removeShadow(),r=!0),o&&c.DomUtil.addClass(o,e),this._shadow=o,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),o&&r&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),c.DomUtil.remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&c.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(t){c.DomUtil.setPosition(this._icon,t),this._shadow&&c.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(c.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),c.Handler.MarkerDrag)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new c.Handler.MarkerDrag(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;c.DomUtil.setOpacity(this._icon,t),this._shadow&&c.DomUtil.setOpacity(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor||[0,0]}}),c.marker=function(t,e){return new c.Marker(t,e)},c.DivIcon=c.Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:s.createElement("div"),n=this.options;if(e.innerHTML=n.html!==!1?n.html:"",n.bgPos){var i=c.point(n.bgPos);e.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}}),c.divIcon=function(t){return new c.DivIcon(t)},c.DivOverlay=c.Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){c.setOptions(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&c.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&c.DomUtil.setOpacity(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(c.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(c.bind(c.DomUtil.remove,c.DomUtil,this._container),200)):c.DomUtil.remove(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=c.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&c.DomUtil.toFront(this._container),this},bringToBack:function(){return this._map&&c.DomUtil.toBack(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=c.point(this.options.offset),n=this._getAnchor();this._zoomAnimated?c.DomUtil.setPosition(this._container,t.add(n)):e=e.add(t).add(n);var i=this._containerBottom=-e.y,o=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=i+"px",this._container.style.left=o+"px"}},_getAnchor:function(){return[0,0]}}),c.Popup=c.DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){c.DivOverlay.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof c.Path||this._source.on("preclick",c.DomEvent.stopPropagation))},onRemove:function(t){c.DivOverlay.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof c.Path||this._source.off("preclick",c.DomEvent.stopPropagation))},getEvents:function(){var t=c.DivOverlay.prototype.getEvents.call(this);return("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=c.DomUtil.create("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated");if(this.options.closeButton){var n=this._closeButton=c.DomUtil.create("a",t+"-close-button",e);n.href="#close",n.innerHTML="&#215;",c.DomEvent.on(n,"click",this._onCloseButtonClick,this)}var i=this._wrapper=c.DomUtil.create("div",t+"-content-wrapper",e);this._contentNode=c.DomUtil.create("div",t+"-content",i),c.DomEvent.disableClickPropagation(i).disableScrollPropagation(this._contentNode).on(i,"contextmenu",c.DomEvent.stopPropagation),this._tipContainer=c.DomUtil.create("div",t+"-tip-container",e),this._tip=c.DomUtil.create("div",t+"-tip",this._tipContainer)},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var n=t.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),e.width=n+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,o=this.options.maxHeight,r="leaflet-popup-scrolled";o&&i>o?(e.height=o+"px",c.DomUtil.addClass(t,r)):c.DomUtil.removeClass(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),n=this._getAnchor();c.DomUtil.setPosition(this._container,e.add(n))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var t=this._map,e=parseInt(c.DomUtil.getStyle(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+e,i=this._containerWidth,o=new c.Point(this._containerLeft,-n-this._containerBottom);o._add(c.DomUtil.getPosition(this._container));var r=t.layerPointToContainerPoint(o),s=c.point(this.options.autoPanPadding),a=c.point(this.options.autoPanPaddingTopLeft||s),u=c.point(this.options.autoPanPaddingBottomRight||s),l=t.getSize(),h=0,d=0;r.x+i+u.x>l.x&&(h=r.x+i-l.x+u.x),r.x-h-a.x<0&&(h=r.x-a.x),r.y+n+u.y>l.y&&(d=r.y+n-l.y+u.y),r.y-d-a.y<0&&(d=r.y-a.y),(h||d)&&t.fire("autopanstart").panBy([h,d])}},_onCloseButtonClick:function(t){this._close(),c.DomEvent.stop(t)},_getAnchor:function(){return c.point(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),c.popup=function(t,e){return new c.Popup(t,e)},c.Map.mergeOptions({closePopupOnClick:!0}),c.Map.include({openPopup:function(t,e,n){return t instanceof c.Popup||(t=new c.Popup(n).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),c.Layer.include({bindPopup:function(t,e){return t instanceof c.Popup?(c.setOptions(t,e),this._popup=t,t._source=this):(this._popup&&!e||(this._popup=new c.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){if(t instanceof c.Layer||(e=t,t=this),t instanceof c.FeatureGroup)for(var n in this._layers){t=this._layers[n];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._popup&&this._map&&(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;if(this._popup&&this._map)return c.DomEvent.stop(t),e instanceof c.Path?void this.openPopup(t.layer||t.target,t.latlng):void(this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),c.Tooltip=c.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){c.DivOverlay.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){c.DivOverlay.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=c.DivOverlay.prototype.getEvents.call(this);return c.Browser.touch&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=c.DomUtil.create("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,n=this._container,i=e.latLngToContainerPoint(e.getCenter()),o=e.layerPointToContainerPoint(t),r=this.options.direction,s=n.offsetWidth,a=n.offsetHeight,u=c.point(this.options.offset),l=this._getAnchor();"top"===r?t=t.add(c.point(-s/2+u.x,-a+u.y+l.y,!0)):"bottom"===r?t=t.subtract(c.point(s/2-u.x,-u.y,!0)):"center"===r?t=t.subtract(c.point(s/2+u.x,a/2-l.y+u.y,!0)):"right"===r||"auto"===r&&o.x<i.x?(r="right",t=t.add(c.point(u.x+l.x,l.y-a/2+u.y,!0))):(r="left",t=t.subtract(c.point(s+l.x-u.x,a/2-l.y-u.y,!0))),c.DomUtil.removeClass(n,"leaflet-tooltip-right"),c.DomUtil.removeClass(n,"leaflet-tooltip-left"),c.DomUtil.removeClass(n,"leaflet-tooltip-top"),c.DomUtil.removeClass(n,"leaflet-tooltip-bottom"),c.DomUtil.addClass(n,"leaflet-tooltip-"+r),c.DomUtil.setPosition(n,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&c.DomUtil.setOpacity(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return c.point(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),c.tooltip=function(t,e){return new c.Tooltip(t,e)},c.Map.include({openTooltip:function(t,e,n){return t instanceof c.Tooltip||(t=new c.Tooltip(n).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),c.Layer.include({bindTooltip:function(t,e){return t instanceof c.Tooltip?(c.setOptions(t,e),this._tooltip=t,t._source=this):(this._tooltip&&!e||(this._tooltip=c.tooltip(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),c.Browser.touch&&(n.click=this._openTooltip)),this[e](n),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){if(t instanceof c.Layer||(e=t,t=this),t instanceof c.FeatureGroup)for(var n in this._layers){t=this._layers[n];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(c.DomUtil.addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(c.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:a)},_moveTooltip:function(t){var e,n,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),n=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(i)}}),c.LayerGroup=c.Layer.extend({initialize:function(t){this._layers={};var e,n;if(t)for(e=0,n=t.length;e<n;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){for(var t in this._layers)this.removeLayer(this._layers[t]);return this},invoke:function(t){var e,n,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)n=this._layers[e],n[t]&&n[t].apply(n,i);return this},onAdd:function(t){for(var e in this._layers)t.addLayer(this._layers[e])},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e])},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return c.stamp(t)}}),c.layerGroup=function(t){return new c.LayerGroup(t)},c.FeatureGroup=c.LayerGroup.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),c.LayerGroup.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),c.LayerGroup.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new c.LatLngBounds;for(var e in this._layers){var n=this._layers[e];t.extend(n.getBounds?n.getBounds():n.getLatLng())}return t}}),c.featureGroup=function(t){return new c.FeatureGroup(t)},c.Renderer=c.Layer.extend({options:{padding:.1},initialize:function(t){c.setOptions(this,t),c.stamp(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&c.DomUtil.addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){c.DomUtil.remove(this._container),this.off("update",this._updatePaths,this)},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),i=c.DomUtil.getPosition(this._container),o=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),s=this._map.project(t,e),a=s.subtract(r),u=o.multiplyBy(-n).add(i).add(o).subtract(a);c.Browser.any3d?c.DomUtil.setTransform(this._container,u,n):c.DomUtil.setPosition(this._container,u)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new c.Bounds(n,n.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),c.Map.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this.options.preferCanvas&&c.canvas()||c.svg()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||t===a)return!1;var e=this._paneRenderers[t];return e===a&&(e=c.SVG&&c.svg({pane:t})||c.Canvas&&c.canvas({pane:t}),this._paneRenderers[t]=e),e}}),c.Path=c.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return c.setOptions(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(c.Browser.touch?10:0)}}),c.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var n=e*e;return t=this._reducePoints(t,n),t=this._simplifyDP(t,n)},pointToSegmentDistance:function(t,e,n){return Math.sqrt(this._sqClosestPointOnSegment(t,e,n,!0))},closestPointOnSegment:function(t,e,n){return this._sqClosestPointOnSegment(t,e,n)},_simplifyDP:function(t,e){var n=t.length,i=typeof Uint8Array!=a+""?Uint8Array:Array,o=new i(n);o[0]=o[n-1]=1,this._simplifyDPStep(t,o,e,0,n-1);var r,s=[];for(r=0;r<n;r++)o[r]&&s.push(t[r]);return s},_simplifyDPStep:function(t,e,n,i,o){var r,s,a,u=0;for(s=i+1;s<=o-1;s++)a=this._sqClosestPointOnSegment(t[s],t[i],t[o],!0),a>u&&(r=s,u=a);u>n&&(e[r]=1,this._simplifyDPStep(t,e,n,i,r),this._simplifyDPStep(t,e,n,r,o))},_reducePoints:function(t,e){for(var n=[t[0]],i=1,o=0,r=t.length;i<r;i++)this._sqDist(t[i],t[o])>e&&(n.push(t[i]),o=i);return o<r-1&&n.push(t[r-1]),n},clipSegment:function(t,e,n,i,o){var r,s,a,u=i?this._lastCode:this._getBitCode(t,n),c=this._getBitCode(e,n);for(this._lastCode=c;;){if(!(u|c))return[t,e];if(u&c)return!1;r=u||c,s=this._getEdgeIntersection(t,e,r,n,o),a=this._getBitCode(s,n),r===u?(t=s,u=a):(e=s,c=a)}},_getEdgeIntersection:function(t,e,n,i,o){var r,s,a=e.x-t.x,u=e.y-t.y,l=i.min,h=i.max;return 8&n?(r=t.x+a*(h.y-t.y)/u,s=h.y):4&n?(r=t.x+a*(l.y-t.y)/u,s=l.y):2&n?(r=h.x,s=t.y+u*(h.x-t.x)/a):1&n&&(r=l.x,s=t.y+u*(l.x-t.x)/a),new c.Point(r,s,o)},_getBitCode:function(t,e){var n=0;return t.x<e.min.x?n|=1:t.x>e.max.x&&(n|=2),t.y<e.min.y?n|=4:t.y>e.max.y&&(n|=8),n},_sqDist:function(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i},_sqClosestPointOnSegment:function(t,e,n,i){var o,r=e.x,s=e.y,a=n.x-r,u=n.y-s,l=a*a+u*u;return l>0&&(o=((t.x-r)*a+(t.y-s)*u)/l,o>1?(r=n.x,s=n.y):o>0&&(r+=a*o,s+=u*o)),a=t.x-r,u=t.y-s,i?a*a+u*u:new c.Point(r,s)}},c.Polyline=c.Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){c.setOptions(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,n,i=1/0,o=null,r=c.LineUtil._sqClosestPointOnSegment,s=0,a=this._parts.length;s<a;s++)for(var u=this._parts[s],l=1,h=u.length;l<h;l++){e=u[l-1],n=u[l];var d=r(t,e,n,!0);d<i&&(i=d,o=r(t,e,n))}return o&&(o.distance=Math.sqrt(i)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,n,i,o,r,s,a=this._rings[0],u=a.length;if(!u)return null;for(t=0,e=0;t<u-1;t++)e+=a[t].distanceTo(a[t+1])/2;if(0===e)return this._map.layerPointToLatLng(a[0]);for(t=0,i=0;t<u-1;t++)if(o=a[t],r=a[t+1],n=o.distanceTo(r),i+=n,i>e)return s=(i-e)/n,this._map.layerPointToLatLng([r.x-s*(r.x-o.x),r.y-s*(r.y-o.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=c.latLng(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new c.LatLngBounds,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return c.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],n=c.Polyline._flat(t),i=0,o=t.length;i<o;i++)n?(e[i]=c.latLng(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new c.Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var e=this._clickTolerance(),n=new c.Point(e,e);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(n),t.max._add(n),this._pxBounds=t)},_projectLatlngs:function(t,e,n){var i,o,r=t[0]instanceof c.LatLng,s=t.length;if(r){for(o=[],i=0;i<s;i++)o[i]=this._map.latLngToLayerPoint(t[i]),n.extend(o[i]);e.push(o)}else for(i=0;i<s;i++)this._projectLatlngs(t[i],e,n)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var e,n,i,o,r,s,a,u=this._parts;for(e=0,i=0,o=this._rings.length;e<o;e++)for(a=this._rings[e],n=0,r=a.length;n<r-1;n++)s=c.LineUtil.clipSegment(a[n],a[n+1],t,n,!0),s&&(u[i]=u[i]||[],u[i].push(s[0]),s[1]===a[n+1]&&n!==r-2||(u[i].push(s[1]),i++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,n=0,i=t.length;n<i;n++)t[n]=c.LineUtil.simplify(t[n],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}}),c.polyline=function(t,e){return new c.Polyline(t,e)},c.Polyline._flat=function(t){return!c.Util.isArray(t[0])||"object"!=typeof t[0][0]&&"undefined"!=typeof t[0][0]},c.PolyUtil={},c.PolyUtil.clipPolygon=function(t,e,n){var i,o,r,s,a,u,l,h,d,f=[1,4,2,8],p=c.LineUtil;for(o=0,l=t.length;o<l;o++)t[o]._code=p._getBitCode(t[o],e);for(s=0;s<4;s++){for(h=f[s],i=[],o=0,l=t.length,r=l-1;o<l;r=o++)a=t[o],u=t[r],a._code&h?u._code&h||(d=p._getEdgeIntersection(u,a,h,e,n),d._code=p._getBitCode(d,e),i.push(d)):(u._code&h&&(d=p._getEdgeIntersection(u,a,h,e,n),d._code=p._getBitCode(d,e),i.push(d)),i.push(a));t=i}return t},c.Polygon=c.Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,n,i,o,r,s,a,u,c=this._rings[0],l=c.length;if(!l)return null;for(r=s=a=0,t=0,e=l-1;t<l;e=t++)n=c[t],i=c[e],o=n.y*i.x-i.y*n.x,s+=(n.x+i.x)*o,a+=(n.y+i.y)*o,r+=3*o;return u=0===r?c[0]:[s/r,a/r],this._map.layerPointToLatLng(u)},_convertLatLngs:function(t){var e=c.Polyline.prototype._convertLatLngs.call(this,t),n=e.length;return n>=2&&e[0]instanceof c.LatLng&&e[0].equals(e[n-1])&&e.pop(),e},_setLatLngs:function(t){c.Polyline.prototype._setLatLngs.call(this,t),c.Polyline._flat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return c.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,n=new c.Point(e,e);if(t=new c.Bounds(t.min.subtract(n),t.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);for(var i,o=0,r=this._rings.length;o<r;o++)i=c.PolyUtil.clipPolygon(this._rings[o],t,!0),i.length&&this._parts.push(i)}},_updatePath:function(){this._renderer._updatePoly(this,!0)}}),c.polygon=function(t,e){return new c.Polygon(t,e)},c.Rectangle=c.Polygon.extend({initialize:function(t,e){c.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=c.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),c.rectangle=function(t,e){return new c.Rectangle(t,e)},c.CircleMarker=c.Path.extend({options:{fill:!0,radius:10},initialize:function(t,e){c.setOptions(this,e),this._latlng=c.latLng(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=c.latLng(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return c.Path.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,n=this._clickTolerance(),i=[t+n,e+n];this._pxBounds=new c.Bounds(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}}),c.circleMarker=function(t,e){return new c.CircleMarker(t,e)},c.Circle=c.CircleMarker.extend({initialize:function(t,e,n){if("number"==typeof e&&(e=c.extend({},n,{radius:e})),c.setOptions(this,e),this._latlng=c.latLng(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw();
},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new c.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:c.Path.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===c.CRS.Earth.distance){var o=Math.PI/180,r=this._mRadius/c.CRS.Earth.R/o,s=n.project([e+r,t]),a=n.project([e-r,t]),u=s.add(a).divideBy(2),l=n.unproject(u).lat,h=Math.acos((Math.cos(r*o)-Math.sin(e*o)*Math.sin(l*o))/(Math.cos(e*o)*Math.cos(l*o)))/o;(isNaN(h)||0===h)&&(h=r/Math.cos(Math.PI/180*e)),this._point=u.subtract(n.getPixelOrigin()),this._radius=isNaN(h)?0:Math.max(Math.round(u.x-n.project([l,t-h]).x),1),this._radiusY=Math.max(Math.round(u.y-s.y),1)}else{var d=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(d).x}this._updateBounds()}}),c.circle=function(t,e,n){return new c.Circle(t,e,n)},c.SVG=c.Renderer.extend({getEvents:function(){var t=c.Renderer.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=c.SVG.create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=c.SVG.create("g"),this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){c.Renderer.prototype._update.call(this);var t=this._bounds,e=t.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,n.setAttribute("width",e.x),n.setAttribute("height",e.y)),c.DomUtil.setPosition(n,t.min),n.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=c.SVG.create("path");t.options.className&&c.DomUtil.addClass(e,t.options.className),t.options.interactive&&c.DomUtil.addClass(e,"leaflet-interactive"),this._updateStyle(t),this._layers[c.stamp(t)]=t},_addPath:function(t){this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){c.DomUtil.remove(t._path),t.removeInteractiveTarget(t._path),delete this._layers[c.stamp(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,n=t.options;e&&(n.stroke?(e.setAttribute("stroke",n.color),e.setAttribute("stroke-opacity",n.opacity),e.setAttribute("stroke-width",n.weight),e.setAttribute("stroke-linecap",n.lineCap),e.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?e.setAttribute("stroke-dasharray",n.dashArray):e.removeAttribute("stroke-dasharray"),n.dashOffset?e.setAttribute("stroke-dashoffset",n.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),n.fill?(e.setAttribute("fill",n.fillColor||n.color),e.setAttribute("fill-opacity",n.fillOpacity),e.setAttribute("fill-rule",n.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,c.SVG.pointsToPath(t._parts,e))},_updateCircle:function(t){var e=t._point,n=t._radius,i=t._radiusY||n,o="a"+n+","+i+" 0 1,0 ",r=t._empty()?"M0 0":"M"+(e.x-n)+","+e.y+o+2*n+",0 "+o+2*-n+",0 ";this._setPath(t,r)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){c.DomUtil.toFront(t._path)},_bringToBack:function(t){c.DomUtil.toBack(t._path)}}),c.extend(c.SVG,{create:function(t){return s.createElementNS("http://www.w3.org/2000/svg",t)},pointsToPath:function(t,e){var n,i,o,r,s,a,u="";for(n=0,o=t.length;n<o;n++){for(s=t[n],i=0,r=s.length;i<r;i++)a=s[i],u+=(i?"L":"M")+a.x+" "+a.y;u+=e?c.Browser.svg?"z":"x":""}return u||"M0 0"}}),c.Browser.svg=!(!s.createElementNS||!c.SVG.create("svg").createSVGRect),c.svg=function(t){return c.Browser.svg||c.Browser.vml?new c.SVG(t):null},c.Browser.vml=!c.Browser.svg&&function(){try{var t=s.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}(),c.SVG.include(c.Browser.vml?{_initContainer:function(){this._container=c.DomUtil.create("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(c.Renderer.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=c.SVG.create("shape");c.DomUtil.addClass(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=c.SVG.create("path"),e.appendChild(t._path),this._updateStyle(t)},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;c.DomUtil.remove(e),t.removeInteractiveTarget(e)},_updateStyle:function(t){var e=t._stroke,n=t._fill,i=t.options,o=t._container;o.stroked=!!i.stroke,o.filled=!!i.fill,i.stroke?(e||(e=t._stroke=c.SVG.create("stroke")),o.appendChild(e),e.weight=i.weight+"px",e.color=i.color,e.opacity=i.opacity,i.dashArray?e.dashStyle=c.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=i.lineCap.replace("butt","flat"),e.joinstyle=i.lineJoin):e&&(o.removeChild(e),t._stroke=null),i.fill?(n||(n=t._fill=c.SVG.create("fill")),o.appendChild(n),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(o.removeChild(n),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),n=Math.round(t._radius),i=Math.round(t._radiusY||n);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+n+","+i+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){c.DomUtil.toFront(t._container)},_bringToBack:function(t){c.DomUtil.toBack(t._container)}}:{}),c.Browser.vml&&(c.SVG.create=function(){try{return s.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return s.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return s.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),c.Canvas=c.Renderer.extend({onAdd:function(){c.Renderer.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=s.createElement("canvas");c.DomEvent.on(t,"mousemove",c.Util.throttle(this._onMouseMove,32,this),this).on(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_updatePaths:function(){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},c.Renderer.prototype._update.call(this);var t=this._bounds,e=this._container,n=t.getSize(),i=c.Browser.retina?2:1;c.DomUtil.setPosition(e,t.min),e.width=i*n.x,e.height=i*n.y,e.style.width=n.x+"px",e.style.height=n.y+"px",c.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_initPath:function(t){this._updateDashArray(t),this._layers[c.stamp(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,n=e.next,i=e.prev;n?n.prev=i:this._drawLast=i,i?i.next=n:this._drawFirst=n,delete t._order,delete this._layers[c.stamp(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(t.options.dashArray){var e,n=t.options.dashArray.split(","),i=[];for(e=0;e<n.length;e++)i.push(Number(n[e]));t.options._dashArray=i}},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||c.Util.requestAnimFrame(this._redraw,this))},_extendRedrawBounds:function(t){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new c.Bounds,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))},_redraw:function(){this._redrawRequest=null,this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var n=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)t=i.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var n,i,o,r,s=t._parts,a=s.length,u=this._ctx;if(a){for(this._drawnLayers[t._leaflet_id]=t,u.beginPath(),u.setLineDash&&u.setLineDash(t.options&&t.options._dashArray||[]),n=0;n<a;n++){for(i=0,o=s[n].length;i<o;i++)r=s[n][i],u[i?"lineTo":"moveTo"](r.x,r.y);e&&u.closePath()}this._fillStroke(u,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=this._ctx,i=t._radius,o=(t._radiusY||i)/i;this._drawnLayers[t._leaflet_id]=t,1!==o&&(n.save(),n.scale(1,o)),n.beginPath(),n.arc(e.x,e.y/o,i,0,2*Math.PI,!1),1!==o&&n.restore(),this._fillStroke(n,t)}},_fillStroke:function(t,e){var n=e.options;n.fill&&(t.globalAlpha=n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(t.globalAlpha=n.opacity,t.lineWidth=n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){for(var e,n,i=this._map.mouseEventToLayerPoint(t),o=this._drawFirst;o;o=o.next)e=o.layer,e.options.interactive&&e._containsPoint(i)&&!this._map._draggableMoved(e)&&(n=e);n&&(c.DomEvent._fakeStop(t),this._fireEvent([n],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(c.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var n,i,o=this._drawFirst;o;o=o.next)n=o.layer,n.options.interactive&&n._containsPoint(e)&&(i=n);i!==this._hoveredLayer&&(this._handleMouseOut(t),i&&(c.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseover"),this._hoveredLayer=i)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_bringToFront:function(t){var e=t._order,n=e.next,i=e.prev;n&&(n.prev=i,i?i.next=n:n&&(this._drawFirst=n),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))},_bringToBack:function(t){var e=t._order,n=e.next,i=e.prev;i&&(i.next=n,n?n.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}),c.Browser.canvas=function(){return!!s.createElement("canvas").getContext}(),c.canvas=function(t){return c.Browser.canvas?new c.Canvas(t):null},c.Polyline.prototype._containsPoint=function(t,e){var n,i,o,r,s,a,u=this._clickTolerance();if(!this._pxBounds.contains(t))return!1;for(n=0,r=this._parts.length;n<r;n++)for(a=this._parts[n],i=0,s=a.length,o=s-1;i<s;o=i++)if((e||0!==i)&&c.LineUtil.pointToSegmentDistance(t,a[o],a[i])<=u)return!0;return!1},c.Polygon.prototype._containsPoint=function(t){var e,n,i,o,r,s,a,u,l=!1;if(!this._pxBounds.contains(t))return!1;for(o=0,a=this._parts.length;o<a;o++)for(e=this._parts[o],r=0,u=e.length,s=u-1;r<u;s=r++)n=e[r],i=e[s],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(l=!l);return l||c.Polyline.prototype._containsPoint.call(this,t,!0)},c.CircleMarker.prototype._containsPoint=function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()},c.GeoJSON=c.FeatureGroup.extend({initialize:function(t,e){c.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,n,i,o=c.Util.isArray(t)?t:t.features;if(o){for(e=0,n=o.length;e<n;e++)i=o[e],(i.geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var r=this.options;if(r.filter&&!r.filter(t))return this;var s=c.GeoJSON.geometryToLayer(t,r);return s?(s.feature=c.GeoJSON.asFeature(t),s.defaultOptions=s.options,this.resetStyle(s),r.onEachFeature&&r.onEachFeature(t,s),this.addLayer(s)):this},resetStyle:function(t){return t.options=c.Util.extend({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),c.extend(c.GeoJSON,{geometryToLayer:function(t,e){var n,i,o,r,s="Feature"===t.type?t.geometry:t,a=s?s.coordinates:null,u=[],l=e&&e.pointToLayer,h=e&&e.coordsToLatLng||this.coordsToLatLng;if(!a&&!s)return null;switch(s.type){case"Point":return n=h(a),l?l(t,n):new c.Marker(n);case"MultiPoint":for(o=0,r=a.length;o<r;o++)n=h(a[o]),u.push(l?l(t,n):new c.Marker(n));return new c.FeatureGroup(u);case"LineString":case"MultiLineString":return i=this.coordsToLatLngs(a,"LineString"===s.type?0:1,h),new c.Polyline(i,e);case"Polygon":case"MultiPolygon":return i=this.coordsToLatLngs(a,"Polygon"===s.type?1:2,h),new c.Polygon(i,e);case"GeometryCollection":for(o=0,r=s.geometries.length;o<r;o++){var d=this.geometryToLayer({geometry:s.geometries[o],type:"Feature",properties:t.properties},e);d&&u.push(d)}return new c.FeatureGroup(u);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new c.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,n){for(var i,o=[],r=0,s=t.length;r<s;r++)i=e?this.coordsToLatLngs(t[r],e-1,n):(n||this.coordsToLatLng)(t[r]),o.push(i);return o},latLngToCoords:function(t){return t.alt!==a?[t.lng,t.lat,t.alt]:[t.lng,t.lat]},latLngsToCoords:function(t,e,n){for(var i=[],o=0,r=t.length;o<r;o++)i.push(e?c.GeoJSON.latLngsToCoords(t[o],e-1,n):c.GeoJSON.latLngToCoords(t[o]));return!e&&n&&i.push(i[0]),i},getFeature:function(t,e){return t.feature?c.extend({},t.feature,{geometry:e}):c.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var d={toGeoJSON:function(){return c.GeoJSON.getFeature(this,{type:"Point",coordinates:c.GeoJSON.latLngToCoords(this.getLatLng())})}};c.Marker.include(d),c.Circle.include(d),c.CircleMarker.include(d),c.Polyline.prototype.toGeoJSON=function(){var t=!c.Polyline._flat(this._latlngs),e=c.GeoJSON.latLngsToCoords(this._latlngs,t?1:0);return c.GeoJSON.getFeature(this,{type:(t?"Multi":"")+"LineString",coordinates:e})},c.Polygon.prototype.toGeoJSON=function(){var t=!c.Polyline._flat(this._latlngs),e=t&&!c.Polyline._flat(this._latlngs[0]),n=c.GeoJSON.latLngsToCoords(this._latlngs,e?2:t?1:0,!0);return t||(n=[n]),c.GeoJSON.getFeature(this,{type:(e?"Multi":"")+"Polygon",coordinates:n})},c.LayerGroup.include({toMultiPoint:function(){var t=[];return this.eachLayer(function(e){t.push(e.toGeoJSON().geometry.coordinates)}),c.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint();var e="GeometryCollection"===t,n=[];return this.eachLayer(function(t){if(t.toGeoJSON){var i=t.toGeoJSON();n.push(e?i.geometry:c.GeoJSON.asFeature(i))}}),e?c.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}}),c.geoJSON=function(t,e){return new c.GeoJSON(t,e)},c.geoJson=c.geoJSON,c.Draggable=c.Evented.extend({options:{clickTolerance:3},statics:{START:c.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e,n){this._element=t,this._dragStartTarget=e||t,this._preventOutline=n},enable:function(){this._enabled||(c.DomEvent.on(this._dragStartTarget,c.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(c.Draggable._dragging===this&&this.finishDrag(),c.DomEvent.off(this._dragStartTarget,c.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!c.DomUtil.hasClass(this._element,"leaflet-zoom-anim")&&!(c.Draggable._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(c.Draggable._dragging=this,this._preventOutline&&c.DomUtil.preventOutline(this._element),c.DomUtil.disableImageDrag(),c.DomUtil.disableTextSelection(),this._moving)))){this.fire("down");var e=t.touches?t.touches[0]:t;this._startPoint=new c.Point(e.clientX,e.clientY),c.DomEvent.on(s,c.Draggable.MOVE[t.type],this._onMove,this).on(s,c.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(!t._simulated&&this._enabled){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new c.Point(e.clientX,e.clientY),i=n.subtract(this._startPoint);(i.x||i.y)&&(Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(c.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=c.DomUtil.getPosition(this._element).subtract(i),c.DomUtil.addClass(s.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,r.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),c.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,c.Util.cancelAnimFrame(this._animRequest),this._lastEvent=t,this._animRequest=c.Util.requestAnimFrame(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),c.DomUtil.setPosition(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){c.DomUtil.removeClass(s.body,"leaflet-dragging"),this._lastTarget&&(c.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in c.Draggable.MOVE)c.DomEvent.off(s,c.Draggable.MOVE[t],this._onMove,this).off(s,c.Draggable.END[t],this._onUp,this);c.DomUtil.enableImageDrag(),c.DomUtil.enableTextSelection(),this._moved&&this._moving&&(c.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,c.Draggable._dragging=!1}}),c.Handler=c.Class.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}}),c.Map.mergeOptions({dragging:!0,inertia:!c.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0}),c.Map.Drag=c.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new c.Draggable(t._mapPane,t._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}c.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){c.DomUtil.removeClass(this._map._container,"leaflet-grab"),c.DomUtil.removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var t=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=c.latLngBounds(this._map.options.maxBounds);this._offsetLimit=c.bounds(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(e),e-this._times[0]>50&&(this._positions.shift(),this._times.shift())}this._map.fire("move",t).fire("drag",t)},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,o=(i-e+n)%t+e-n,r=(i+e+n)%t-e-n,s=Math.abs(o+n)<Math.abs(r+n)?o:r;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=s},_onDragEnd:function(t){var e=this._map,n=e.options,i=!n.inertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{var o=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,s=n.easeLinearity,a=o.multiplyBy(s/r),u=a.distanceTo([0,0]),l=Math.min(n.inertiaMaxSpeed,u),h=a.multiplyBy(l/u),d=l/(n.inertiaDeceleration*s),f=h.multiplyBy(-d/2).round();f.x||f.y?(f=e._limitOffset(f,e.options.maxBounds),c.Util.requestAnimFrame(function(){e.panBy(f,{duration:d,easeLinearity:s,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}}),c.Map.addInitHook("addHandler","dragging",c.Map.Drag),c.Map.mergeOptions({doubleClickZoom:!0}),c.Map.DoubleClickZoom=c.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,n=e.getZoom(),i=e.options.zoomDelta,o=t.originalEvent.shiftKey?n-i:n+i;"center"===e.options.doubleClickZoom?e.setZoom(o):e.setZoomAround(t.containerPoint,o)}}),c.Map.addInitHook("addHandler","doubleClickZoom",c.Map.DoubleClickZoom),c.Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60}),c.Map.ScrollWheelZoom=c.Handler.extend({addHooks:function(){c.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){c.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=c.DomEvent.getWheelDelta(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(c.bind(this._performZoom,this),i),c.DomEvent.stop(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),n=this._map.options.zoomSnap||0;t._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),o=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,r=n?Math.ceil(o/n)*n:o,s=t._limitZoom(e+(this._delta>0?r:-r))-e;this._delta=0,this._startTime=null,s&&("center"===t.options.scrollWheelZoom?t.setZoom(e+s):t.setZoomAround(this._lastMousePos,e+s))}}),c.Map.addInitHook("addHandler","scrollWheelZoom",c.Map.ScrollWheelZoom),c.extend(c.DomEvent,{_touchstart:c.Browser.msPointer?"MSPointerDown":c.Browser.pointer?"pointerdown":"touchstart",_touchend:c.Browser.msPointer?"MSPointerUp":c.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,e,n){function i(t){var e;if(e=c.Browser.pointer?c.DomEvent._pointersCount:t.touches.length,!(e>1)){var n=Date.now(),i=n-(r||n);s=t.touches?t.touches[0]:t,a=i>0&&i<=u,r=n}}function o(){if(a&&!s.cancelBubble){if(c.Browser.pointer){var t,n,i={};for(n in s)t=s[n],i[n]=t&&t.bind?t.bind(s):t;s=i}s.type="dblclick",e(s),r=null}}var r,s,a=!1,u=250,l="_leaflet_",h=this._touchstart,d=this._touchend;return t[l+h+n]=i,t[l+d+n]=o,t[l+"dblclick"+n]=e,t.addEventListener(h,i,!1),t.addEventListener(d,o,!1),c.Browser.edge||t.addEventListener("dblclick",e,!1),this},removeDoubleTapListener:function(t,e){var n="_leaflet_",i=t[n+this._touchstart+e],o=t[n+this._touchend+e],r=t[n+"dblclick"+e];return t.removeEventListener(this._touchstart,i,!1),t.removeEventListener(this._touchend,o,!1),c.Browser.edge||t.removeEventListener("dblclick",r,!1),this}}),c.extend(c.DomEvent,{POINTER_DOWN:c.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:c.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:c.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:c.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(t,e,n,i){return"touchstart"===e?this._addPointerStart(t,n,i):"touchmove"===e?this._addPointerMove(t,n,i):"touchend"===e&&this._addPointerEnd(t,n,i),this},removePointerListener:function(t,e,n){var i=t["_leaflet_"+e+n];return"touchstart"===e?t.removeEventListener(this.POINTER_DOWN,i,!1):"touchmove"===e?t.removeEventListener(this.POINTER_MOVE,i,!1):"touchend"===e&&(t.removeEventListener(this.POINTER_UP,i,!1),t.removeEventListener(this.POINTER_CANCEL,i,!1)),this},_addPointerStart:function(t,e,n){var i=c.bind(function(t){if("mouse"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(this.TAG_WHITE_LIST.indexOf(t.target.tagName)<0))return;c.DomEvent.preventDefault(t)}this._handlePointer(t,e)},this);if(t["_leaflet_touchstart"+n]=i,t.addEventListener(this.POINTER_DOWN,i,!1),!this._pointerDocListener){var o=c.bind(this._globalPointerUp,this);s.documentElement.addEventListener(this.POINTER_DOWN,c.bind(this._globalPointerDown,this),!0),s.documentElement.addEventListener(this.POINTER_MOVE,c.bind(this._globalPointerMove,this),!0),s.documentElement.addEventListener(this.POINTER_UP,o,!0),s.documentElement.addEventListener(this.POINTER_CANCEL,o,!0),this._pointerDocListener=!0}},_globalPointerDown:function(t){this._pointers[t.pointerId]=t,this._pointersCount++},_globalPointerMove:function(t){this._pointers[t.pointerId]&&(this._pointers[t.pointerId]=t)},_globalPointerUp:function(t){delete this._pointers[t.pointerId],this._pointersCount--},_handlePointer:function(t,e){t.touches=[];for(var n in this._pointers)t.touches.push(this._pointers[n]);t.changedTouches=[t],e(t)},_addPointerMove:function(t,e,n){var i=c.bind(function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&this._handlePointer(t,e)},this);t["_leaflet_touchmove"+n]=i,t.addEventListener(this.POINTER_MOVE,i,!1)},_addPointerEnd:function(t,e,n){var i=c.bind(function(t){this._handlePointer(t,e)},this);t["_leaflet_touchend"+n]=i,t.addEventListener(this.POINTER_UP,i,!1),t.addEventListener(this.POINTER_CANCEL,i,!1)}}),c.Map.mergeOptions({touchZoom:c.Browser.touch&&!c.Browser.android23,bounceAtZoomLimits:!0}),c.Map.TouchZoom=c.Handler.extend({addHooks:function(){c.DomUtil.addClass(this._map._container,"leaflet-touch-zoom"),c.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){c.DomUtil.removeClass(this._map._container,"leaflet-touch-zoom"),c.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var n=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(n.add(i)._divideBy(2))),this._startDist=n.distanceTo(i),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),c.DomEvent.on(s,"touchmove",this._onTouchMove,this).on(s,"touchend",this._onTouchEnd,this),c.DomEvent.preventDefault(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,n=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]),o=n.distanceTo(i)/this._startDist;if(this._zoom=e.getScaleZoom(o,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&o<1||this._zoom>e.getMaxZoom()&&o>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var r=n._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===r.x&&0===r.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(r),this._zoom)}this._moved||(e._moveStart(!0),this._moved=!0),c.Util.cancelAnimFrame(this._animRequest);var s=c.bind(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=c.Util.requestAnimFrame(s,this,!0),c.DomEvent.preventDefault(t)}},_onTouchEnd:function(){return this._moved&&this._zooming?(this._zooming=!1,c.Util.cancelAnimFrame(this._animRequest),c.DomEvent.off(s,"touchmove",this._onTouchMove).off(s,"touchend",this._onTouchEnd),void(this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom)))):void(this._zooming=!1)}}),c.Map.addInitHook("addHandler","touchZoom",c.Map.TouchZoom),c.Map.mergeOptions({tap:!0,tapTolerance:15}),c.Map.Tap=c.Handler.extend({addHooks:function(){c.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){c.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(c.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],n=e.target;this._startPos=this._newPos=new c.Point(e.clientX,e.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&c.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(c.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))},this),1e3),this._simulateEvent("mousedown",e),c.DomEvent.on(s,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),c.DomEvent.off(s,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],n=e.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&c.DomUtil.removeClass(n,"leaflet-active"),this._simulateEvent("mouseup",e),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new c.Point(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(t,e){var n=s.createEvent("MouseEvents");n._simulated=!0,e.target._simulatedClick=!0,n.initMouseEvent(t,!0,!0,r,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n)}}),c.Browser.touch&&!c.Browser.pointer&&c.Map.addInitHook("addHandler","tap",c.Map.Tap),c.Map.mergeOptions({
boxZoom:!0}),c.Map.BoxZoom=c.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){c.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){c.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(t){return!(!t.shiftKey||1!==t.which&&1!==t.button)&&(this._resetState(),c.DomUtil.disableTextSelection(),c.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),void c.DomEvent.on(s,{contextmenu:c.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=c.DomUtil.create("div","leaflet-zoom-box",this._container),c.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new c.Bounds(this._point,this._startPoint),n=e.getSize();c.DomUtil.setPosition(this._box,e.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(c.DomUtil.remove(this._box),c.DomUtil.removeClass(this._container,"leaflet-crosshair")),c.DomUtil.enableTextSelection(),c.DomUtil.enableImageDrag(),c.DomEvent.off(s,{contextmenu:c.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){setTimeout(c.bind(this._resetState,this),0);var e=new c.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),c.Map.addInitHook("addHandler","boxZoom",c.Map.BoxZoom),c.Map.mergeOptions({keyboard:!0,keyboardPanDelta:80}),c.Map.Keyboard=c.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),c.DomEvent.on(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),c.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=s.body,e=s.documentElement,n=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),r.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,n,i=this._panKeys={},o=this.keyCodes;for(e=0,n=o.left.length;e<n;e++)i[o.left[e]]=[-1*t,0];for(e=0,n=o.right.length;e<n;e++)i[o.right[e]]=[t,0];for(e=0,n=o.down.length;e<n;e++)i[o.down[e]]=[0,t];for(e=0,n=o.up.length;e<n;e++)i[o.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,n,i=this._zoomKeys={},o=this.keyCodes;for(e=0,n=o.zoomIn.length;e<n;e++)i[o.zoomIn[e]]=t;for(e=0,n=o.zoomOut.length;e<n;e++)i[o.zoomOut[e]]=-t},_addHooks:function(){c.DomEvent.on(s,"keydown",this._onKeyDown,this)},_removeHooks:function(){c.DomEvent.off(s,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,n=t.keyCode,i=this._map;if(n in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;e=this._panKeys[n],t.shiftKey&&(e=c.point(e).multiplyBy(3)),i.panBy(e),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else if(n in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n)return;i.closePopup()}c.DomEvent.stop(t)}}}),c.Map.addInitHook("addHandler","keyboard",c.Map.Keyboard),c.Handler.MarkerDrag=c.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new c.Draggable(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),c.DomUtil.addClass(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&c.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(t){var e=this._marker,n=e._shadow,i=c.DomUtil.getPosition(e._icon),o=e._map.layerPointToLatLng(i);n&&c.DomUtil.setPosition(n,i),e._latlng=o,t.latlng=o,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),c.Control=c.Class.extend({options:{position:"topright"},initialize:function(t){c.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),n=this.getPosition(),i=t._controlCorners[n];return c.DomUtil.addClass(e,"leaflet-control"),n.indexOf("bottom")!==-1?i.insertBefore(e,i.firstChild):i.appendChild(e),this},remove:function(){return this._map?(c.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),c.control=function(t){return new c.Control(t)},c.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,o){var r=n+t+" "+n+o;e[t+o]=c.DomUtil.create("div",r,i)}var e=this._controlCorners={},n="leaflet-",i=this._controlContainer=c.DomUtil.create("div",n+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){c.DomUtil.remove(this._controlContainer)}}),c.Control.Zoom=c.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",n=c.DomUtil.create("div",e+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,e+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,e+"-out",n,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,n,i,o){var r=c.DomUtil.create("a",n,i);return r.innerHTML=t,r.href="#",r.title=e,r.setAttribute("role","button"),r.setAttribute("aria-label",e),c.DomEvent.on(r,"mousedown dblclick",c.DomEvent.stopPropagation).on(r,"click",c.DomEvent.stop).on(r,"click",o,this).on(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";c.DomUtil.removeClass(this._zoomInButton,e),c.DomUtil.removeClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&&c.DomUtil.addClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&&c.DomUtil.addClass(this._zoomInButton,e)}}),c.Map.mergeOptions({zoomControl:!0}),c.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new c.Control.Zoom,this.addControl(this.zoomControl))}),c.control.zoom=function(t){return new c.Control.Zoom(t)},c.Control.Attribution=c.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){c.setOptions(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=c.DomUtil.create("div","leaflet-control-attribution"),c.DomEvent&&c.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var n=[];this.options.prefix&&n.push(this.options.prefix),t.length&&n.push(t.join(", ")),this._container.innerHTML=n.join(" | ")}}}),c.Map.mergeOptions({attributionControl:!0}),c.Map.addInitHook(function(){this.options.attributionControl&&(new c.Control.Attribution).addTo(this)}),c.control.attribution=function(t){return new c.Control.Attribution(t)},c.Control.Scale=c.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",n=c.DomUtil.create("div",e),i=this.options;return this._addScales(i,e+"-line",n),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),n},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=c.DomUtil.create("div",e,n)),t.imperial&&(this._iScale=c.DomUtil.create("div",e,n))},_update:function(){var t=this._map,e=t.getSize().y/2,n=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(n)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},_updateImperial:function(t){var e,n,i,o=3.2808399*t;o>5280?(e=o/5280,n=this._getRoundNum(e),this._updateScale(this._iScale,n+" mi",n/e)):(i=this._getRoundNum(o),this._updateScale(this._iScale,i+" ft",i/o))},_updateScale:function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n}}),c.control.scale=function(t){return new c.Control.Scale(t)},c.Control.Layers=c.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,n,i){return n<i?-1:i<n?1:0}},initialize:function(t,e,n){c.setOptions(this,n),this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var i in t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){return this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this),this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(c.stamp(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){c.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._form.clientHeight?(c.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=t+"px"):c.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return c.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=c.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),c.DomEvent.disableClickPropagation(e),c.Browser.touch||c.DomEvent.disableScrollPropagation(e);var n=this._form=c.DomUtil.create("form",t+"-list");c.Browser.android||c.DomEvent.on(e,{mouseenter:this.expand,mouseleave:this.collapse},this);var i=this._layersLink=c.DomUtil.create("a",t+"-toggle",e);i.href="#",i.title="Layers",c.Browser.touch?c.DomEvent.on(i,"click",c.DomEvent.stop).on(i,"click",this.expand,this):c.DomEvent.on(i,"focus",this.expand,this),c.DomEvent.on(n,"click",function(){setTimeout(c.bind(this._onInputClick,this),0)},this),this._map.on("click",this.collapse,this),this.options.collapsed||this.expand(),this._baseLayersList=c.DomUtil.create("div",t+"-base",n),this._separator=c.DomUtil.create("div",t+"-separator",n),this._overlaysList=c.DomUtil.create("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&c.stamp(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,n){t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(c.bind(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;c.DomUtil.empty(this._baseLayersList),c.DomUtil.empty(this._overlaysList);var t,e,n,i,o=0;for(n=0;n<this._layers.length;n++)i=this._layers[n],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,o+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&o>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(c.stamp(t.target)),n=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this._map.fire(n,e)},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",i=s.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(t){var e,n=s.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?(e=s.createElement("input"),e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=i):e=this._createRadioElement("leaflet-base-layers",i),e.layerId=c.stamp(t.layer),c.DomEvent.on(e,"click",this._onInputClick,this);var o=s.createElement("span");o.innerHTML=" "+t.name;var r=s.createElement("div");n.appendChild(r),r.appendChild(e),r.appendChild(o);var a=t.overlay?this._overlaysList:this._baseLayersList;return a.appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var t,e,n,i=this._form.getElementsByTagName("input"),o=[],r=[];this._handlingClick=!0;for(var s=i.length-1;s>=0;s--)t=i[s],e=this._getLayer(t.layerId).layer,n=this._map.hasLayer(e),t.checked&&!n?o.push(e):!t.checked&&n&&r.push(e);for(s=0;s<r.length;s++)this._map.removeLayer(r[s]);for(s=0;s<o.length;s++)this._map.addLayer(o[s]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,n=this._form.getElementsByTagName("input"),i=this._map.getZoom(),o=n.length-1;o>=0;o--)t=n[o],e=this._getLayer(t.layerId).layer,t.disabled=e.options.minZoom!==a&&i<e.options.minZoom||e.options.maxZoom!==a&&i>e.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),c.control.layers=function(t,e,n){return new c.Control.Layers(t,e,n)}}(window,document)},function(t,e,n){"use strict";var i=n(1),o=n(3),r=n(4),s=i.latLng(23.433333,360*Math.random()-180),a=2,u=o.$id("map");u.textContent="";var c=i.map(u,{center:s,zoom:a,worldCopyJump:!0,trackResize:!1});c.doubleClickZoom.disable(),u.addEventListener("resize",function(){return c.invalidateSize(!0)}),/\bAppleWebKit\b/.test(navigator.userAgent)||r.listenOnce(u,"resize",function(){return c.fitWorld()}),Object.defineProperty(e,"__esModule",{value:!0}),e.default=c},function(t,e){"use strict";function n(t){return document.getElementById(t)}function i(t){return[].slice.call(document.querySelectorAll(t))}function o(t,e){return"string"==typeof t?document.querySelector(t):t.querySelector(e)}function r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.className+=" "+e.join(" "),t}function s(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.className=t.className.replace(new RegExp("\\b("+e.join("|")+")\\b","g"),""),t}function a(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0,o=e;i<o.length;i++){var a=o[i];new RegExp("\\b"+a+"\\b").test(t.className)?s(t,a):r(t,a)}return t}e.$id=n,e.$all=i,e.$sel=o,e.$addClass=r,e.$removeClass=s,e.$toggleClass=a},function(t,e,n){"use strict";function i(t,e,n,i){var o=function(){t instanceof a?(t.removeEventListener(e,o),n.apply(this,arguments)):(t.removeEventListener(e,o),"function"==typeof n?n.apply(this,arguments):n.handleEvent.call(this,arguments))};t instanceof a?t.addEventListener(e,o):t.addEventListener(e,o,i)}var o=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},r=n(56),s=function(){function t(t,e){this.defaultPrevented=!1,this.type=t,this.cancelable=e&&e.cancelable||!1,this.detail=e&&e.detail}return t.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},t}();e.SimpleEvent=s;var a=function(){function t(){this.eventListeners={}}return t.prototype.addEventListener=function(t,e){void 0===this.eventListeners[t]&&(this.eventListeners[t]=[]),this.eventListeners[t].push(e)},t.prototype.removeEventListener=function(t,e){var n=this.eventListeners[t];if(null!=n){var i=n.indexOf(e);i!==-1&&delete n[i]}},t.prototype.dispatchEvent=function(t){var e=this;return t.target=this,(this.eventListeners[t.type]||[]).forEach(function(n){return n.call(e,t)}),!t.defaultPrevented},t}();e.SimpleEventTarget=a;var u=function(t){function e(){var e=t.apply(this,arguments)||this;return e.eventBuffer=new r.default,e.eventDispatchPaused=null,e}return o(e,t),e.prototype.addEventListener=function(e,n){if(t.prototype.addEventListener.call(this,e,n),null===this.eventDispatchPaused&&1===this.eventListeners[e].length){for(var i=new r.default,o=this.eventBuffer.dequeue();null!=o;o=this.eventBuffer.dequeue())o.type===e?t.prototype.dispatchEvent.call(this,o):i.enqueue(o);this.eventBuffer=i}},e.prototype.dispatchEvent=function(e){return this.eventDispatchPaused!==!0&&e.type in this.eventListeners&&0!==this.eventListeners[e.type].length?t.prototype.dispatchEvent.call(this,e):(this.eventBuffer.enqueue(e),null)},e.prototype.pauseEventDispatch=function(){this.eventDispatchPaused=!0},e.prototype.resumeEventDispatch=function(){for(var e=this.eventBuffer.dequeue();null!=e;e=this.eventBuffer.dequeue())t.prototype.dispatchEvent.call(this,e);this.eventDispatchPaused=!1},e}(a);e.PausableEventTarget=u,e.listenOnce=i},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=n(7),s=(i(r),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this.options=e}return s(t,[{key:"getParamString",value:function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}},{key:"search",value:function(t){return new Promise(function(e,n){var i,o,r,s,a;return i=t.query,o=~location.protocol.indexOf("http")?location.protocol:"https:",r=this.endpoint({query:i,protocol:o}),fetch(r).then(function(t){return s=t,s.json().then(function(t){return a=t,e(this.parse({data:a}))}.$asyncbind(this,n),n)}.$asyncbind(this,n),n)}.$asyncbind(this))}}]),t}();e.default=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=e.createElement=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=document.createElement(t);return i.className=e,n&&n.appendChild(i),i};e.createScriptElement=function(t,e){var i=n("script",null,document.body);return i.setAttribute("type","text/javascript"),new Promise(function(n){window[e]=function(t){i.remove(),delete window[e],n(t)},i.setAttribute("src",t)})},e.addClassName=function(t,e){t&&!t.classList.contains(e)&&t.classList.add(e)},e.removeClassName=function(t,e){t&&t.classList.contains(e)&&t.classList.remove(e)}},function(t,e,n){"use strict";function i(t,e){for(var n=e.toString(),i="return "+n,o=n.match(/.*\(([^)]*)\)/)[1],r=/['"]!!!([^'"]*)['"]/g,s=[];;){var a=r.exec(i);if(!a)break;s.push(a)}return s.reverse().forEach(function(e){i=i.slice(0,e.index)+t[e[1]]+i.substr(e.index+e[0].length)}),i=i.replace(/\/\*[^*]*\*\//g," ").replace(/\s+/g," "),new Function(o,i)()}function o(t,e){if(Function.prototype.$asyncspawn||Object.defineProperty(Function.prototype,"$asyncspawn",{value:o,enumerable:!1,configurable:!0,writable:!0}),this instanceof Function){var n=this;return new t(function(t,i){function o(e,n){var s;try{if(s=e.call(r,n),s.done){if(s.value!==t){if(s.value&&s.value===s.value.then)return s.value(t,i);t&&t(s.value),t=null}return}s.value.then?s.value.then(function(t){o(r.next,t)},function(t){o(r.throw,t)}):o(r.next,s.value)}catch(t){return i&&i(t),void(i=null)}}var r=n.call(e,t,i);o(r.next)})}}var r=i({zousan:n(40).toString(),thenable:n(39).toString()},function t(e,n){function i(){return o.apply(e,arguments)}Function.prototype.$asyncbind||Object.defineProperty(Function.prototype,"$asyncbind",{value:t,enumerable:!1,configurable:!0,writable:!0}),t.trampoline||(t.trampoline=function(t,e,n,i,o){return function r(s){for(;s;){if(s.then)return s=s.then(r,i),o?void 0:s;try{if(s.pop){if(s.length)return s.pop()?e.call(t):s;s=n}else s=s.call(t)}catch(t){return i(t)}}}}),t.LazyThenable||(t.LazyThenable="!!!thenable"(),t.EagerThenable=t.Thenable=(t.EagerThenableFactory="!!!zousan")());var o=this;switch(n){case!0:return new t.Thenable(i);case 0:return new t.LazyThenable(i);case void 0:return i.then=i,i;default:return function(){try{return o.apply(e,arguments)}catch(t){return n(t)}}}});r(),o(),t.exports={$asyncbind:r,$asyncspawn:o}},function(t,e,n){"use strict";function i(t){if(u!==a)throw new Error("data: database backend can only be set once");u=t}function o(t,n,i){u.syncUserLocation.apply(e.users,arguments)}function r(){u.fetchUsers.apply(e.users,arguments)}var s=n(16),a={syncUserLocation:function(){throw new Error("data: database backend not defined")},fetchUsers:function(){throw new Error("data: database backend not defined")}};e.users=new s.UserCollection;var u=a;e.setBackend=i,e.syncUserLocation=o,e.fetchUsers=r},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function r(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){m&&f&&(m=!1,f.length?p=f.concat(p):_=-1,p.length&&a())}function a(){if(!m){var t=o(s);m=!0;for(var e=p.length;e;){for(f=p,p=[];++_<e;)f&&f[_].run();_=-1,e=p.length}f=null,m=!1,r(t)}}function u(t,e){this.fun=t,this.array=e}function c(){}var l,h,d=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(t){l=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var f,p=[],m=!1,_=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new u(t,e)),1!==p.length||m||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e){"use strict";function n(t,e){for(var n="",i=0;i<e;++i)n+=t;return n}function i(t,e){return t.replace(/^(\t+)/,function(t,i){return n(" ",e*i.length)})}function o(t){return t.replace(/^\s+/,"")}function r(t){return t.replace(/\s+$/,"")}function s(t){return t.trim()}function a(t,e,n,a){if(void 0===n&&(n="\n"),void 0===a&&(a=!0),""===t.trim())return"";var u=t.split(/\r?\n/),c=[];void 0!==e&&(u[0]=i(u[0],e)),c.push(a?s(u[0]):o(u[0]));for(var l=+(1/0),h=1;h<u.length;++h){void 0!==e&&(u[h]=i(u[h],e));var d=o(u[h]);d.length>1&&(l=Math.min(l,u[h].length-d.length))}for(var h=1;h<u.length;++h){var f=u[h].substr(l);c.push(a?r(f):f)}for(;c.length>0&&0===c[0].length;)c.shift();for(;c.length>0&&0===c[c.length-1].length;)c.pop();return c.join(n)}e.repeatString=n,e.expandLeadingTabs=i,e.trimStart=o,e.trimEnd=r,e.trim=s,e.trimIndent=a},function(t,e){(function(e){"use strict";function n(){l=!0;for(var t,e,n=h.length;n;){for(e=h,h=[],t=-1;++t<n;)e[t]();n=h.length}l=!1}function i(t){1!==h.push(t)||l||o()}var o,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var s=0,a=new r(n),u=e.document.createTextNode("");a.observe(u,{characterData:!0}),o=function(){u.data=s=++s%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)o="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var c=new e.MessageChannel;c.port1.onmessage=n,o=function(){c.port2.postMessage(0)}}var l,h=[];t.exports=i}).call(e,function(){return this}())},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=e.ENTER_KEY=13,i=e.ESCAPE_KEY=27,o=e.ARROW_DOWN_KEY=40,r=e.ARROW_UP_KEY=38,s=e.ARROW_LEFT_KEY=37,a=e.ARROW_RIGHT_KEY=39;e.SPECIAL_KEYS=[n,i,o,r,s,a]},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=n(7),s=(i(r),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),a=n(6),u=n(12),c=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.handleSubmit,r=void 0===i?function(){}:i,s=n.searchLabel,u=void 0===s?"search":s,c=n.classNames,l=void 0===c?{}:c;o(this,t);var h=(0,a.createElement)("div",["geosearch",l.container].join(" ")),d=(0,a.createElement)("form",["",l.form].join(" "),h),f=(0,a.createElement)("input",["glass",l.input].join(" "),d);f.type="text",f.placeholder=u,f.addEventListener("input",function(t){e.onInput(t)},!1),f.addEventListener("keyup",function(t){e.onKeyUp(t)},!1),f.addEventListener("keypress",function(t){e.onKeyPress(t)},!1),f.addEventListener("focus",function(t){e.onFocus(t)},!1),f.addEventListener("blur",function(t){e.onBlur(t)},!1),this.elements={container:h,form:d,input:f},this.handleSubmit=r}return s(t,[{key:"onFocus",value:function(){(0,a.addClassName)(this.elements.form,"active")}},{key:"onBlur",value:function(){(0,a.removeClassName)(this.elements.form,"active")}},{key:"onSubmit",value:function(t){return new Promise(function(e,n){var i,o,r;return t.preventDefault(),t.stopPropagation(),i=this.elements,o=i.input,r=i.container,(0,a.removeClassName)(r,"error"),(0,a.addClassName)(r,"pending"),this.handleSubmit({query:o.value}).then(function(t){return(0,a.removeClassName)(r,"pending"),e()}.$asyncbind(this,n),n)}.$asyncbind(this))}},{key:"onInput",value:function(){var t=this.elements.container;this.hasError&&((0,a.removeClassName)(t,"error"),this.hasError=!1)}},{key:"onKeyUp",value:function(t){var e=this.elements,n=e.container,i=e.input;t.keyCode===u.ESCAPE_KEY&&((0,a.removeClassName)(n,"pending"),(0,a.removeClassName)(n,"active"),i.value="",document.body.focus(),document.body.blur())}},{key:"onKeyPress",value:function(t){t.keyCode===u.ENTER_KEY&&this.onSubmit(t)}},{key:"setQuery",value:function(t){var e=this.elements.input;e.value=t}}]),t}();e.default=c},function(t,e){(function(e){function n(t,e,n){function o(e){var n=m,i=_;return m=_=void 0,E=e,g=t.apply(i,n)}function r(t){return E=t,y=setTimeout(l,e),C?o(t):g}function u(t){var n=t-x,i=t-E,o=e-n;return S?w(o,v-i):o}function c(t){var n=t-x,i=t-E;return void 0===x||n>=e||n<0||S&&i>=v}function l(){var t=L();return c(t)?h(t):void(y=setTimeout(l,u(t)))}function h(t){return y=void 0,T&&m?o(t):(m=_=void 0,g)}function d(){void 0!==y&&clearTimeout(y),E=0,m=x=_=y=void 0}function f(){return void 0===y?g:h(L())}function p(){var t=L(),n=c(t);if(m=arguments,_=this,x=t,n){if(void 0===y)return r(x);if(S)return y=setTimeout(l,e),o(x)}return void 0===y&&(y=setTimeout(l,e)),g}var m,_,v,g,y,x,E=0,C=!1,S=!1,T=!0;if("function"!=typeof t)throw new TypeError(a);return e=s(e)||0,i(n)&&(C=!!n.leading,S="maxWait"in n,v=S?b(s(n.maxWait)||0,e):v,T="trailing"in n?!!n.trailing:T),p.cancel=d,p.flush=f,p}function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function o(t){return!!t&&"object"==typeof t}function r(t){return"symbol"==typeof t||o(t)&&y.call(t)==c}function s(t){if("number"==typeof t)return t;if(r(t))return u;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(l,"");var n=d.test(t);return n||f.test(t)?p(t.slice(2),n?2:8):h.test(t)?u:+t}var a="Expected a function",u=NaN,c="[object Symbol]",l=/^\s+|\s+$/g,h=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,f=/^0o[0-7]+$/i,p=parseInt,m="object"==typeof e&&e&&e.Object===Object&&e,_="object"==typeof self&&self&&self.Object===Object&&self,v=m||_||Function("return this")(),g=Object.prototype,y=g.toString,b=Math.max,w=Math.min,L=function(){return v.Date.now()};t.exports=n}).call(e,function(){return this}())},function(t,e,n){"use strict";e.dbUrl="https://ottermap.chirpingmustard.com/db/ottermap";var i=n(49);e.default=i.default},function(t,e,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=n(1),r=n(4),s=27e4,a=function(t){function e(e){
var n=t.call(this)||this;return n.username=e,n.addEventListener("lastaccesschange",n.updateStatusFromLastAccess),n}return i(e,t),e.prototype.updateProperty=function(t,e,n){var i=this[t];this[t]=e,this.dispatchEvent(new r.SimpleEvent(n,{detail:{oldValue:i,newValue:e}}))},e.prototype.setLocation=function(t){function e(e){return"lat"in t&&"lng"in t}var n=e(t)?o.latLng(t.lat,t.lng):o.latLng(t);null!=this.location&&n.equals(this.location)||this.updateProperty("location",n,"locationchange")},e.prototype.setStatus=function(t){null!=this.status&&t===this.status||this.updateProperty("status",t,"statuschange")},e.prototype.setLastAccessTimestamp=function(t){null!=this.lastAccess&&t.getTime()===this.lastAccess.getTime()||this.updateProperty("lastAccess",t,"lastaccesschange")},e.prototype.unsetLastAccessTimestamp=function(){null!=this.lastAccess&&this.updateProperty("lastAccess",null,"lastaccesschange")},e.prototype.updateStatusFromLastAccess=function(){null==this.lastAccess?this.setStatus(null):Date.now()-this.lastAccess.getTime()<=s?this.setStatus("online"):this.setStatus("offline")},e}(r.PausableEventTarget);e.User=a;var u=function(t){function e(){var e=t.call(this)||this;return e.data=[],e}return i(e,t),e.prototype.addUser=function(t){this.data.push(t),this.dispatchEvent(new r.SimpleEvent("useradd",{detail:t}))},e.prototype.removeUser=function(t){var e=this.data.indexOf(t);return e>-1&&(delete this.data[e],this.dispatchEvent(new r.SimpleEvent("userdel",{detail:t})),t.dispatchEvent(new r.SimpleEvent("unperson")),!0)},e.prototype.select=function(t){return void 0===t&&(t=function(){return!0}),this.data.filter(t)},e}(r.PausableEventTarget);e.UserCollection=u},function(t,e,n){"use strict";function i(t){var e=s.marker(u.default.getCenter(),{icon:new s.Icon.Default,draggable:!0,title:t}).addTo(u.default);return u.default.addEventListener("click",function(t){return e.setLatLng(t.latlng)}),e}function o(t){u.default.removeLayer(t)}var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},s=n(1),a=n(27),u=n(2),c=n(3),l=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype.onAdd=function(){var e=t.prototype.onAdd.apply(this,arguments),n=c.$sel(e,"a.leaflet-bar-part");return e.setAttribute("aria-haspopup","true"),n.innerHTML='<span class="glyphicon glyphicon-road"/>',n.title="Search by address",e},e}(a.GeoSearchControl);u.default.addControl(new l({provider:new a.OpenStreetMapProvider,style:"button",showMarker:!1})),e.placeUserMarker=i,e.removeUserMarker=o},function(t,e,n){"use strict";function i(t,e){null!=e&&(e="alert-"+e),r=e,s.$addClass(a,e),s.$sel(a,"p").textContent=t,s.$removeClass(a,"invisible","mb-hide")}function o(){s.$addClass(a,"mb-hide"),CSSAnimEvent.onTransitionEnd(a,function(){s.$addClass(a,"invisible"),s.$removeClass(a,r)})}n(58);var r,s=n(3),a=s.$id("messagebar");s.$sel(a,"button.close").addEventListener("click",o),e.show=i,e.hide=o},function(t,e){"use strict";function n(t){return function(){var e=arguments.length;if(e){for(var n=[],i=-1;++i<e;)n[i]=arguments[i];return t.call(this,n)}return t.call(this,[])}}t.exports=n},function(t,e,n){(function(i){function o(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function r(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var i="color: "+this.color;t=[t[0],i,"color: inherit"].concat(Array.prototype.slice.call(t,1));var o=0,r=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(r=o))}),t.splice(r,0,i),t}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}}function u(){var t;try{t=e.storage.debug}catch(t){}return"env"in("undefined"==typeof i?{}:i)&&(t=i.env.DEBUG),t}function c(){try{return window.localStorage}catch(t){}}e=t.exports=n(21),e.log=s,e.formatArgs=r,e.save=a,e.load=u,e.useColors=o,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){return JSON.stringify(t)},e.enable(u())}).call(e,n(9))},function(t,e,n){function i(){return e.colors[l++%e.colors.length]}function o(t){function n(){}function o(){var t=o,n=+new Date,r=n-(c||n);t.diff=r,t.prev=c,t.curr=n,c=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=i());for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var u=0;s[0]=s[0].replace(/%([a-z%])/g,function(n,i){if("%%"===n)return n;u++;var o=e.formatters[i];if("function"==typeof o){var r=s[u];n=o.call(t,r),s.splice(u,1),u--}return n}),s=e.formatArgs.apply(t,s);var l=o.log||e.log||console.log.bind(console);l.apply(t,s)}n.enabled=!1,o.enabled=!0;var r=e.enabled(t)?o:n;return r.namespace=t,r}function r(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),i=n.length,o=0;o<i;o++)n[o]&&(t=n[o].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,i;for(n=0,i=e.skips.length;n<i;n++)if(e.skips[n].test(t))return!1;for(n=0,i=e.names.length;n<i;n++)if(e.names[n].test(t))return!0;return!1}function u(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o.debug=o,e.coerce=u,e.disable=s,e.enable=r,e.enabled=a,e.humanize=n(38),e.names=[],e.skips=[],e.formatters={};var c,l=0},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function o(t){return"number"==typeof t}function r(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,a,u,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(n=this._events[t],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(r(n))for(a=Array.prototype.slice.call(arguments,1),c=n.slice(),o=c.length,u=0;u<o;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(t,e){var o;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var o=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,o,s,a;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,o=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(n)){for(a=s;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){t.exports="../img/marker-icon-2x.png"},function(t,e){t.exports="../img/marker-icon.png"},function(t,e){t.exports="../img/marker-shadow.png"},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(28);Object.defineProperty(e,"GeoSearchControl",{enumerable:!0,get:function(){return i(o).default}});var r=n(13);Object.defineProperty(e,"SearchElement",{enumerable:!0,get:function(){return i(r).default}});var s=n(29);Object.defineProperty(e,"BingProvider",{enumerable:!0,get:function(){return i(s).default}});var a=n(30);Object.defineProperty(e,"EsriProvider",{enumerable:!0,get:function(){return i(a).default}});var u=n(31);Object.defineProperty(e,"GoogleProvider",{enumerable:!0,get:function(){return i(u).default}});var c=n(32);Object.defineProperty(e,"OpenStreetMapProvider",{enumerable:!0,get:function(){return i(c).default}});var l=n(5);Object.defineProperty(e,"Provider",{enumerable:!0,get:function(){return i(l).default}})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(7),r=(i(o),Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),s=n(14),a=i(s),u=n(13),c=i(u),l=n(33),h=i(l),d=n(6),f=n(12),p=function(){return{position:"topleft",style:"button",showMarker:!0,showPopup:!1,marker:{icon:new L.Icon.Default,draggable:!1},maxMarkers:1,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",msgbox:"leaflet-bar message",form:"",input:""},autoComplete:!0,autoCompleteDelay:250}};e.default=L.Control.extend({initialize:function(t){var e=this;this.markers=new L.FeatureGroup,this.options=r({},p(),t);var n=this.options,i=n.style,o=n.classNames,s=n.searchLabel,u=n.autoComplete,l=n.autoCompleteDelay;"button"!==i&&(this.options.classNames.container+=" "+t.style),this.searchElement=new c.default(r({},this.options,{handleSubmit:function(t){return e.onSubmit(t)}}));var f=this.searchElement.elements,m=f.container,_=f.form,v=f.input;m.addEventListener("dblclick",function(t){t.stopPropagation()});var g=(0,d.createElement)("a",o.button,m);g.title=s,g.href="#",g.addEventListener("click",function(t){e.onClick(t)},!1),u&&(this.resultList=new h.default({handleClick:function(t){var n=t.result;v.value=n.label,e.onSubmit({query:n.label})}}),_.appendChild(this.resultList.elements.container),v.addEventListener("keyup",(0,a.default)(function(t){return e.autoSearch(t)},l),!0),v.addEventListener("keydown",function(t){return e.selectResult(t)},!0),v.addEventListener("keydown",function(t){return e.clearResults(t)},!0)),this.elements={button:g}},onAdd:function(t){var e=this.options,n=e.showMarker,i=e.style;if(this.map=t,n&&this.markers.addTo(t),"bar"===i){var o=this.searchElement.elements.form,r=t.getContainer().querySelector(".leaflet-control-container"),s=(0,d.createElement)("div","leaflet-control-geosearch bar");s.appendChild(o),r.appendChild(s),this.elements.container=s}return this.searchElement.elements.container},onRemove:function(){var t=this.elements.container;return t&&t.remove(),this},onClick:function(t){t.preventDefault();var e=this.searchElement.elements,n=e.container,i=e.input;n.classList.contains("active")?(0,d.removeClassName)(n,"active"):((0,d.addClassName)(n,"active"),i.focus())},selectResult:function(t){if([f.ARROW_DOWN_KEY,f.ARROW_UP_KEY].includes(t.keyCode)){t.preventDefault();var e=this.searchElement.elements.input,n=this.resultList,i=this.resultList.count()-1,o="ArrowDown"===t.code?~~n.selected+1:~~n.selected-1,r=o<0?i:o>i?0:o,s=n.select(r);e.value=s.label}},clearResults:function(t){t.keyCode===f.ESCAPE_KEY&&this.resultList.clear()},autoSearch:function(t){return new Promise(function(e,n){var i,o,r;return f.SPECIAL_KEYS.includes(t.keyCode)?e():(i=t.target.value,o=this.options.provider,o.search({query:i}).then(function(t){return r=t,this.resultList.render(r),e()}.$asyncbind(this,n),n))}.$asyncbind(this))},onSubmit:function(t){return new Promise(function(e,n){var i,o;return i=this.options.provider,i.search(t).then(function(t){return o=t,o&&o.length>0&&this.showResult(o[0]),e()}.$asyncbind(this,n),n)}.$asyncbind(this))},showResult:function(t){var e=Object.keys(this.markers._layers);e.length>=this.options.maxMarkers&&this.markers.removeLayer(e[0]);var n=this.addMarker(t);this.centerMap(t),this.map.fireEvent("geosearch/showlocation",{location:t,marker:n})},addMarker:function(t){var e=this.options,n=e.marker,i=e.showPopup,o=new L.Marker([t.y,t.x],n);return o.bindPopup(t.label),this.markers.addLayer(o),i&&o.openPopup(),o},centerMap:function(t){var e=this.options,n=e.retainZoomLevel,i=e.animateZoom,o=new L.LatLngBounds(t.bounds),r=o.isValid()?o:this.markers.getBounds();!n&&o.isValid()?this.map.fitBounds(r,{animate:i}):this.map.setView(r.getCenter(),this.getZoom(),{animate:i})},getZoom:function(){var t=this.options,e=t.retainZoomLevel,n=t.zoomLevel;return e?this.map.getZoom():n}})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=n(7),u=(i(a),Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(5),h=i(l),d=n(6),f=function(t){function e(){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),c(e,[{key:"endpoint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.query,n=t.protocol,i=t.jsonp,o=this.options.params,r=this.getParamString(u({},o,{query:e,jsonp:i}));return n+"//dev.virtualearth.net/REST/v1/Locations?"+r}},{key:"parse",value:function(t){var e=t.data;return 0===e.resourceSets.length?[]:e.resourceSets[0].resources.map(function(t){return{x:t.point.coordinates[1],y:t.point.coordinates[0],label:t.address.formattedAddress,bounds:[[t.bbox[0],t.bbox[1]],[t.bbox[2],t.bbox[3]]],raw:t}})}},{key:"search",value:function(t){return new Promise(function(e,n){var i,o,r,s,a;return i=t.query,o=~location.protocol.indexOf("http")?location.protocol:"https:",r="BING_JSONP_CB_"+Date.now(),s=this.endpoint({query:i,protocol:o,jsonp:r}),(0,d.createScriptElement)(s,r).then(function(t){return a=t,e(this.parse({data:a}))}.$asyncbind(this,n),n)}.$asyncbind(this))}}]),e}(h.default);e.default=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(5),l=i(c),h=function(t){function e(){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),u(e,[{key:"endpoint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.query,n=t.protocol,i=this.options.params,o=this.getParamString(a({},i,{f:"json",text:e}));return n+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find?"+o}},{key:"parse",value:function(t){var e=t.data;return e.locations.map(function(t){return{x:t.feature.geometry.x,y:t.feature.geometry.y,label:t.name,bounds:[[t.extent.ymin,t.extent.xmin],[t.extent.ymax,t.extent.xmax]],raw:t}})}}]),e}(l.default);e.default=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(5),l=i(c),h=function(t){function e(){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),u(e,[{key:"endpoint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.query,n=t.protocol,i=this.options.params,o=this.getParamString(a({},i,{address:e})),r=i&&i.key?"https:":n;return r+"//maps.googleapis.com/maps/api/geocode/json?"+o}},{key:"parse",value:function(t){var e=t.data;return e.results.map(function(t){return{x:t.geometry.location.lng,y:t.geometry.location.lat,label:t.formatted_address,bounds:[[t.geometry.viewport.southwest.lat,t.geometry.viewport.southwest.lng],[t.geometry.viewport.northeast.lat,t.geometry.viewport.northeast.lng]],raw:t}})}}]),e}(l.default);e.default=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(5),l=i(c),h=function(t){function e(){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),u(e,[{key:"endpoint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.query,n=t.protocol,i=this.options.params,o=this.getParamString(a({},i,{format:"json",q:e}));return n+"//nominatim.openstreetmap.org/search?"+o}},{key:"parse",value:function(t){var e=t.data;return e.map(function(t){return{x:t.lon,y:t.lat,label:t.display_name,bounds:[[parseFloat(t.boundingbox[0]),parseFloat(t.boundingbox[2])],[parseFloat(t.boundingbox[1]),parseFloat(t.boundingbox[3])]],raw:t}})}}]),e}(l.default);e.default=h},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=n(6),s=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.join(" ").trim()},a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.handleClick,o=void 0===n?function(){}:n,a=e.classNames,c=void 0===a?{}:a;i(this,t),u.call(this),this.props={handleClick:o,classNames:c},this.selected=-1;var l=(0,r.createElement)("div",s("results",c.container)),h=(0,r.createElement)("div",s(c.item));l.addEventListener("click",this.onClick,!0),this.elements={container:l,resultItem:h}}return o(t,[{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.elements,n=e.container,i=e.resultItem;this.clear(),t.forEach(function(t,e){var o=i.cloneNode(!0);o.setAttribute("data-key",e),o.innerHTML=t.label,n.appendChild(o)}),t.length>0&&(0,r.addClassName)(n,"active"),this.results=t}},{key:"select",value:function(t){var e=this.elements.container;return Array.from(e.children).forEach(function(e,n){return n===t?(0,r.addClassName)(e,"active"):(0,r.removeClassName)(e,"active")}),this.selected=t,this.results[t]}},{key:"count",value:function(){return this.results.length}},{key:"clear",value:function(){var t=this.elements.container;for(this.selected=-1;t.lastChild;)t.removeChild(t.lastChild);(0,r.removeClassName)(t,"active")}}]),t}(),u=function(){var t=this;this.onClick=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.target,i=t.props.handleClick,o=t.elements.container;if(n.parentNode===o&&n.hasAttribute("data-key")){var r=n.getAttribute("data-key"),s=t.results[r];i({result:s})}}};e.default=a},function(t,e,n){var i,o,r;!function(s,a){o=[n(1)],i=a,r="function"==typeof i?i.apply(e,o):i,!(void 0!==r&&(t.exports=r))}(this,function(t){"use strict";return t.TileLayer.Provider=t.TileLayer.extend({initialize:function(e,n){var i=t.TileLayer.Provider.providers,o=e.split("."),r=o[0],s=o[1];if(!i[r])throw"No such provider ("+r+")";var a={url:i[r].url,options:i[r].options};if(s&&"variants"in i[r]){if(!(s in i[r].variants))throw"No such variant of "+r+" ("+s+")";var u,c=i[r].variants[s];u="string"==typeof c?{variant:c}:c.options,a={url:c.url||a.url,options:t.Util.extend({},a.options,u)}}var l="file:"===window.location.protocol||a.options.forceHTTP;0===a.url.indexOf("//")&&l&&(a.url="http:"+a.url),a.options.retina&&(n.detectRetina&&t.Browser.retina?n.detectRetina=!1:a.options.retina="");var h=function(t){return t.indexOf("{attribution.")===-1?t:t.replace(/\{attribution.(\w*)\}/,function(t,e){return h(i[e].options.attribution)})};a.options.attribution=h(a.options.attribution);var d=t.Util.extend({},a.options,n);t.TileLayer.prototype.initialize.call(this,a.url,d)}}),t.TileLayer.Provider.providers={OpenStreetMap:{url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'},variants:{Mapnik:{},BlackAndWhite:{url:"http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",options:{maxZoom:18}},DE:{url:"http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png",options:{maxZoom:18}},France:{url:"//{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",options:{maxZoom:20,attribution:"&copy; Openstreetmap France | {attribution.OpenStreetMap}"}},HOT:{url:"//{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",options:{attribution:'{attribution.OpenStreetMap}, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'}}}},OpenSeaMap:{url:"http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",options:{attribution:'Map data: &copy; <a href="http://www.openseamap.org">OpenSeaMap</a> contributors'}},OpenTopoMap:{url:"//{s}.tile.opentopomap.org/{z}/{x}/{y}.png",options:{maxZoom:17,attribution:'Map data: {attribution.OpenStreetMap}, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},Thunderforest:{url:"//{s}.tile.thunderforest.com/{variant}/{z}/{x}/{y}.png?apikey={apikey}",options:{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, {attribution.OpenStreetMap}',variant:"cycle"},variants:{OpenCycleMap:"cycle",Transport:{options:{variant:"transport",maxZoom:19}},TransportDark:{options:{variant:"transport-dark",maxZoom:19}},SpinalMap:{options:{variant:"spinal-map",maxZoom:11}},Landscape:"landscape",Outdoors:"outdoors",Pioneer:"pioneer"}},OpenMapSurfer:{url:"http://korona.geog.uni-heidelberg.de/tiles/{variant}/x={x}&y={y}&z={z}",options:{maxZoom:20,variant:"roads",attribution:'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data {attribution.OpenStreetMap}'},variants:{Roads:"roads",AdminBounds:{options:{variant:"adminb",maxZoom:19}},Grayscale:{options:{variant:"roadsg",maxZoom:19}}}},Hydda:{url:"//{s}.tile.openstreetmap.se/hydda/{variant}/{z}/{x}/{y}.png",options:{variant:"full",attribution:'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data {attribution.OpenStreetMap}'},variants:{Full:"full",Base:"base",RoadsAndLabels:"roads_and_labels"}},MapBox:{url:"//api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",options:{attribution:'Imagery from <a href="http://mapbox.com/about/maps/">MapBox</a> &mdash; Map data {attribution.OpenStreetMap}',subdomains:"abcd"}},Stamen:{url:"//stamen-tiles-{s}.a.ssl.fastly.net/{variant}/{z}/{x}/{y}.{ext}",options:{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data {attribution.OpenStreetMap}',subdomains:"abcd",minZoom:0,maxZoom:20,variant:"toner",ext:"png"},variants:{Toner:"toner",TonerBackground:"toner-background",TonerHybrid:"toner-hybrid",TonerLines:"toner-lines",TonerLabels:"toner-labels",TonerLite:"toner-lite",Watercolor:{options:{variant:"watercolor",minZoom:1,maxZoom:16}},Terrain:{options:{variant:"terrain",minZoom:0,maxZoom:18}},TerrainBackground:{options:{variant:"terrain-background",minZoom:0,maxZoom:18}},TopOSMRelief:{options:{variant:"toposm-color-relief",ext:"jpg",bounds:[[22,-132],[51,-56]]}},TopOSMFeatures:{options:{variant:"toposm-features",bounds:[[22,-132],[51,-56]],opacity:.9}}}},Esri:{url:"//server.arcgisonline.com/ArcGIS/rest/services/{variant}/MapServer/tile/{z}/{y}/{x}",options:{variant:"World_Street_Map",attribution:"Tiles &copy; Esri"},variants:{WorldStreetMap:{options:{attribution:"{attribution.Esri} &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012"}},DeLorme:{options:{variant:"Specialty/DeLorme_World_Base_Map",minZoom:1,maxZoom:11,attribution:"{attribution.Esri} &mdash; Copyright: &copy;2012 DeLorme"}},WorldTopoMap:{options:{variant:"World_Topo_Map",attribution:"{attribution.Esri} &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"}},WorldImagery:{options:{variant:"World_Imagery",attribution:"{attribution.Esri} &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}},WorldTerrain:{options:{variant:"World_Terrain_Base",maxZoom:13,attribution:"{attribution.Esri} &mdash; Source: USGS, Esri, TANA, DeLorme, and NPS"}},WorldShadedRelief:{options:{variant:"World_Shaded_Relief",maxZoom:13,attribution:"{attribution.Esri} &mdash; Source: Esri"}},WorldPhysical:{options:{variant:"World_Physical_Map",maxZoom:8,attribution:"{attribution.Esri} &mdash; Source: US National Park Service"}},OceanBasemap:{options:{variant:"Ocean_Basemap",maxZoom:13,attribution:"{attribution.Esri} &mdash; Sources: GEBCO, NOAA, CHS, OSU, UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri"}},NatGeoWorldMap:{options:{variant:"NatGeo_World_Map",maxZoom:16,attribution:"{attribution.Esri} &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC"}},WorldGrayCanvas:{options:{variant:"Canvas/World_Light_Gray_Base",maxZoom:16,attribution:"{attribution.Esri} &mdash; Esri, DeLorme, NAVTEQ"}}}},OpenWeatherMap:{url:"http://{s}.tile.openweathermap.org/map/{variant}/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:'Map data &copy; <a href="http://openweathermap.org">OpenWeatherMap</a>',opacity:.5},variants:{Clouds:"clouds",CloudsClassic:"clouds_cls",Precipitation:"precipitation",PrecipitationClassic:"precipitation_cls",Rain:"rain",RainClassic:"rain_cls",Pressure:"pressure",PressureContour:"pressure_cntr",Wind:"wind",Temperature:"temp",Snow:"snow"}},HERE:{url:"//{s}.{base}.maps.cit.api.here.com/maptile/2.1/{type}/{mapID}/{variant}/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}",
options:{attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',subdomains:"1234",mapID:"newest",app_id:"<insert your app_id here>",app_code:"<insert your app_code here>",base:"base",variant:"normal.day",maxZoom:20,type:"maptile",language:"eng",format:"png8",size:"256"},variants:{normalDay:"normal.day",normalDayCustom:"normal.day.custom",normalDayGrey:"normal.day.grey",normalDayMobile:"normal.day.mobile",normalDayGreyMobile:"normal.day.grey.mobile",normalDayTransit:"normal.day.transit",normalDayTransitMobile:"normal.day.transit.mobile",normalNight:"normal.night",normalNightMobile:"normal.night.mobile",normalNightGrey:"normal.night.grey",normalNightGreyMobile:"normal.night.grey.mobile",basicMap:{options:{type:"basetile"}},mapLabels:{options:{type:"labeltile",format:"png"}},trafficFlow:{options:{base:"traffic",type:"flowtile"}},carnavDayGrey:"carnav.day.grey",hybridDay:{options:{base:"aerial",variant:"hybrid.day"}},hybridDayMobile:{options:{base:"aerial",variant:"hybrid.day.mobile"}},pedestrianDay:"pedestrian.day",pedestrianNight:"pedestrian.night",satelliteDay:{options:{base:"aerial",variant:"satellite.day"}},terrainDay:{options:{base:"aerial",variant:"terrain.day"}},terrainDayMobile:{options:{base:"aerial",variant:"terrain.day.mobile"}}}},FreeMapSK:{url:"http://t{s}.freemap.sk/T/{z}/{x}/{y}.jpeg",options:{minZoom:8,maxZoom:16,subdomains:"1234",bounds:[[47.204642,15.996093],[49.830896,22.576904]],attribution:'{attribution.OpenStreetMap}, vizualization CC-By-SA 2.0 <a href="http://freemap.sk">Freemap.sk</a>'}},MtbMap:{url:"http://tile.mtbmap.cz/mtbmap_tiles/{z}/{x}/{y}.png",options:{attribution:"{attribution.OpenStreetMap} &amp; USGS"}},CartoDB:{url:"http://{s}.basemaps.cartocdn.com/{variant}/{z}/{x}/{y}.png",options:{attribution:'{attribution.OpenStreetMap} &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19,variant:"light_all"},variants:{Positron:"light_all",PositronNoLabels:"light_nolabels",PositronOnlyLabels:"light_only_labels",DarkMatter:"dark_all",DarkMatterNoLabels:"dark_nolabels",DarkMatterOnlyLabels:"dark_only_labels"}},HikeBike:{url:"http://{s}.tiles.wmflabs.org/{variant}/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:"{attribution.OpenStreetMap}",variant:"hikebike"},variants:{HikeBike:{},HillShading:{options:{maxZoom:15,variant:"hillshading"}}}},BasemapAT:{url:"https://maps{s}.wien.gv.at/basemap/{variant}/normal/google3857/{z}/{y}/{x}.{format}",options:{maxZoom:19,attribution:'Datenquelle: <a href="www.basemap.at">basemap.at</a>',subdomains:["","1","2","3","4"],format:"png",bounds:[[46.35877,8.782379],[49.037872,17.189532]],variant:"geolandbasemap"},variants:{basemap:{options:{maxZoom:20,variant:"geolandbasemap"}},grau:"bmapgrau",overlay:"bmapoverlay",highdpi:{options:{variant:"bmaphidpi",format:"jpeg"}},orthofoto:{options:{maxZoom:20,variant:"bmaporthofoto30cm",format:"jpeg"}}}},NASAGIBS:{url:"//map1.vis.earthdata.nasa.gov/wmts-webmerc/{variant}/default/{time}/{tilematrixset}{maxZoom}/{z}/{y}/{x}.{format}",options:{attribution:'Imagery provided by services from the Global Imagery Browse Services (GIBS), operated by the NASA/GSFC/Earth Science Data and Information System (<a href="https://earthdata.nasa.gov">ESDIS</a>) with funding provided by NASA/HQ.',bounds:[[-85.0511287776,-179.999999975],[85.0511287776,179.999999975]],minZoom:1,maxZoom:9,format:"jpg",time:"",tilematrixset:"GoogleMapsCompatible_Level"},variants:{ModisTerraTrueColorCR:"MODIS_Terra_CorrectedReflectance_TrueColor",ModisTerraBands367CR:"MODIS_Terra_CorrectedReflectance_Bands367",ViirsEarthAtNight2012:{options:{variant:"VIIRS_CityLights_2012",maxZoom:8}},ModisTerraLSTDay:{options:{variant:"MODIS_Terra_Land_Surface_Temp_Day",format:"png",maxZoom:7,opacity:.75}},ModisTerraSnowCover:{options:{variant:"MODIS_Terra_Snow_Cover",format:"png",maxZoom:8,opacity:.75}},ModisTerraAOD:{options:{variant:"MODIS_Terra_Aerosol",format:"png",maxZoom:6,opacity:.75}},ModisTerraChlorophyll:{options:{variant:"MODIS_Terra_Chlorophyll_A",format:"png",maxZoom:7,opacity:.75}}}},NLS:{url:"//nls-{s}.tileserver.com/nls/{z}/{x}/{y}.jpg",options:{attribution:'<a href="http://geo.nls.uk/maps/">National Library of Scotland Historic Maps</a>',bounds:[[49.6,-12],[61.7,3]],minZoom:1,maxZoom:18,subdomains:"0123"}},JusticeMap:{url:"http://www.justicemap.org/tile/{size}/{variant}/{z}/{x}/{y}.png",options:{attribution:'<a href="http://www.justicemap.org/terms.php">Justice Map</a>',size:"county",bounds:[[14,-180],[72,-56]]},variants:{income:"income",americanIndian:"indian",asian:"asian",black:"black",hispanic:"hispanic",multi:"multi",nonWhite:"nonwhite",white:"white",plurality:"plural"}}},t.tileLayer.provider=function(e,n){return new t.TileLayer.Provider(e,n)},t})},function(t,e,n){var o,r,s;!function(i){r=[n(1)],o=i,s="function"==typeof o?o.apply(e,r):o,!(void 0!==s&&(t.exports=s))}(function(t){function e(t,e){var n=e.split("."),i=n.pop(),o=n.length,r=n[0],s=1;if(o>0)for(;(t=t[r])&&s<o;)r=n[s++];if(t)return t[i]}function n(t){return"[object Object]"===Object.prototype.toString.call(t)}return t.Control.Search=t.Control.extend({includes:t.Mixin.Events,options:{url:"",layer:null,sourceData:null,jsonpParam:null,propertyLoc:"loc",propertyName:"title",formatData:null,filterData:null,moveToLocation:null,buildTip:null,container:"",zoom:null,minLength:1,initial:!0,casesensitive:!1,autoType:!0,delayType:400,tooltipLimit:-1,tipAutoSubmit:!0,firstTipSubmit:!1,autoResize:!0,collapsed:!0,autoCollapse:!1,autoCollapseTime:1200,textErr:"Location not found",textCancel:"Cancel",textPlaceholder:"Search...",position:"topleft",hideMarkerOnCollapse:!1,marker:{icon:!1,animate:!0,circle:{radius:10,weight:3,color:"#e03",stroke:!0,fill:!1}}},initialize:function(e){t.Util.setOptions(this,e||{}),this._inputMinSize=this.options.textPlaceholder?this.options.textPlaceholder.length:10,this._layer=this.options.layer||new t.LayerGroup,this._filterData=this.options.filterData||this._defaultFilterData,this._formatData=this.options.formatData||this._defaultFormatData,this._moveToLocation=this.options.moveToLocation||this._defaultMoveToLocation,this._autoTypeTmp=this.options.autoType,this._countertips=0,this._recordsCache={},this._curReq=null},onAdd:function(e){return this._map=e,this._container=t.DomUtil.create("div","leaflet-control-search"),this._input=this._createInput(this.options.textPlaceholder,"search-input"),this._tooltip=this._createTooltip("search-tooltip"),this._cancel=this._createCancel(this.options.textCancel,"search-cancel"),this._button=this._createButton(this.options.textPlaceholder,"search-button"),this._alert=this._createAlert("search-alert"),this.options.collapsed===!1&&this.expand(this.options.collapsed),this.options.marker&&(this.options.marker instanceof t.Marker||this.options.marker instanceof t.CircleMarker?this._markerSearch=this.options.marker:n(this.options.marker)&&(this._markerSearch=new t.Control.Search.Marker([0,0],this.options.marker)),this._markerSearch._isMarkerSearch=!0),this.setLayer(this._layer),e.on({resize:this._handleAutoresize},this),this._container},addTo:function(e){return this.options.container?(this._container=this.onAdd(e),this._wrapper=t.DomUtil.get(this.options.container),this._wrapper.style.position="relative",this._wrapper.appendChild(this._container)):t.Control.prototype.addTo.call(this,e),this},onRemove:function(t){this._recordsCache={}},setLayer:function(t){return this._layer=t,this._layer.addTo(this._map),this},showAlert:function(t){t=t||this.options.textErr,this._alert.style.display="block",this._alert.innerHTML=t,clearTimeout(this.timerAlert);var e=this;return this.timerAlert=setTimeout(function(){e.hideAlert()},this.options.autoCollapseTime),this},hideAlert:function(){return this._alert.style.display="none",this},cancel:function(){return this._input.value="",this._handleKeypress({keyCode:8}),this._input.size=this._inputMinSize,this._input.focus(),this._cancel.style.display="none",this._hideTooltip(),this},expand:function(e){return e="boolean"!=typeof e||e,this._input.style.display="block",t.DomUtil.addClass(this._container,"search-exp"),e!==!1&&(this._input.focus(),this._map.on("dragstart click",this.collapse,this)),this.fire("search:expanded"),this},collapse:function(){return this._hideTooltip(),this.cancel(),this._alert.style.display="none",this._input.blur(),this.options.collapsed&&(this._input.style.display="none",this._cancel.style.display="none",t.DomUtil.removeClass(this._container,"search-exp"),this.options.hideMarkerOnCollapse&&this._map.removeLayer(this._markerSearch),this._map.off("dragstart click",this.collapse,this)),this.fire("search:collapsed"),this},collapseDelayed:function(){if(!this.options.autoCollapse)return this;var t=this;return clearTimeout(this.timerCollapse),this.timerCollapse=setTimeout(function(){t.collapse()},this.options.autoCollapseTime),this},collapseDelayedStop:function(){return clearTimeout(this.timerCollapse),this},_createAlert:function(e){var n=t.DomUtil.create("div",e,this._container);return n.style.display="none",t.DomEvent.on(n,"click",t.DomEvent.stop,this).on(n,"click",this.hideAlert,this),n},_createInput:function(e,n){var i=t.DomUtil.create("label",n,this._container),o=t.DomUtil.create("input",n,this._container);return o.type="text",o.size=this._inputMinSize,o.value="",o.autocomplete="off",o.autocorrect="off",o.autocapitalize="off",o.placeholder=e,o.style.display="none",o.role="search",o.id=o.role+o.type+o.size,i.htmlFor=o.id,i.style.display="none",i.value=e,t.DomEvent.disableClickPropagation(o).on(o,"keydown",this._handleKeypress,this).on(o,"blur",this.collapseDelayed,this).on(o,"focus",this.collapseDelayedStop,this),o},_createCancel:function(e,n){var i=t.DomUtil.create("a",n,this._container);return i.href="#",i.title=e,i.style.display="none",i.innerHTML="<span>&otimes;</span>",t.DomEvent.on(i,"click",t.DomEvent.stop,this).on(i,"click",this.cancel,this),i},_createButton:function(e,n){var i=t.DomUtil.create("a",n,this._container);return i.href="#",i.title=e,t.DomEvent.on(i,"click",t.DomEvent.stop,this).on(i,"click",this._handleSubmit,this).on(i,"focus",this.collapseDelayedStop,this).on(i,"blur",this.collapseDelayed,this),i},_createTooltip:function(e){var n=t.DomUtil.create("ul",e,this._container);n.style.display="none";var i=this;return t.DomEvent.disableClickPropagation(n).on(n,"blur",this.collapseDelayed,this).on(n,"mousewheel",function(e){i.collapseDelayedStop(),t.DomEvent.stopPropagation(e)},this).on(n,"mouseover",function(t){i.collapseDelayedStop()},this),n},_createTip:function(e,n){var i;if(this.options.buildTip){if(i=this.options.buildTip.call(this,e,n),"string"==typeof i){var o=t.DomUtil.create("div");o.innerHTML=i,i=o.firstChild}}else i=t.DomUtil.create("li",""),i.innerHTML=e;return t.DomUtil.addClass(i,"search-tip"),i._text=e,this.options.tipAutoSubmit&&t.DomEvent.disableClickPropagation(i).on(i,"click",t.DomEvent.stop,this).on(i,"click",function(t){this._input.value=e,this._handleAutoresize(),this._input.focus(),this._hideTooltip(),this._handleSubmit()},this),i},_getUrl:function(t){return"function"==typeof this.options.url?this.options.url(t):this.options.url},_defaultFilterData:function(t,e){var n,i,o,r={};if(t=t.replace(/[.*+?^${}()|[\]\\]/g,""),""===t)return[];n=this.options.initial?"^":"",i=this.options.casesensitive?void 0:"i",o=new RegExp(n+t,i);for(var s in e)o.test(s)&&(r[s]=e[s]);return r},showTooltip:function(t){var e;this._countertips=0,this._tooltip.innerHTML="",this._tooltip.currentSelection=-1;for(var n in t){if(++this._countertips==this.options.tooltipLimit)break;e=this._createTip(n,t[n]),this._tooltip.appendChild(e)}return this._countertips>0?(this._tooltip.style.display="block",this._autoTypeTmp&&this._autoType(),this._autoTypeTmp=this.options.autoType):this._hideTooltip(),this._tooltip.scrollTop=0,this._countertips},_hideTooltip:function(){return this._tooltip.style.display="none",this._tooltip.innerHTML="",0},_defaultFormatData:function(n){var i,o=this.options.propertyName,r=this.options.propertyLoc,s={};if(t.Util.isArray(r))for(i in n)s[e(n[i],o)]=t.latLng(n[i][r[0]],n[i][r[1]]);else for(i in n)s[e(n[i],o)]=t.latLng(e(n[i],r));return s},_recordsFromJsonp:function(e,n){t.Control.Search.callJsonp=n;var i=t.DomUtil.create("script","leaflet-search-jsonp",document.getElementsByTagName("body")[0]),o=t.Util.template(this._getUrl(e)+"&"+this.options.jsonpParam+"=L.Control.Search.callJsonp",{s:e});return i.type="text/javascript",i.src=o,{abort:function(){i.parentNode.removeChild(i)}}},_recordsFromAjax:function(e,n){void 0===window.XMLHttpRequest&&(window.XMLHttpRequest=function(){try{return new ActiveXObject("Microsoft.XMLHTTP.6.0")}catch(t){try{return new ActiveXObject("Microsoft.XMLHTTP.3.0")}catch(t){throw new Error("XMLHttpRequest is not supported")}}});var i=t.Browser.ie&&!window.atob&&document.querySelector,o=i?new XDomainRequest:new XMLHttpRequest,r=t.Util.template(this._getUrl(e),{s:e});o.open("GET",r);return o.onload=function(){n(JSON.parse(o.responseText))},o.onreadystatechange=function(){4===o.readyState&&200===o.status&&this.onload()},o.send(),o},_recordsFromLayer:function(){var n,i={},o=this.options.propertyName;return this._layer.eachLayer(function(r){if(!r.hasOwnProperty("_isMarkerSearch"))if(r instanceof t.Marker||r instanceof t.CircleMarker)try{if(e(r.options,o))n=r.getLatLng(),n.layer=r,i[e(r.options,o)]=n;else{if(!e(r.feature.properties,o))throw new Error("propertyName '"+o+"' not found in marker");n=r.getLatLng(),n.layer=r,i[e(r.feature.properties,o)]=n}}catch(t){console}else if(r.hasOwnProperty("feature"))try{if(!r.feature.properties.hasOwnProperty(o))throw new Error("propertyName '"+o+"' not found in feature");n=r.getBounds().getCenter(),n.layer=r,i[r.feature.properties[o]]=n}catch(t){console}else r instanceof t.LayerGroup&&r.eachLayer(function(t){n=t.getLatLng(),n.layer=t,i[t.feature.properties[o]]=n})},this),i},_autoType:function(){var t=this._input.value.length,e=this._tooltip.firstChild._text,n=e.length;if(0===e.indexOf(this._input.value))if(this._input.value=e,this._handleAutoresize(),this._input.createTextRange){var i=this._input.createTextRange();i.collapse(!0),i.moveStart("character",t),i.moveEnd("character",n),i.select()}else this._input.setSelectionRange?this._input.setSelectionRange(t,n):this._input.selectionStart&&(this._input.selectionStart=t,this._input.selectionEnd=n)},_hideAutoType:function(){var t;if((t=this._input.selection)&&t.empty)t.empty();else if(this._input.createTextRange){t=this._input.createTextRange(),t.collapse(!0);var e=this._input.value.length;t.moveStart("character",e),t.moveEnd("character",e),t.select()}else this._input.getSelection&&this._input.getSelection().removeAllRanges(),this._input.selectionStart=this._input.selectionEnd},_handleKeypress:function(t){switch(t.keyCode){case 27:this.collapse();break;case 13:(1==this._countertips||this.options.firstTipSubmit&&this._countertips>0)&&this._handleArrowSelect(1),this._handleSubmit();break;case 38:this._handleArrowSelect(-1);break;case 40:this._handleArrowSelect(1);break;case 8:case 45:case 46:this._autoTypeTmp=!1;break;case 37:case 39:case 16:case 17:case 35:case 36:break;default:if(this._input.value.length?this._cancel.style.display="block":this._cancel.style.display="none",this._input.value.length>=this.options.minLength){var e=this;clearTimeout(this.timerKeypress),this.timerKeypress=setTimeout(function(){e._fillRecordsCache()},this.options.delayType)}else this._hideTooltip()}this._handleAutoresize()},searchText:function(e){var n=e.charCodeAt(e.length);this._input.value=e,this._input.style.display="block",t.DomUtil.addClass(this._container,"search-exp"),this._autoTypeTmp=!1,this._handleKeypress({keyCode:n})},_fillRecordsCache:function(){var e,n=this._input.value,i=this;this._curReq&&this._curReq.abort&&this._curReq.abort(),t.DomUtil.addClass(this._container,"search-load"),this.options.layer?(this._recordsCache=this._recordsFromLayer(),e=this._filterData(this._input.value,this._recordsCache),this.showTooltip(e),t.DomUtil.removeClass(this._container,"search-load")):(this.options.sourceData?this._retrieveData=this.options.sourceData:this.options.url&&(this._retrieveData=this.options.jsonpParam?this._recordsFromJsonp:this._recordsFromAjax),this._curReq=this._retrieveData.call(this,n,function(n){i._recordsCache=i._formatData(n),e=i.options.sourceData?i._filterData(i._input.value,i._recordsCache):i._recordsCache,i.showTooltip(e),t.DomUtil.removeClass(i._container,"search-load")}))},_handleAutoresize:function(){this._input.style.maxWidth!=this._map._container.offsetWidth&&(this._input.style.maxWidth=t.DomUtil.getStyle(this._map._container,"width")),this.options.autoResize&&this._container.offsetWidth+45<this._map._container.offsetWidth&&(this._input.size=this._input.value.length<this._inputMinSize?this._inputMinSize:this._input.value.length)},_handleArrowSelect:function(e){var n=this._tooltip.hasChildNodes()?this._tooltip.childNodes:[];for(i=0;i<n.length;i++)t.DomUtil.removeClass(n[i],"search-tip-select");if(1==e&&this._tooltip.currentSelection>=n.length-1)t.DomUtil.addClass(n[this._tooltip.currentSelection],"search-tip-select");else if(e==-1&&this._tooltip.currentSelection<=0)this._tooltip.currentSelection=-1;else if("none"!=this._tooltip.style.display){this._tooltip.currentSelection+=e,t.DomUtil.addClass(n[this._tooltip.currentSelection],"search-tip-select"),this._input.value=n[this._tooltip.currentSelection]._text;var o=n[this._tooltip.currentSelection].offsetTop;o+n[this._tooltip.currentSelection].clientHeight>=this._tooltip.scrollTop+this._tooltip.clientHeight?this._tooltip.scrollTop=o-this._tooltip.clientHeight+n[this._tooltip.currentSelection].clientHeight:o<=this._tooltip.scrollTop&&(this._tooltip.scrollTop=o)}},_handleSubmit:function(){if(this._hideAutoType(),this.hideAlert(),this._hideTooltip(),"none"==this._input.style.display)this.expand();else if(""===this._input.value)this.collapse();else{var t=this._getLocation(this._input.value);t===!1?this.showAlert():(this.showLocation(t,this._input.value),this.fire("search:locationfound",{latlng:t,text:this._input.value,layer:t.layer?t.layer:null}))}},_getLocation:function(t){return!!this._recordsCache.hasOwnProperty(t)&&this._recordsCache[t]},_defaultMoveToLocation:function(t,e,n){this.options.zoom?this._map.setView(t,this.options.zoom):this._map.panTo(t)},showLocation:function(t,e){var n=this;return n._map.once("moveend zoomend",function(e){n._markerSearch&&n._markerSearch.addTo(n._map).setLatLng(t)}),n._moveToLocation(t,e,n._map),n.options.autoCollapse&&n.collapse(),n}}),t.Control.Search.Marker=t.Marker.extend({includes:t.Mixin.Events,options:{icon:new t.Icon.Default,animate:!0,circle:{radius:10,weight:3,color:"#e03",stroke:!0,fill:!1}},initialize:function(e,i){t.setOptions(this,i),i.icon===!0&&(i.icon=new t.Icon.Default),t.Marker.prototype.initialize.call(this,e,i),n(this.options.circle)&&(this._circleLoc=new t.CircleMarker(e,this.options.circle))},onAdd:function(e){t.Marker.prototype.onAdd.call(this,e),this._circleLoc&&(e.addLayer(this._circleLoc),this.options.animate&&this.animate())},onRemove:function(e){t.Marker.prototype.onRemove.call(this,e),this._circleLoc&&e.removeLayer(this._circleLoc)},setLatLng:function(e){return t.Marker.prototype.setLatLng.call(this,e),this._circleLoc&&this._circleLoc.setLatLng(e),this},_initIcon:function(){this.options.icon&&t.Marker.prototype._initIcon.call(this)},_removeIcon:function(){this.options.icon&&t.Marker.prototype._removeIcon.call(this)},animate:function(){if(this._circleLoc){var t=this._circleLoc,e=200,n=5,i=parseInt(t._radius/n),o=this.options.circle.radius,r=2*t._radius,s=0;t._timerAnimLoc=setInterval(function(){s+=.5,i+=s,r-=i,t.setRadius(r),r<o&&(clearInterval(t._timerAnimLoc),t.setRadius(o))},e)}return this}}),t.Map.addInitHook(function(){this.options.searchControl&&(this.searchControl=t.control.search(this.options.searchControl),this.addControl(this.searchControl))}),t.control.search=function(e){return new t.Control.Search(e)},t.Control.Search})},function(t,e,n){"use strict";function i(){}function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,t!==i&&u(this,t)}function r(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function s(t,e,n){p(function(){var i;try{i=e(n)}catch(e){return m.reject(t,e)}i===t?m.reject(t,new TypeError("Cannot resolve promise with itself")):m.resolve(t,i)})}function a(t){var e=t&&t.then;if(t&&"object"==typeof t&&"function"==typeof e)return function(){e.apply(t,arguments)}}function u(t,e){function n(e){r||(r=!0,m.reject(t,e))}function i(e){r||(r=!0,m.resolve(t,e))}function o(){e(i,n)}var r=!1,s=c(o);"error"===s.status&&n(s.value)}function c(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}function l(t){return t instanceof this?t:m.resolve(new this(i),t)}function h(t){var e=new this(i);return m.reject(e,t)}function d(t){function e(t,e){function i(t){s[e]=t,++a!==o||r||(r=!0,m.resolve(c,s))}n.resolve(t).then(i,function(t){r||(r=!0,m.reject(c,t))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,r=!1;if(!o)return this.resolve([]);for(var s=new Array(o),a=0,u=-1,c=new this(i);++u<o;)e(t[u],u);return c}function f(t){function e(t){n.resolve(t).then(function(t){r||(r=!0,m.resolve(a,t))},function(t){r||(r=!0,m.reject(a,t))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,r=!1;if(!o)return this.resolve([]);for(var s=-1,a=new this(i);++s<o;)e(t[s]);return a}var p=n(11),m={},_=["REJECTED"],v=["FULFILLED"],g=["PENDING"];t.exports=o,o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if("function"!=typeof t&&this.state===v||"function"!=typeof e&&this.state===_)return this;var n=new this.constructor(i);if(this.state!==g){var o=this.state===v?t:e;s(n,o,this.outcome)}else this.queue.push(new r(n,t,e));return n},r.prototype.callFulfilled=function(t){m.resolve(this.promise,t)},r.prototype.otherCallFulfilled=function(t){s(this.promise,this.onFulfilled,t)},r.prototype.callRejected=function(t){m.reject(this.promise,t)},r.prototype.otherCallRejected=function(t){s(this.promise,this.onRejected,t)},m.resolve=function(t,e){var n=c(a,e);if("error"===n.status)return m.reject(t,n.value);var i=n.value;if(i)u(t,i);else{t.state=v,t.outcome=e;for(var o=-1,r=t.queue.length;++o<r;)t.queue[o].callFulfilled(e)}return t},m.reject=function(t,e){t.state=_,t.outcome=e;for(var n=-1,i=t.queue.length;++n<i;)t.queue[n].callRejected(e);return t},o.resolve=l,o.reject=h,o.all=d,o.race=f},function(t,e){function n(t,e,n){return t===t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function o(t){return!!t&&"object"==typeof t}function r(t){return"symbol"==typeof t||o(t)&&_.call(t)==c}function s(t){if("number"==typeof t)return t;if(r(t))return u;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(l,"");var n=d.test(t);return n||f.test(t)?p(t.slice(2),n?2:8):h.test(t)?u:+t}function a(t,e,i){return void 0===i&&(i=e,e=void 0),void 0!==i&&(i=s(i),i=i===i?i:0),void 0!==e&&(e=s(e),e=e===e?e:0),n(s(t),e,i)}var u=NaN,c="[object Symbol]",l=/^\s+|\s+$/g,h=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,f=/^0o[0-7]+$/i,p=parseInt,m=Object.prototype,_=m.toString;t.exports=a},function(t,e){function n(t){if(t=String(t),!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),i=(e[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return n*l;case"days":case"day":case"d":return n*c;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function i(t){return t>=c?Math.round(t/c)+"d":t>=u?Math.round(t/u)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return r(t,c,"day")||r(t,u,"hour")||r(t,a,"minute")||r(t,s,"second")||t+" ms"}function r(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,u=60*a,c=24*u,l=365.25*c;t.exports=function(t,e){e=e||{};var r=typeof t;if("string"===r&&t.length>0)return n(t);if("number"===r&&isNaN(t)===!1)return e.long?o(t):i(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e){t.exports=function(){function t(t){return t&&t instanceof Object&&"function"==typeof t.then}function e(n,i,o){try{var r=o?o(i):i;if(n===r)return n.reject(new TypeError("Promise resolution loop"));t(r)?r.then(function(t){e(n,t)},function(t){n.reject(t)}):n.resolve(r)}catch(t){n.reject(t)}}function n(){}function i(t){}function o(t,e){this.resolve=t,this.reject=e}function r(i,o){var r=new n;try{this._resolver(function(n){return t(n)?n.then(i,o):e(r,n,i)},function(t){e(r,t,o)})}catch(t){e(r,t,o)}return r}function s(t){this._resolver=t,this.then=r}return n.prototype={resolve:i,reject:i,then:o},s.resolve=function(t){return s.isThenable(t)?t:{then:function(e){return e(t)}}},s.isThenable=t,s}},function(t,e,n){(function(e,n){"use strict";t.exports=function(t){function i(t){if(t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)})}}function o(t,e){if("function"==typeof t.y)try{var n=t.y.call(void 0,e);t.p.resolve(n)}catch(e){t.p.reject(e)}else t.p.resolve(e)}function r(t,e){if("function"==typeof t.n)try{var n=t.n.call(void 0,e);t.p.resolve(n)}catch(e){t.p.reject(e)}else t.p.reject(e)}t=t||"object"==typeof e&&e.nextTick||"function"==typeof n&&n||function(t){setTimeout(t,0)};var s=function(){function e(){for(;n.length-i;)n[i](),n[i++]=void 0,i===o&&(n.splice(0,o),i=0)}var n=[],i=0,o=1024;return function(o){n.push(o),n.length-i===1&&t(e)}}();return i.prototype={resolve:function(t){if(void 0===this.state){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var e=this;if(t&&("function"==typeof t||"object"==typeof t))try{var n=0,i=t.then;if("function"==typeof i)return void i.call(t,function(t){n++||e.resolve(t)},function(t){n++||e.reject(t)})}catch(t){return void(n||this.reject(t))}this.state=o,this.v=t,e.c&&s(function(){for(var n=0,i=e.c.length;n<i;n++)o(e.c[n],t)})}},reject:function(t){if(void 0===this.state){this.state=r,this.v=t;var e=this.c;e&&s(function(){for(var n=0,i=e.length;n<i;n++)r(e[n],t)})}},then:function(t,e){var n=new i,o={y:t,n:e,p:n};if(void 0===this.state)this.c?this.c.push(o):this.c=[o];else{var r=this.state,a=this.v;s(function(){r(o,a)})}return n}},i.resolve=function(t){if(t&&t instanceof i)return t;var e=new i;return e.resolve(t),e},i.reject=function(t){if(t&&t instanceof i)return t;var e=new i;return e.reject(t),e},i.version="2.3.2-nodent",i}}).call(e,n(9),n(48).setImmediate)},function(t,e){function n(){return"serviceWorker"in navigator&&(window.fetch||"imageRendering"in document.documentElement.style)&&("https:"===window.location.protocol||"localhost"===window.location.hostname)}function i(t){if(t||(t={}),n()){navigator.serviceWorker.register("sw.js")}else if(window.applicationCache){var e="appcache/",i="manifest",o=function(){var t=e+i+".html",n=document.createElement("iframe");n.src=t,n.style.display="none",r=n,document.body.appendChild(n)};return void("complete"===document.readyState?setTimeout(o):window.addEventListener("load",o))}}function o(t,e){}var r;e.install=i,e.applyUpdate=o},function(t,e,n){var i,o,r;!function(n,s){"use strict";o=[],i=s,r="function"==typeof i?i.apply(e,o):i,!(void 0!==r&&(t.exports=r))}(this,function(){"use strict";function t(t){return"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType}function e(t){return"string"==typeof t}function n(){var t=[];return{watch:t.push.bind(t),trigger:function(e,n){for(var i=!0,o={detail:n,preventDefault:function(){i=!1}},r=0;r<t.length;r++)t[r](e,o);return i}}}function i(t){return"none"===window.getComputedStyle(t).display}function o(t){this.elem=t}function r(t,e){return o.make(t("parent")).clazz("pico-overlay").clazz(t("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(t("overlayStyles",{opacity:.5,background:"#000"})).onClick(function(){t("overlayClose",!0)&&e()})}function s(t,e){var n=t("width","auto");"number"==typeof n&&(n=""+n+"px");var i=t("modalId","pico-"+h++),r=o.make(t("parent")).clazz("pico-content").clazz(t("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"38.1966%",maxHeight:"90%",boxSizing:"border-box",width:n,"-ms-transform":"translate(-50%,-38.1966%)","-moz-transform":"translate(-50%,-38.1966%)","-webkit-transform":"translate(-50%,-38.1966%)","-o-transform":"translate(-50%,-38.1966%)",transform:"translate(-50%,-38.1966%)"}).stylize(t("modalStyles",{overflow:"auto",backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(t("content")).attr("id",i).attr("role","dialog").attr("aria-labelledby",t("ariaLabelledBy")).attr("aria-describedby",t("ariaDescribedBy",i)).onClick(function(t){var n=new o(t.target).anyAncestor(function(t){return/\bpico-close\b/.test(t.elem.className)});n&&e()});return r}function a(t,e){if(e("closeButton",!0))return t.child("button").html(e("closeHtml","&#xD7;")).clazz("pico-close").clazz(e("closeClass","")).stylize(e("closeStyles",{borderRadius:"2px",border:0,padding:0,cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"})).attr("aria-label",e("close-label","Close"))}function u(t){return function(){return t().elem}}function c(t,e){function n(t,e){var n=t.msMatchesSelector||t.webkitMatchesSelector||t.matches;return n.call(t,e)}function o(t){return!(i(t)||n(t,":disabled")||t.hasAttribute("contenteditable"))&&(t.hasAttribute("tabindex")||n(t,"input,select,textarea,button,a[href],area[href],iframe"))}function r(t){for(var e=t.getElementsByTagName("*"),n=0;n<e.length;n++)if(o(e[n]))return e[n]}function s(t){for(var e=t.getElementsByTagName("*"),n=e.length;n--;)if(o(e[n]))return e[n]}var a;t.beforeShow(function(){a=document.activeElement}),t.afterShow(function(){if(e()){var n=r(t.modalElem());n&&n.focus()}}),t.afterClose(function(){e()&&a&&a.focus(),a=null}),f.watch(function(n){if(e()&&t.isVisible()){var i=r(t.modalElem()),o=s(t.modalElem()),a=n.shiftKey?i:o;a===document.activeElement&&((n.shiftKey?o:i).focus(),n.preventDefault())}})}function l(t,e){var n,i=new o(document.body);t.beforeShow(function(){n=i.elem.style.overflow,e()&&i.stylize({overflow:"hidden"})}),t.afterClose(function(){i.stylize({overflow:n})})}o.make=function(t,e){"string"==typeof t&&(t=document.querySelector(t));var n=document.createElement(e||"div");return(t||document.body).appendChild(n),new o(n)},o.prototype={child:function(t){return o.make(this.elem,t)},stylize:function(t){t=t||{},"undefined"!=typeof t.opacity&&(t.filter="alpha(opacity="+100*t.opacity+")");for(var e in t)t.hasOwnProperty(e)&&(this.elem.style[e]=t[e]);return this},clazz:function(t){return this.elem.className+=" "+t,this},html:function(e){return t(e)?this.elem.appendChild(e):this.elem.innerHTML=e,this},onClick:function(t){return this.elem.addEventListener("click",t),this},destroy:function(){this.elem.parentNode.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(t,e){return void 0!==e&&this.elem.setAttribute(t,e),
this},anyAncestor:function(t){for(var e=this.elem;e;){if(t(new o(e)))return!0;e=e.parentNode}return!1},isVisible:function(){return!i(this.elem)}};var h=1,d=n(),f=n();return document.documentElement.addEventListener("keydown",function(t){var e=t.which||t.keyCode;27===e?d.trigger():9===e&&f.trigger(t)}),function(i){function o(t,e){var n=i[t];return"function"==typeof n&&(n=n(e)),void 0===n?e:n}function h(t){E().hide(),x().hide(),L.trigger(_,t)}function f(t){w.trigger(_,t)&&h(t)}function p(t){return function(){return t.apply(this,arguments),_}}function m(t,e){if(!v){var n=s(o,f);v={modal:n,overlay:r(o,f),close:a(n,o)},g.trigger(_,e)}return v[t]}(e(i)||t(i))&&(i={content:i});var _,v,g=n(),y=n(),b=n(),w=n(),L=n(),x=m.bind(window,"modal"),E=m.bind(window,"overlay"),C=m.bind(window,"close");return _={modalElem:u(x),closeElem:u(C),overlayElem:u(E),buildDom:p(m.bind(null,null)),isVisible:function(){return!!(v&&x&&x().isVisible())},show:function(t){return y.trigger(_,t)&&(E().show(),C(),x().show(),b.trigger(_,t)),this},close:p(f),forceClose:p(h),destroy:function(){x().destroy(),E().destroy(),E=x=C=void 0},options:function(t){Object.keys(t).map(function(e){i[e]=t[e]})},afterCreate:p(g.watch),beforeShow:p(y.watch),afterShow:p(b.watch),beforeClose:p(w.watch),afterClose:p(L.watch)},c(_,o.bind(null,"focus",!0)),l(_,o.bind(null,"bodyOverflow",!0)),d.watch(function(){o("escCloses",!0)&&_.isVisible()&&_.close()}),_}})},function(t,e,n){(function(e){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function o(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}function r(t){if("function"==typeof t.slice)return t.slice(0);var e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),i=new Uint8Array(t);return n.set(i),e}function s(t){if(t instanceof ArrayBuffer)return r(t);var e=t.size,n=t.type;return"function"==typeof t.slice?t.slice(0,e,n):t.webkitSlice(0,e,n)}function a(t){var e=Object.getPrototypeOf(t);if(null===e)return!0;var n=e.constructor;return"function"==typeof n&&n instanceof n&&Ki.call(n)==$i}function u(t){var e,n,i;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],n=0,i=t.length;n<i;n++)e[n]=u(t[n]);return e}if(t instanceof Date)return t.toISOString();if(o(t))return s(t);if(!a(t))return t;e={};for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=u(t[n]);"undefined"!=typeof r&&(e[n]=r)}return e}function c(t){var e=!1;return Ni(function(n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)})}function l(t){return Ni(function(e){e=u(e);var n=this,i="function"==typeof e[e.length-1]&&e.pop(),o=new Vi(function(i,o){var r;try{var s=c(function(t,e){t?o(t):i(e)});e.push(s),r=t.apply(n,e),r&&"function"==typeof r.then&&i(r)}catch(t){o(t)}});return i&&o.then(function(t){i(null,t)},i),o})}function h(t,e){function n(t,e,n){if(Ji.enabled){for(var i=[t.name,e],o=0;o<n.length-1;o++)i.push(n[o]);Ji.apply(null,i);var r=n[n.length-1];n[n.length-1]=function(n,i){var o=[t.name,e];o=o.concat(n?["error",n]:["success",i]),Ji.apply(null,o),r(n,i)}}}return l(Ni(function(i){if(this._closed)return Vi.reject(new Error("database is closed"));if(this._destroyed)return Vi.reject(new Error("database is destroyed"));var o=this;return n(o,t,i),this.taskqueue.isReady?e.apply(this,i):new Vi(function(e,n){o.taskqueue.addTask(function(r){r?n(r):e(o[t].apply(o,i))})})}))}function d(t,e){for(var n={},i=0,o=e.length;i<o;i++){var r=e[i];r in t&&(n[r]=t[r])}return n}function f(t){return"$"+t}function p(t){return t.substring(1)}function m(){this._store={}}function _(t){if(this._store=new m,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}function v(t){return t}function g(t){return[{ok:t}]}function y(t,e,n){function i(){var t=[];f.forEach(function(e){e.docs.forEach(function(n){t.push({id:e.id,docs:[n]})})}),n(null,{results:t})}function o(){++h===l&&i()}function r(t,e,n){f[t]={id:e,docs:n},o()}function s(){if(!(_>=p.length)){var t=Math.min(_+Yi,p.length),e=p.slice(_,t);a(e,_),_+=e.length}}function a(n,i){n.forEach(function(n,o){var a=i+o,u=c.get(n),l=d(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(t){return t.rev}),l.open_revs=l.open_revs.filter(v);var h=v;0===l.open_revs.length&&(delete l.open_revs,h=g),["revs","attachments","binary","ajax","latest"].forEach(function(t){t in e&&(l[t]=e[t])}),t.get(n,l,function(t,e){var i;i=t?[{error:t}]:h(e),r(a,n,i),s()})})}var u=e.docs,c=new m;u.forEach(function(t){c.has(t.id)?c.get(t.id).push(t):c.set(t.id,[t])});var l=c.size,h=0,f=new Array(l),p=[];c.forEach(function(t,e){p.push(e)});var _=0;s()}function b(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function w(){return Xi}function L(t){b()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):w()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){t.emit(e.key)}):window.attachEvent("storage",function(e){t.emit(e.key)}))}function x(){qi.EventEmitter.call(this),this._listeners={},L(this)}function E(t){if("undefined"!==console&&t in console){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function C(t,e){var n=6e5;t=parseInt(t,10)||0,e=parseInt(e,10),e!==e||e<=t?e=(t||1)<<1:e+=1,e>n&&(t=n>>1,e=n);var i=Math.random(),o=e-t;return~~(o*i+t)}function S(t){var e=0;return t||(e=2e3),C(t,e)}function T(t,e){E("info","The above "+t+" is totally normal. "+e)}function k(t){if("object"!=typeof t)throw t+" is not an object";var e=Qi.call(arguments,1);return to.call(e,function(e){if(e)for(var n in e)"object"==typeof e[n]&&t[n]?k.call(t,t[n],e[n]):t[n]=e[n]}),t}function P(t,e,n){Error.call(this,n),this.status=t,this.name=e,this.message=n,this.error=!0}function D(t,e){function n(e){for(var n in t)"function"!=typeof t[n]&&(this[n]=t[n]);void 0!==e&&(this.reason=e)}return n.prototype=P.prototype,new n(e)}function O(t){if("object"!=typeof t){var e=t;t=uo,t.data=e}return"error"in t&&"conflict"===t.error&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),t}function M(t,e,n){try{return!t(e,n)}catch(t){var i="Filter function threw: "+t.toString();return D(fo,i)}}function A(t){var e={},n=t.filter&&"function"==typeof t.filter;return e.query=t.query_params,function(i){i.doc||(i.doc={});var o=n&&M(t.filter,i.doc,e);if("object"==typeof o)return o;if(o)return!1;if(t.include_docs){if(!t.attachments)for(var r in i.doc._attachments)i.doc._attachments.hasOwnProperty(r)&&(i.doc._attachments[r].stub=!0)}else delete i.doc;return!0}}function B(t){for(var e=[],n=0,i=t.length;n<i;n++)e=e.concat(t[n]);return e}function I(t){var e;if(t?"string"!=typeof t?e=D(oo):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=D(so)):e=D(ro),e)throw e}function U(t,e){return"listenerCount"in t?t.listenerCount(e):qi.EventEmitter.listenerCount(t,e)}function j(t){if(!t)return null;var e=t.split("/");return 2===e.length?e:1===e.length?[t,t]:null}function z(t){var e=j(t);return e?e.join("/"):null}function N(t){for(var e=Lo.exec(t),n={},i=14;i--;){var o=yo[i],r=e[i]||"",s=["user","password"].indexOf(o)!==-1;n[o]=s?decodeURIComponent(r):r}return n[bo]={},n[yo[12]].replace(wo,function(t,e,i){e&&(n[bo][e]=i)}),n}function R(t,e,n){return new Vi(function(i,o){t.get(e,function(r,s){if(r){if(404!==r.status)return o(r);s={}}var a=s._rev,u=n(s);return u?(u._id=e,u._rev=a,void i(q(t,u,n))):i({updated:!1,rev:a})})})}function q(t,e,n){return t.put(e).then(function(t){return{updated:!0,rev:t.rev}},function(i){if(409!==i.status)throw i;return R(t,e._id,n)})}function Z(t){return 0|Math.random()*t}function F(t,e){e=e||xo.length;var n="",i=-1;if(t){for(;++i<t;)n+=xo[Z(e)];return n}for(;++i<36;)switch(i){case 8:case 13:case 18:case 23:n+="-";break;case 19:n+=xo[3&Z(16)|8];break;default:n+=xo[Z(16)]}return n}function G(t){for(var e,n,i,o,r=t.rev_tree.slice();o=r.pop();){var s=o.ids,a=s[2],u=o.pos;if(a.length)for(var c=0,l=a.length;c<l;c++)r.push({pos:u+1,ids:a[c]});else{var h=!!s[1].deleted,d=s[0];e&&!(i!==h?i:n!==u?n<u:e<d)||(e=d,n=u,i=h)}}return n+"-"+e}function W(t,e){for(var n,i=t.slice();n=i.pop();)for(var o=n.pos,r=n.ids,s=r[2],a=e(0===s.length,o,r[0],n.ctx,r[1]),u=0,c=s.length;u<c;u++)i.push({pos:o+1,ids:s[u],ctx:a})}function H(t,e){return t.pos-e.pos}function V(t){var e=[];W(t,function(t,n,i,o,r){t&&e.push({rev:n+"-"+i,pos:n,opts:r})}),e.sort(H).reverse();for(var n=0,i=e.length;n<i;n++)delete e[n].pos;return e}function K(t){for(var e=G(t),n=V(t.rev_tree),i=[],o=0,r=n.length;o<r;o++){var s=n[o];s.rev===e||s.opts.deleted||i.push(s.rev)}return i}function $(t){var e=[];return W(t.rev_tree,function(t,n,i,o,r){"available"!==r.status||t||(e.push(n+"-"+i),r.status="missing")}),e}function J(t){for(var e,n=[],i=t.slice();e=i.pop();){var o=e.pos,r=e.ids,s=r[0],a=r[1],u=r[2],c=0===u.length,l=e.history?e.history.slice():[];l.push({id:s,opts:a}),c&&n.push({pos:o+1-l.length,ids:l});for(var h=0,d=u.length;h<d;h++)i.push({pos:o+1,ids:u[h],history:l})}return n.reverse()}function X(t,e){return t.pos-e.pos}function Y(t,e,n){for(var i,o=0,r=t.length;o<r;)i=o+r>>>1,n(t[i],e)<0?o=i+1:r=i;return o}function Q(t,e,n){var i=Y(t,e,n);t.splice(i,0,e)}function tt(t,e){for(var n,i,o=e,r=t.length;o<r;o++){var s=t[o],a=[s.id,s.opts,[]];i?(i[2].push(a),i=a):n=i=a}return n}function et(t,e){return t[0]<e[0]?-1:1}function nt(t,e){for(var n=[{tree1:t,tree2:e}],i=!1;n.length>0;){var o=n.pop(),r=o.tree1,s=o.tree2;(r[1].status||s[1].status)&&(r[1].status="available"===r[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(r[2][0]){for(var u=!1,c=0;c<r[2].length;c++)r[2][c][0]===s[2][a][0]&&(n.push({tree1:r[2][c],tree2:s[2][a]}),u=!0);u||(i="new_branch",Q(r[2],s[2][a],et))}else i="new_leaf",r[2][0]=s[2][a]}return{conflicts:i,tree:t}}function it(t,e,n){var i,o=[],r=!1,s=!1;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var a=0,u=t.length;a<u;a++){var c=t[a];if(c.pos===e.pos&&c.ids[0]===e.ids[0])i=nt(c.ids,e.ids),o.push({pos:c.pos,ids:i.tree}),r=r||i.conflicts,s=!0;else if(n!==!0){var l=c.pos<e.pos?c:e,h=c.pos<e.pos?e:c,d=h.pos-l.pos,f=[],p=[];for(p.push({ids:l.ids,diff:d,parent:null,parentIdx:null});p.length>0;){var m=p.pop();if(0!==m.diff)for(var _=m.ids[2],v=0,g=_.length;v<g;v++)p.push({ids:_[v],diff:m.diff-1,parent:m.ids,parentIdx:v});else m.ids[0]===h.ids[0]&&f.push(m)}var y=f[0];y?(i=nt(y.ids,h.ids),y.parent[2][y.parentIdx]=i.tree,o.push({pos:l.pos,ids:l.ids}),r=r||i.conflicts,s=!0):o.push(c)}else o.push(c)}return s||o.push(e),o.sort(X),{tree:o,conflicts:r||"internal_node"}}function ot(t,e){for(var n,i=J(t),o={},r=0,s=i.length;r<s;r++){for(var a=i[r],u=a.ids,c=Math.max(0,u.length-e),l={pos:a.pos+c,ids:tt(u,c)},h=0;h<c;h++){var d=a.pos+h+"-"+u[h].id;o[d]=!0}n=n?it(n,l,!0).tree:[l]}return W(n,function(t,e,n){delete o[e+"-"+n]}),{tree:n,revs:Object.keys(o)}}function rt(t,e,n){var i=it(t,e),o=ot(i.tree,n);return{tree:o.tree,stemmedRevs:o.revs,conflicts:i.conflicts}}function st(t,e){for(var n,i=t.slice(),o=e.split("-"),r=parseInt(o[0],10),s=o[1];n=i.pop();){if(n.pos===r&&n.ids[0]===s)return!0;for(var a=n.ids[2],u=0,c=a.length;u<c;u++)i.push({pos:n.pos+1,ids:a[u]})}return!1}function at(t){return t.ids}function ut(t,e){e||(e=G(t));for(var n,i=e.substring(e.indexOf("-")+1),o=t.rev_tree.map(at);n=o.pop();){if(n[0]===i)return!!n[1].deleted;o=o.concat(n[2])}}function ct(t){return/^_local/.test(t)}function lt(t,e){for(var n,i=e.rev_tree.slice();n=i.pop();){var o=n.pos,r=n.ids,s=r[0],a=r[1],u=r[2],c=0===u.length,l=n.history?n.history.slice():[];if(l.push({id:s,pos:o,opts:a}),c)for(var h=0,d=l.length;h<d;h++){var f=l[h],p=f.pos+"-"+f.id;if(p===t)return o+"-"+s}for(var m=0,_=u.length;m<_;m++)i.push({pos:o+1,ids:u[m],history:l})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}function ht(t){return Gi('"use strict";\nreturn '+t+";",{})}function dt(t){var e=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+t+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n");return Gi(e,{})}function ft(t,e){try{t.emit("change",e)}catch(t){E("error",'Error in .on("change", function):',t)}}function pt(t,e,n){function i(){o.cancel()}qi.EventEmitter.call(this);var o=this;this.db=t,e=e?u(e):{};var r=e.complete=c(function(e,n){e?U(o,"error")>0&&o.emit("error",e):o.emit("complete",n),o.removeAllListeners(),t.removeListener("destroyed",i)});n&&(o.on("complete",function(t){n(null,t)}),o.on("error",n)),t.once("destroyed",i),e.onChange=function(t){e.isCancelled||ft(o,t)};var s=new Vi(function(t,n){e.complete=function(e,i){e?n(e):t(i)}});o.once("cancel",function(){t.removeListener("destroyed",i),e.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then(function(t){r(null,t)},r),t.taskqueue.isReady?o.doChanges(e):t.taskqueue.addTask(function(t){t?e.complete(t):o.isCancelled?o.emit("cancel"):o.doChanges(e)})}function mt(t,e,n){var i=[{rev:t._rev}];"all_docs"===n.style&&(i=V(e.rev_tree).map(function(t){return{rev:t.rev}}));var o={id:e.id,changes:i,doc:t};return ut(e,t._rev)&&(o.deleted=!0),n.conflicts&&(o.doc._conflicts=K(e),o.doc._conflicts.length||delete o.doc._conflicts),o}function _t(t,e){return t<e?-1:t>e?1:0}function vt(t){return function(e,n){e||n[0]&&n[0].error?t(e||n[0]):t(null,n.length?n[0]:n)}}function gt(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var i=Object.keys(n._attachments),o=0;o<i.length;o++){var r=i[o];n._attachments[r]=d(n._attachments[r],["data","digest","content_type","length","revpos","stub"])}}}function yt(t,e){var n=_t(t._id,e._id);if(0!==n)return n;var i=t._revisions?t._revisions.start:0,o=e._revisions?e._revisions.start:0;return _t(i,o)}function bt(t){var e={},n=[];return W(t,function(t,i,o,r){var s=i+"-"+o;return t&&(e[s]=0),void 0!==r&&n.push({from:r,to:s}),s}),n.reverse(),n.forEach(function(t){void 0===e[t.from]?e[t.from]=1+e[t.to]:e[t.from]=Math.min(e[t.from],1+e[t.to])}),e}function wt(t,e,n){var i="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;if(e.descending&&i.reverse(),!i.length)return t._allDocs({limit:0},n);var o={offset:e.skip};return Vi.all(i.map(function(n){var i=k({key:n,deleted:"ok"},e);return["limit","skip","keys"].forEach(function(t){delete i[t]}),new Vi(function(e,r){t._allDocs(i,function(t,i){return t?r(t):(o.total_rows=i.total_rows,void e(i.rows[0]||{key:n,error:"not_found"}))})})})).then(function(t){return o.rows=t,o})}function Lt(t){var e=t._compactionQueue[0],n=e.opts,i=e.callback;t.get("_local/compaction").catch(function(){return!1}).then(function(e){e&&e.last_seq&&(n.last_seq=e.last_seq),t._compact(n,function(e,n){e?i(e):i(null,n),Fi(function(){t._compactionQueue.shift(),t._compactionQueue.length&&Lt(t)})})})}function xt(t){return"_"===t.charAt(0)&&t+"is not a valid attachment name, attachment names cannot start with '_'"}function Et(){qi.EventEmitter.call(this)}function Ct(){this.isReady=!1,this.failed=!1,this.queue=[]}function St(t,e){var n=t.match(/([a-z\-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var i=kt.adapters,o=kt.preferredAdapters,r=kt.prefix,s=e.adapter;if(!s)for(var a=0;a<o.length;++a){s=o[a];{if(!("idb"===s&&"websql"in i&&w()&&localStorage["_pouch__websqldb_"+r+t]))break;E("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.')}}var u=i[s],c=!(u&&"use_prefix"in u)||u.use_prefix;return{name:c?r+t:t,adapter:s}}function Tt(t){function e(){t.removeListener("closed",i),t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.removeListener("closed",i),t.emit("destroyed")}function i(){t.removeListener("destroyed",e),o.delete(t.name)}var o=t.constructor._destructionListeners;t.once("destroyed",e),t.once("closed",i),o.has(t.name)||o.set(t.name,[]),o.get(t.name).push(n)}function kt(t,e){if(!(this instanceof kt))return new kt(t,e);var n=this;if(e=e||{},t&&"object"==typeof t&&(e=t,t=e.name,delete e.name),this.__opts=e=u(e),n.auto_compaction=e.auto_compaction,n.prefix=kt.prefix,"string"!=typeof t)throw new Error("Missing/invalid DB name");var i=(e.prefix||"")+t,o=St(i,e);if(e.name=o.name,e.adapter=e.adapter||o.adapter,n.name=t,n._adapter=e.adapter,Ri("pouchdb:adapter")("Picked adapter: "+e.adapter),!kt.adapters[e.adapter]||!kt.adapters[e.adapter].valid())throw new Error("Invalid Adapter: "+e.adapter);Et.call(n),n.taskqueue=new Ct,n.adapter=e.adapter,kt.adapters[e.adapter].call(n,e,function(t){return t?n.taskqueue.fail(t):(Tt(n),n.emit("created",n),kt.emit("created",n.name),void n.taskqueue.ready(n))})}function Pt(t){Object.keys(qi.EventEmitter.prototype).forEach(function(e){"function"==typeof qi.EventEmitter.prototype[e]&&(t[e]=Eo[e].bind(Eo))});var e=t._destructionListeners=new m;t.on("destroyed",function(t){e.get(t).forEach(function(t){t()}),e.delete(t)})}function Dt(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}function Ot(t){if(!/^\d+\-./.test(t))return D(vo);var e=t.indexOf("-"),n=t.substring(0,e),i=t.substring(e+1);return{prefix:parseInt(n,10),id:i}}function Mt(t,e){for(var n=t.start-t.ids.length+1,i=t.ids,o=[i[0],e,[]],r=1,s=i.length;r<s;r++)o=[i[r],{status:"missing"},[o]];return[{pos:n,ids:o}]}function At(t,e){var n,i,o,r={status:"available"};if(t._deleted&&(r.deleted=!0),e)if(t._id||(t._id=F()),i=F(32,16).toLowerCase(),t._rev){if(o=Ot(t._rev),o.error)return o;t._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[i,r,[]]]]}],n=o.prefix+1}else t._rev_tree=[{pos:1,ids:[i,r,[]]}],n=1;else if(t._revisions&&(t._rev_tree=Mt(t._revisions,r),n=t._revisions.start,i=t._revisions.ids[0]),!t._rev_tree){if(o=Ot(t._rev),o.error)return o;n=o.prefix,i=o.id,t._rev_tree=[{pos:n,ids:[i,r,[]]}]}I(t._id),t._rev=n+"-"+i;var s={metadata:{},data:{}};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var u="_"===a[0];if(u&&!To[a]){var c=D(ho,a);throw c.message=ho.message+": "+a,c}u&&!ko[a]?s.metadata[a.slice(1)]=t[a]:s.data[a]=t[a]}return s}function Bt(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(r){if("TypeError"!==r.name)throw r;for(var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,i=new n,o=0;o<t.length;o+=1)i.append(t[o]);return i.getBlob(e.type)}}function It(t){for(var e=t.length,n=new ArrayBuffer(e),i=new Uint8Array(n),o=0;o<e;o++)i[o]=t.charCodeAt(o);return n}function Ut(t,e){return Bt([It(t)],{type:e})}function jt(t,e){return Ut(Po(t),e)}function zt(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,o=0;o<i;o++)e+=String.fromCharCode(n[o]);return e}function Nt(t,e){if("undefined"==typeof FileReader)return e(zt((new FileReaderSync).readAsArrayBuffer(t)));var n=new FileReader,i="function"==typeof n.readAsBinaryString;n.onloadend=function(t){var n=t.target.result||"";return i?e(n):void e(zt(n))},i?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function Rt(t,e){Nt(t,function(t){e(t)})}function qt(t,e){Rt(t,function(t){e(Do(t))})}function Zt(t,e){if("undefined"==typeof FileReader)return e((new FileReaderSync).readAsArrayBuffer(t));var n=new FileReader;n.onloadend=function(t){var n=t.target.result||new ArrayBuffer(0);e(n)},n.readAsArrayBuffer(t)}function Ft(t){return Do(t)}function Gt(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.slice(e,n)}function Wt(t,e,n,i,o){(n>0||i<e.size)&&(e=Gt(e,n,i)),Zt(e,function(e){t.append(e),o()})}function Ht(t,e,n,i,o){(n>0||i<e.length)&&(e=e.substring(n,i)),t.appendBinary(e),o()}function Vt(t,e){function n(){Oo(o)}function i(){var t=l.end(!0),n=Ft(t);e(n),l.destroy()}function o(){var e=c*a,o=e+a;c++,c<u?h(l,t,e,o,n):h(l,t,e,o,i)}var r="string"==typeof t,s=r?t.length:t.size,a=Math.min(Mo,s),u=Math.ceil(s/a),c=0,l=r?new Wi:new Wi.ArrayBuffer,h=r?Ht:Wt;o()}function Kt(t){return Wi.hash(t)}function $t(t){try{return Po(t)}catch(t){var e=D(co,"Attachment is not a valid base64 string");return{error:e}}}function Jt(t,e,n){var i=$t(t.data);return i.error?n(i.error):(t.length=i.length,"blob"===e?t.data=Ut(i,t.content_type):"base64"===e?t.data=Do(i):t.data=i,void Vt(i,function(e){t.digest="md5-"+e,n()}))}function Xt(t,e,n){Vt(t.data,function(i){t.digest="md5-"+i,t.length=t.data.size||t.data.length||0,"binary"===e?Rt(t.data,function(e){t.data=e,n()}):"base64"===e?qt(t.data,function(e){t.data=e,n()}):n()})}function Yt(t,e,n){return t.stub?n():void("string"==typeof t.data?Jt(t,e,n):Xt(t,e,n))}function Qt(t,e,n){function i(){r++,t.length===r&&(o?n(o):n())}if(!t.length)return n();var o,r=0;t.forEach(function(t){function n(t){o=t,s++,s===r.length&&i()}var r=t.data&&t.data._attachments?Object.keys(t.data._attachments):[],s=0;if(!r.length)return i();for(var a in t.data._attachments)t.data._attachments.hasOwnProperty(a)&&Yt(t.data._attachments[a],e,n)})}function te(t,e,n,i,o,r,s,a){if(st(e.rev_tree,n.metadata.rev))return i[o]=n,r();var u=e.winningRev||G(e),c="deleted"in e?e.deleted:ut(e,u),l="deleted"in n.metadata?n.metadata.deleted:ut(n.metadata),h=/^1-/.test(n.metadata.rev);if(c&&!l&&a&&h){var d=n.data;d._rev=u,d._id=n.metadata.id,n=At(d,a)}var f=rt(e.rev_tree,n.metadata.rev_tree[0],t),p=a&&(c&&l||!c&&"new_leaf"!==f.conflicts||c&&!l&&"new_branch"===f.conflicts);if(p){var m=D(io);return i[o]=m,r()}var _=n.metadata.rev;n.metadata.rev_tree=f.tree,n.stemmedRevs=f.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var v,g=G(n.metadata),y=ut(n.metadata,g),b=c===y?0:c<y?-1:1;v=_===g?y:ut(n.metadata,_),s(n,g,y,v,!0,b,o,r)}function ee(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}function ne(t,e,n,i,o,r,s,a,u){function c(t,e,n){var i=G(t.metadata),o=ut(t.metadata,i);if("was_delete"in a&&o)return r[e]=D(no,"deleted"),n();var u=h&&ee(t);if(u){var c=D(io);return r[e]=c,n()}var l=o?0:1;s(t,i,o,o,!1,l,e,n)}function l(){++f===p&&u&&u()}t=t||1e3;var h=a.new_edits,d=new m,f=0,p=e.length;e.forEach(function(t,e){if(t._id&&ct(t._id)){var i=t._deleted?"_removeLocal":"_putLocal";return void n[i](t,{ctx:o},function(t,n){r[e]=t||n,l()})}var s=t.metadata.id;d.has(s)?(p--,d.get(s).push([t,e])):d.set(s,[[t,e]])}),d.forEach(function(e,n){function o(){++u<e.length?a():l()}function a(){var a=e[u],l=a[0],d=a[1];if(i.has(n))te(t,i.get(n),l,r,d,o,s,h);else{var f=rt([],l.metadata.rev_tree[0],t);l.metadata.rev_tree=f.tree,l.stemmedRevs=f.stemmedRevs||[],c(l,d,o)}}var u=0;a()})}function ie(t){try{return JSON.parse(t)}catch(e){return Hi.parse(t)}}function oe(t){try{return JSON.stringify(t)}catch(e){return Hi.stringify(t)}}function re(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(D(mo,n,e.type))}}function se(t,e,n){return{data:oe(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function ae(t){if(!t)return null;var e=ie(t.data);return e.winningRev=t.winningRev,e.deleted="1"===t.deletedOrLocal,e.seq=t.seq,e}function ue(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function ce(t,e,n,i){n?i(t?"string"!=typeof t?t:jt(t,e):Bt([""],{type:e})):t?"string"!=typeof t?Nt(t,function(t){i(Do(t))}):i(t):i("")}function le(t,e,n,i){function o(){++a===s.length&&i&&i()}function r(t,e){var i=t._attachments[e],r=i.digest,s=n.objectStore(Uo).get(r);s.onsuccess=function(t){i.body=t.target.result.body,o()}}var s=Object.keys(t._attachments||{});if(!s.length)return i&&i();var a=0;s.forEach(function(n){e.attachments&&e.include_docs?r(t,n):(t._attachments[n].stub=!0,o())})}function he(t,e){return Vi.all(t.map(function(t){if(t.doc&&t.doc._attachments){var n=Object.keys(t.doc._attachments);return Vi.all(n.map(function(n){var i=t.doc._attachments[n];if("body"in i){var o=i.body,r=i.content_type;return new Vi(function(s){ce(o,r,e,function(e){t.doc._attachments[n]=k(d(i,["digest","content_type"]),{data:e}),s()})})}}))}}))}function de(t,e,n){function i(){c--,c||o()}function o(){r.length&&r.forEach(function(t){var e=u.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::",!1,!1));e.onsuccess=function(e){var n=e.target.result;n||a.delete(t)}})}var r=[],s=n.objectStore(Io),a=n.objectStore(Uo),u=n.objectStore(jo),c=t.length;t.forEach(function(t){var n=s.index("_doc_id_rev"),o=e+"::"+t;n.getKey(o).onsuccess=function(t){var e=t.target.result;if("number"!=typeof e)return i();s.delete(e);var n=u.index("seq").openCursor(IDBKeyRange.only(e));n.onsuccess=function(t){var e=t.target.result;if(e){var n=e.value.digestSeq.split("::")[0];r.push(n),u.delete(e.primaryKey),e.continue()}else i()}}})}function fe(t,e,n){try{return{txn:t.transaction(e,n)}}catch(t){return{error:t}}}function pe(t,e,n,i,o,r,s){function a(){var t=[Bo,Io,Uo,No,jo],e=fe(o,t,"readwrite");return e.error?s(e.error):(y=e.txn,y.onabort=re(s),y.ontimeout=re(s),y.oncomplete=l,b=y.objectStore(Bo),w=y.objectStore(Io),L=y.objectStore(Uo),x=y.objectStore(jo),void d(function(t){return t?(A=!0,s(t)):void c()}))}function u(){ne(t.revs_limit,C,i,M,y,O,f,n)}function c(){function t(){++n===C.length&&u()}function e(e){var n=ae(e.target.result);n&&M.set(n.id,n),t()}if(C.length)for(var n=0,i=0,o=C.length;i<o;i++){var r=C[i];if(r._id&&ct(r._id))t();else{var s=b.get(r.metadata.id);s.onsuccess=e}}}function l(){A||(r.notify(i._meta.name),i._meta.docCount+=S,s(null,O))}function h(t,e){var n=L.get(t);n.onsuccess=function(n){if(n.target.result)e();else{var i=D(go,"unknown stub attachment with digest "+t);i.status=412,e(i)}}}function d(t){function e(){++o===n.length&&t(i)}var n=[];if(C.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var i=t.data._attachments[e];i.stub&&n.push(i.digest)})}),!n.length)return t();var i,o=0;n.forEach(function(t){h(t,function(t){t&&!i&&(i=t),e()})})}function f(t,e,n,i,o,r,s,a){S+=r,t.metadata.winningRev=e,t.metadata.deleted=n;var u=t.data;u._id=t.metadata.id,u._rev=t.metadata.rev,i&&(u._deleted=!0);var c=u._attachments&&Object.keys(u._attachments).length;return c?_(t,e,n,o,s,a):void p(t,e,n,o,s,a)}function p(t,e,n,o,r,s){function a(r){var s=t.stemmedRevs||[];o&&i.auto_compaction&&(s=s.concat($(t.metadata))),s&&s.length&&de(s,t.metadata.id,y),h.seq=r.target.result;var a=se(h,e,n),u=b.put(a);u.onsuccess=c}function u(t){t.preventDefault(),t.stopPropagation();var e=w.index("_doc_id_rev"),n=e.getKey(l._doc_id_rev);n.onsuccess=function(t){var e=w.put(l,t.target.result);e.onsuccess=a}}function c(){O[r]={ok:!0,id:h.id,rev:h.rev},M.set(t.metadata.id,t.metadata),v(t,h.seq,s)}var l=t.data,h=t.metadata;l._doc_id_rev=h.id+"::"+h.rev,delete l._id,delete l._rev;var d=w.put(l);d.onsuccess=a,d.onerror=u}function _(t,e,n,i,o,r){function s(){c===l.length&&p(t,e,n,i,o,r)}function a(){c++,s()}var u=t.data,c=0,l=Object.keys(u._attachments);l.forEach(function(n){var i=t.data._attachments[n];if(i.stub)c++,s();else{var o=i.data;delete i.data,i.revpos=parseInt(e,10);var r=i.digest;g(r,o,a)}})}function v(t,e,n){function i(){++r===s.length&&n()}function o(n){var o=t.data._attachments[n].digest,r=x.put({seq:e,digestSeq:o+"::"+e});r.onsuccess=i,r.onerror=function(t){t.preventDefault(),t.stopPropagation(),i()}}var r=0,s=Object.keys(t.data._attachments||{});if(!s.length)return n();for(var a=0;a<s.length;a++)o(s[a])}function g(t,e,n){var i=L.count(t);i.onsuccess=function(i){var o=i.target.result;if(o)return n();var r={digest:t,body:e},s=L.put(r);s.onsuccess=n}}for(var y,b,w,L,x,E,C=e.docs,S=0,T=0,k=C.length;T<k;T++){var P=C[T];P._id&&ct(P._id)||(P=C[T]=At(P,n.new_edits),P.error&&!E&&(E=P))}if(E)return s(E);var O=new Array(C.length),M=new m,A=!1,B=i._meta.blobSupport?"blob":"base64";Qt(C,B,function(t){return t?s(t):void a()})}function me(t,e,n,i,o){try{if(t&&e)return o?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return o?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return o?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(i)return IDBKeyRange.only(i)}catch(t){return{error:t}}return null}function _e(t,e,n,i){return"DataError"===n.name&&0===n.code?i(null,{total_rows:t._meta.docCount,offset:e.skip,rows:[]}):void i(D(mo,n.name,n.message))}function ve(t,e,n,i){function o(t,i){function o(e,n,i){var o=e.id+"::"+i;x.get(o).onsuccess=function(i){if(n.doc=ue(i.target.result),t.conflicts){var o=K(e);o.length&&(n.doc._conflicts=o)}le(n.doc,t,y)}}function r(e,n,i){var r={id:i.id,key:i.id,value:{rev:n}},s=i.deleted;if("ok"===t.deleted)E.push(r),s?(r.value.deleted=!0,r.doc=null):t.include_docs&&o(i,r,n);else if(!s&&d--<=0&&(E.push(r),t.include_docs&&o(i,r,n),0===--f))return;e.continue()}function s(t){C=e._meta.docCount;var n=t.target.result;if(n){var i=ae(n.value),o=i.winningRev;r(n,o,i)}}function a(){i(null,{total_rows:C,offset:t.skip,rows:E})}function u(){t.attachments?he(E,t.binary).then(a):a()}var c="startkey"in t&&t.startkey,l="endkey"in t&&t.endkey,h="key"in t&&t.key,d=t.skip||0,f="number"==typeof t.limit?t.limit:-1,p=t.inclusive_end!==!1,m="descending"in t&&t.descending?"prev":null,_=me(c,l,p,h,m);if(_&&_.error)return _e(e,t,_.error,i);var v=[Bo,Io];t.attachments&&v.push(Uo);var g=fe(n,v,"readonly");if(g.error)return i(g.error);var y=g.txn,b=y.objectStore(Bo),w=y.objectStore(Io),L=m?b.openCursor(_,m):b.openCursor(_),x=w.index("_doc_id_rev"),E=[],C=0;y.oncomplete=u,L.onsuccess=s}function r(t,n){return 0===t.limit?n(null,{total_rows:e._meta.docCount,offset:t.skip,rows:[]}):void o(t,n)}r(t,i)}function ge(t){return new Vi(function(e){var n=Bt([""]);t.objectStore(Ro).put(n,"key"),t.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},t.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)}}).catch(function(){return!1})}function ye(t,e,n,i){try{t(e,n)}catch(t){i.emit("error",t)}}function be(){!qo&&Zo.length&&(qo=!0,Zo.shift()())}function we(t,e,n){Zo.push(function(){t(function(t,i){ye(e,t,i,n),qo=!1,Fi(function(){be(n)})})}),be()}function Le(t,e){var n=this;we(function(e){xe(n,t,e)},e,n.constructor)}function xe(t,e,n){function i(t){var e=t.createObjectStore(Bo,{keyPath:"id"});t.createObjectStore(Io,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),t.createObjectStore(Uo,{keyPath:"digest"}),t.createObjectStore(zo,{keyPath:"id",autoIncrement:!1}),t.createObjectStore(Ro),e.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.createObjectStore(No,{keyPath:"_id"});var n=t.createObjectStore(jo,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}function o(t,e){var n=t.objectStore(Bo);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(t){var i=t.target.result;if(i){var o=i.value,r=ut(o);o.deletedOrLocal=r?"1":"0",n.put(o),i.continue()}else e()}}function r(t){t.createObjectStore(No,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function s(t,e){var n=t.objectStore(No),i=t.objectStore(Bo),o=t.objectStore(Io),r=i.openCursor();r.onsuccess=function(t){var r=t.target.result;if(r){var s=r.value,a=s.id,u=ct(a),c=G(s);if(u){var l=a+"::"+c,h=a+"::",d=a+"::~",f=o.index("_doc_id_rev"),p=IDBKeyRange.bound(h,d,!1,!1),m=f.openCursor(p);m.onsuccess=function(t){if(m=t.target.result){var e=m.value;e._doc_id_rev===l&&n.put(e),o.delete(m.primaryKey),m.continue()}else i.delete(r.primaryKey),r.continue()}}else r.continue()}else e&&e()}}function a(t){var e=t.createObjectStore(jo,{autoIncrement:!0});e.createIndex("seq","seq"),e.createIndex("digestSeq","digestSeq",{unique:!0})}function c(t,e){var n=t.objectStore(Io),i=t.objectStore(Uo),o=t.objectStore(jo),r=i.count();r.onsuccess=function(t){var i=t.target.result;return i?void(n.openCursor().onsuccess=function(t){var n=t.target.result;if(!n)return e();for(var i=n.value,r=n.primaryKey,s=Object.keys(i._attachments||{}),a={},u=0;u<s.length;u++){
var c=i._attachments[s[u]];a[c.digest]=!0}var l=Object.keys(a);for(u=0;u<l.length;u++){var h=l[u];o.put({seq:r,digestSeq:h+"::"+r})}n.continue()}):e()}}function h(t){function e(t){return t.data?ae(t):(t.deleted="1"===t.deletedOrLocal,t)}var n=t.objectStore(Io),i=t.objectStore(Bo),o=i.openCursor();o.onsuccess=function(t){function o(){var t=a.id+"::",e=a.id+"::",i=n.index("_doc_id_rev").openCursor(IDBKeyRange.bound(t,e)),o=0;i.onsuccess=function(t){var e=t.target.result;if(!e)return a.seq=o,r();var n=e.primaryKey;n>o&&(o=n),e.continue()}}function r(){var t=se(a,a.winningRev,a.deleted),e=i.put(t);e.onsuccess=function(){s.continue()}}var s=t.target.result;if(s){var a=e(s.value);return a.winningRev=a.winningRev||G(a),a.seq?r():void o()}}}var d=e.name,f=null;t._meta=null,t.type=function(){return"idb"},t._id=l(function(e){e(null,t._meta.instanceId)}),t._bulkDocs=function(n,i,o){pe(e,n,i,t,f,Go,o)},t._get=function(t,e,n){function i(){n(s,{doc:o,metadata:r,ctx:a})}var o,r,s,a=e.ctx;if(!a){var u=fe(f,[Bo,Io,Uo],"readonly");if(u.error)return n(u.error);a=u.txn}a.objectStore(Bo).get(t).onsuccess=function(t){if(r=ae(t.target.result),!r)return s=D(no,"missing"),i();var n;if(e.rev)n=e.latest?lt(e.rev,r):e.rev;else{n=r.winningRev;var u=ut(r);if(u)return s=D(no,"deleted"),i()}var c=a.objectStore(Io),l=r.id+"::"+n;c.index("_doc_id_rev").get(l).onsuccess=function(t){return o=t.target.result,o&&(o=ue(o)),o?void i():(s=D(no,"missing"),i())}}},t._getAttachment=function(t,e,n,i,o){var r;if(i.ctx)r=i.ctx;else{var s=fe(f,[Bo,Io,Uo],"readonly");if(s.error)return o(s.error);r=s.txn}var a=n.digest,u=n.content_type;r.objectStore(Uo).get(a).onsuccess=function(t){var e=t.target.result.body;ce(e,u,i.binary,function(t){o(null,t)})}},t._info=function(e){if(null===f||!Fo.has(d)){var n=new Error("db isn't open");return n.id="idbNull",e(n)}var i,o,r=fe(f,[Io],"readonly");if(r.error)return e(r.error);var s=r.txn,a=s.objectStore(Io).openCursor(null,"prev");a.onsuccess=function(e){var n=e.target.result;i=n?n.key:0,o=t._meta.docCount},s.oncomplete=function(){e(null,{doc_count:o,update_seq:i,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(e,n){ve(e,t,f,n)},t._changes=function(e){function n(t){function n(){return u.seq!==s?t.continue():(c=s,u.winningRev===r._rev?o(r):void i())}function i(){var t=r._id+"::"+u.winningRev,e=y.get(t);e.onsuccess=function(t){o(ue(t.target.result))}}function o(n){var i=e.processChange(n,u,e);i.seq=u.seq;var o=L(i);return"object"==typeof o?e.complete(o):(o&&(w++,h&&b.push(i),e.attachments&&e.include_docs?le(n,e,p,function(){he([i],e.binary).then(function(){e.onChange(i)})}):e.onChange(i)),void(w!==l&&t.continue()))}var r=ue(t.value),s=t.key;if(a&&!a.has(r._id))return t.continue();var u;return(u=x.get(r._id))?n():void(g.get(r._id).onsuccess=function(t){u=ae(t.target.result),x.set(r._id,u),n()})}function i(t){var e=t.target.result;e&&n(e)}function o(){var t=[Bo,Io];e.attachments&&t.push(Uo);var n=fe(f,t,"readonly");if(n.error)return e.complete(n.error);p=n.txn,p.onabort=re(e.complete),p.oncomplete=r,v=p.objectStore(Io),g=p.objectStore(Bo),y=v.index("_doc_id_rev");var o;o=e.descending?v.openCursor(null,"prev"):v.openCursor(IDBKeyRange.lowerBound(e.since,!0)),o.onsuccess=i}function r(){function t(){e.complete(null,{results:b,last_seq:c})}!e.continuous&&e.attachments?he(b).then(t):t()}if(e=u(e),e.continuous){var s=d+":"+F();return Go.addListener(d,s,t,e),Go.notify(d),{cancel:function(){Go.removeListener(d,s)}}}var a=e.doc_ids&&new _(e.doc_ids);e.since=e.since||0;var c=e.since,l="limit"in e?e.limit:-1;0===l&&(l=1);var h;h="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var p,v,g,y,b=[],w=0,L=A(e),x=new m;o()},t._close=function(t){return null===f?t(D(ao)):(f.close(),Fo.delete(d),f=null,void t())},t._getRevisionTree=function(t,e){var n=fe(f,[Bo],"readonly");if(n.error)return e(n.error);var i=n.txn,o=i.objectStore(Bo).get(t);o.onsuccess=function(t){var n=ae(t.target.result);n?e(null,n.rev_tree):e(D(no))}},t._doCompaction=function(t,e,n){var i=[Bo,Io,Uo,jo],o=fe(f,i,"readwrite");if(o.error)return n(o.error);var r=o.txn,s=r.objectStore(Bo);s.get(t).onsuccess=function(n){var i=ae(n.target.result);W(i.rev_tree,function(t,n,i,o,r){var s=n+"-"+i;e.indexOf(s)!==-1&&(r.status="missing")}),de(e,t,r);var o=i.winningRev,s=i.deleted;r.objectStore(Bo).put(se(i,o,s))},r.onabort=re(n),r.oncomplete=function(){n()}},t._getLocal=function(t,e){var n=fe(f,[No],"readonly");if(n.error)return e(n.error);var i=n.txn,o=i.objectStore(No).get(t);o.onerror=re(e),o.onsuccess=function(t){var n=t.target.result;n?(delete n._doc_id_rev,e(null,n)):e(D(no))}},t._putLocal=function(t,e,n){"function"==typeof e&&(n=e,e={}),delete t._revisions;var i=t._rev,o=t._id;i?t._rev="0-"+(parseInt(i.split("-")[1],10)+1):t._rev="0-1";var r,s=e.ctx;if(!s){var a=fe(f,[No],"readwrite");if(a.error)return n(a.error);s=a.txn,s.onerror=re(n),s.oncomplete=function(){r&&n(null,r)}}var u,c=s.objectStore(No);i?(u=c.get(o),u.onsuccess=function(o){var s=o.target.result;if(s&&s._rev===i){var a=c.put(t);a.onsuccess=function(){r={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,r)}}else n(D(io))}):(u=c.add(t),u.onerror=function(t){n(D(io)),t.preventDefault(),t.stopPropagation()},u.onsuccess=function(){r={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,r)})},t._removeLocal=function(t,e,n){"function"==typeof e&&(n=e,e={});var i=e.ctx;if(!i){var o=fe(f,[No],"readwrite");if(o.error)return n(o.error);i=o.txn,i.oncomplete=function(){r&&n(null,r)}}var r,s=t._id,a=i.objectStore(No),u=a.get(s);u.onerror=re(n),u.onsuccess=function(i){var o=i.target.result;o&&o._rev===t._rev?(a.delete(s),r={ok:!0,id:s,rev:"0-0"},e.ctx&&n(null,r)):n(D(no))}},t._destroy=function(t,e){Go.removeAllListeners(d);var n=Wo.get(d);n&&n.result&&(n.result.close(),Fo.delete(d));var i=indexedDB.deleteDatabase(d);i.onsuccess=function(){Wo.delete(d),w()&&d in localStorage&&delete localStorage[d],e(null,{ok:!0})},i.onerror=re(e)};var p=Fo.get(d);if(p)return f=p.idb,t._meta=p.global,Fi(function(){n(null,t)});var v;v=e.storage?Ee(d,e.storage):indexedDB.open(d,Ao),Wo.set(d,v),v.onupgradeneeded=function(t){function e(){var t=l[d-1];d++,t&&t(u,e)}var n=t.target.result;if(t.oldVersion<1)return i(n);var u=t.currentTarget.transaction;t.oldVersion<3&&r(n),t.oldVersion<4&&a(n);var l=[o,s,c,h],d=t.oldVersion;e()},v.onsuccess=function(e){f=e.target.result,f.onversionchange=function(){f.close(),Fo.delete(d)},f.onabort=function(t){E("error","Database has a global failure",t.target.error),f.close(),Fo.delete(d)};var i=f.transaction([zo,Ro,Bo],"readwrite"),o=i.objectStore(zo).get(zo),r=null,s=null,a=null;o.onsuccess=function(e){var o=function(){null!==r&&null!==s&&null!==a&&(t._meta={name:d,instanceId:a,blobSupport:r,docCount:s},Fo.set(d,{idb:f,global:t._meta}),n(null,t))},u=e.target.result||{id:zo};d+"_id"in u?(a=u[d+"_id"],o()):(a=F(),u[d+"_id"]=a,i.objectStore(zo).put(u).onsuccess=function(){o()}),So||(So=ge(i)),So.then(function(t){r=t,o()});var c=i.objectStore(Bo).index("deletedOrLocal");c.count(IDBKeyRange.only("0")).onsuccess=function(t){s=t.target.result,o()}}},v.onerror=function(){var t="Failed to open indexedDB, are you in private browsing mode?";E("error",t),n(D(mo,t))}}function Ee(t,e){try{return indexedDB.open(t,{version:Ao,storage:e})}catch(e){return indexedDB.open(t,Ao)}}function Ce(t){t.adapter("idb",Le,!0)}function Se(t){return decodeURIComponent(escape(t))}function Te(t){return t<65?t-48:t-55}function ke(t,e,n){for(var i="";e<n;)i+=String.fromCharCode(Te(t.charCodeAt(e++))<<4|Te(t.charCodeAt(e++)));return i}function Pe(t,e,n){for(var i="";e<n;)i+=String.fromCharCode(Te(t.charCodeAt(e+2))<<12|Te(t.charCodeAt(e+3))<<8|Te(t.charCodeAt(e))<<4|Te(t.charCodeAt(e+1))),e+=4;return i}function De(t,e){return"UTF-8"===e?Se(ke(t,0,t.length)):Pe(t,0,t.length)}function Oe(t){return"'"+t+"'"}function Me(t){return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function Ae(t){return t.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Be(t){return delete t._id,delete t._rev,JSON.stringify(t)}function Ie(t,e,n){return t=JSON.parse(t),t._id=e,t._rev=n,t}function Ue(t){for(var e="(";t--;)e+="?",t&&(e+=",");return e+")"}function je(t,e,n,i,o){return"SELECT "+t+" FROM "+("string"==typeof e?e:e.join(" JOIN "))+(n?" ON "+n:"")+(i?" WHERE "+("string"==typeof i?i:i.join(" AND ")):"")+(o?" ORDER BY "+o:"")}function ze(t,e,n){function i(){++r===t.length&&o()}function o(){if(s.length){var t="SELECT DISTINCT digest AS digest FROM "+Yo+" WHERE seq IN "+Ue(s.length);n.executeSql(t,s,function(t,e){for(var n=[],i=0;i<e.rows.length;i++)n.push(e.rows.item(i).digest);if(n.length){var o="DELETE FROM "+Yo+" WHERE seq IN ("+s.map(function(){return"?"}).join(",")+")";t.executeSql(o,s,function(t){var e="SELECT digest FROM "+Yo+" WHERE digest IN ("+n.map(function(){return"?"}).join(",")+")";t.executeSql(e,n,function(t,e){for(var i=new _,o=0;o<e.rows.length;o++)i.add(e.rows.item(o).digest);n.forEach(function(e){i.has(e)||(t.executeSql("DELETE FROM "+Yo+" WHERE digest=?",[e]),t.executeSql("DELETE FROM "+$o+" WHERE digest=?",[e]))})})})}})}}if(t.length){var r=0,s=[];t.forEach(function(t){var o="SELECT seq FROM "+Ko+" WHERE doc_id=? AND rev=?";n.executeSql(o,[e,t],function(t,e){if(!e.rows.length)return i();var n=e.rows.item(0).seq;s.push(n),t.executeSql("DELETE FROM "+Ko+" WHERE seq=?",[n],i)})})}}function Ne(t){return function(e){E("error","WebSQL threw an error",e);var n=e&&e.constructor.toString().match(/function ([^\(]+)/),i=n&&n[1]||e.type,o=e.target||e.message;t(D(_o,o,i))}}function Re(t){if("size"in t)return 1e6*t.size;var e="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return e?5e6:1}function qe(t,e,n,i,o,r,s){function a(){return b?s(b):(r.notify(i._name),i._docCount=-1,void s(null,w))}function u(t,e){var n="SELECT count(*) as cnt FROM "+$o+" WHERE digest=?";y.executeSql(n,[t],function(n,i){if(0===i.rows.item(0).cnt){var o=D(go,"unknown stub attachment with digest "+t);e(o)}else e()})}function c(t){function e(){++o===n.length&&t(i)}var n=[];if(v.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var i=t.data._attachments[e];i.stub&&n.push(i.digest)})}),!n.length)return t();var i,o=0;n.forEach(function(t){u(t,function(t){t&&!i&&(i=t),e()})})}function l(t,e,n,o,r,s,a,u){function c(){function e(t,e){function i(){return++r===s.length&&e(),!1}function o(e){var o="INSERT INTO "+Yo+" (digest, seq) VALUES (?,?)",r=[n._attachments[e].digest,t];y.executeSql(o,r,i,i)}var r=0,s=Object.keys(n._attachments||{});if(!s.length)return e();for(var a=0;a<s.length;a++)o(s[a])}var n=t.data,i=o?1:0,r=n._id,s=n._rev,a=Be(n),u="INSERT INTO "+Ko+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",c=[r,s,a,i];y.executeSql(u,c,function(t,n){var i=n.insertId;e(i,function(){d(t,i)})},function(){var t=je("seq",Ko,null,"doc_id=? AND rev=?");return y.executeSql(t,[r,s],function(t,n){var o=n.rows.item(0).seq,u="UPDATE "+Ko+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",c=[a,i,r,s];t.executeSql(u,c,function(t){e(o,function(){d(t,o)})})}),!1})}function l(t){p||(t?(p=t,u(p)):m===_.length&&c())}function h(t){m++,l(t)}function d(n,o){var s=t.metadata.id,c=t.stemmedRevs||[];r&&i.auto_compaction&&(c=$(t.metadata).concat(c)),c.length&&ze(c,s,n),t.metadata.seq=o;var l=t.metadata.rev;delete t.metadata.rev;var h=r?"UPDATE "+Vo+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+Ko+" WHERE doc_id="+Vo+".id AND rev=?) WHERE id=?":"INSERT INTO "+Vo+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",d=oe(t.metadata),f=r?[d,o,e,s]:[s,o,o,d];n.executeSql(h,f,function(){w[a]={ok:!0,id:t.metadata.id,rev:l},L.set(s,t.metadata),u()})}var p=null,m=0;t.data._id=t.metadata.id,t.data._rev=t.metadata.rev;var _=Object.keys(t.data._attachments||{});o&&(t.data._deleted=!0),_.forEach(function(n){var i=t.data._attachments[n];if(i.stub)m++,l();else{var o=i.data;delete i.data,i.revpos=parseInt(e,10);var r=i.digest;f(r,o,h)}}),_.length||c()}function h(){ne(t.revs_limit,v,i,L,y,w,l,n)}function d(t){function e(){++n===v.length&&t()}if(!v.length)return t();var n=0;v.forEach(function(t){if(t._id&&ct(t._id))return e();var n=t.metadata.id;y.executeSql("SELECT json FROM "+Vo+" WHERE id = ?",[n],function(t,i){if(i.rows.length){var o=ie(i.rows.item(0).json);L.set(n,o)}e()})})}function f(t,e,n){var i="SELECT digest FROM "+$o+" WHERE digest=?";y.executeSql(i,[t],function(o,r){return r.rows.length?n():(i="INSERT INTO "+$o+" (digest, body, escaped) VALUES (?,?,1)",void o.executeSql(i,[t,Me(e)],function(){n()},function(){return n(),!1}))})}var p=n.new_edits,_=e.docs,v=_.map(function(t){if(t._id&&ct(t._id))return t;var e=At(t,p);return e}),g=v.filter(function(t){return t.error});if(g.length)return s(g[0]);var y,b,w=new Array(v.length),L=new m;Qt(v,"binary",function(t){return t?s(t):void o.transaction(function(t){y=t,c(function(t){t?b=t:d(h)})},Ne(s),a)})}function Ze(t){return t.websql(t.name,t.version,t.description,t.size)}function Fe(t){try{return{db:Ze(t)}}catch(t){return{error:t}}}function Ge(t){var e=Qo.get(t.name);return e||(e=Fe(t),Qo.set(t.name,e)),e}function We(t,e,n,i,o){function r(){++u===a.length&&o&&o()}function s(t,o){var s=t._attachments[o],a={binary:e.binary,ctx:i};n._getAttachment(t._id,o,s,a,function(e,n){t._attachments[o]=k(d(s,["digest","content_type"]),{data:n}),r()})}var a=Object.keys(t._attachments||{});if(!a.length)return o&&o();var u=0;a.forEach(function(n){e.attachments&&e.include_docs?s(t,n):(t._attachments[n].stub=!0,r())})}function He(t,e){function n(){w()&&(window.localStorage["_pouch__websqldb_"+y._name]=!0),e(null,y)}function i(t,e){t.executeSql(or),t.executeSql("ALTER TABLE "+Ko+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){t.executeSql(nr),t.executeSql("ALTER TABLE "+Vo+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){t.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Vo+" (local, id)");var n="SELECT "+Vo+".winningseq AS seq, "+Vo+".json AS metadata FROM "+Ko+" JOIN "+Vo+" ON "+Ko+".seq = "+Vo+".winningseq";t.executeSql(n,[],function(t,n){for(var i=[],o=[],r=0;r<n.rows.length;r++){var s=n.rows.item(r),a=s.seq,u=JSON.parse(s.metadata);ut(u)&&i.push(a),ct(u.id)&&o.push(u.id)}t.executeSql("UPDATE "+Vo+"SET local = 1 WHERE id IN "+Ue(o.length),o,function(){t.executeSql("UPDATE "+Ko+" SET deleted = 1 WHERE seq IN "+Ue(i.length),i,e)})})})})}function o(t,e){var n="CREATE TABLE IF NOT EXISTS "+Jo+" (id UNIQUE, rev, json)";t.executeSql(n,[],function(){var n="SELECT "+Vo+".id AS id, "+Ko+".json AS data FROM "+Ko+" JOIN "+Vo+" ON "+Ko+".seq = "+Vo+".winningseq WHERE local = 1";t.executeSql(n,[],function(t,n){function i(){if(!o.length)return e(t);var n=o.shift(),r=JSON.parse(n.data)._rev;t.executeSql("INSERT INTO "+Jo+" (id, rev, json) VALUES (?,?,?)",[n.id,r,n.data],function(t){t.executeSql("DELETE FROM "+Vo+" WHERE id=?",[n.id],function(t){t.executeSql("DELETE FROM "+Ko+" WHERE seq=?",[n.seq],function(){i()})})})}for(var o=[],r=0;r<n.rows.length;r++)o.push(n.rows.item(r));i()})})}function r(t,e){function n(n){function i(){if(!n.length)return e(t);var o=n.shift(),r=De(o.hex,g),s=r.lastIndexOf("::"),a=r.substring(0,s),u=r.substring(s+2),c="UPDATE "+Ko+" SET doc_id=?, rev=? WHERE doc_id_rev=?";t.executeSql(c,[a,u,r],function(){i()})}i()}var i="ALTER TABLE "+Ko+" ADD COLUMN doc_id";t.executeSql(i,[],function(t){var e="ALTER TABLE "+Ko+" ADD COLUMN rev";t.executeSql(e,[],function(t){t.executeSql(ir,[],function(t){var e="SELECT hex(doc_id_rev) as hex FROM "+Ko;t.executeSql(e,[],function(t,e){for(var i=[],o=0;o<e.rows.length;o++)i.push(e.rows.item(o));n(i)})})})})}function s(t,e){function n(t){var n="SELECT COUNT(*) AS cnt FROM "+$o;t.executeSql(n,[],function(t,n){function i(){var n=je(ur+", "+Vo+".id AS id",[Vo,Ko],ar,null,Vo+".id ");n+=" LIMIT "+s+" OFFSET "+r,r+=s,t.executeSql(n,[],function(t,n){function o(t,e){var n=r[t]=r[t]||[];n.indexOf(e)===-1&&n.push(e)}if(!n.rows.length)return e(t);for(var r={},s=0;s<n.rows.length;s++)for(var a=n.rows.item(s),u=Ie(a.data,a.id,a.rev),c=Object.keys(u._attachments||{}),l=0;l<c.length;l++){var h=u._attachments[c[l]];o(h.digest,a.seq)}var d=[];if(Object.keys(r).forEach(function(t){var e=r[t];e.forEach(function(e){d.push([t,e])})}),!d.length)return i();var f=0;d.forEach(function(e){var n="INSERT INTO "+Yo+" (digest, seq) VALUES (?,?)";t.executeSql(n,e,function(){++f===d.length&&i()})})})}var o=n.rows.item(0).cnt;if(!o)return e(t);var r=0,s=10;i()})}var i="CREATE TABLE IF NOT EXISTS "+Yo+" (digest, seq INTEGER)";t.executeSql(i,[],function(t){t.executeSql(sr,[],function(t){t.executeSql(rr,[],n)})})}function a(t,e){var n="ALTER TABLE "+$o+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";t.executeSql(n,[],e)}function c(t,e){var n="ALTER TABLE "+Vo+" ADD COLUMN max_seq INTEGER";t.executeSql(n,[],function(t){var n="UPDATE "+Vo+" SET max_seq=(SELECT MAX(seq) FROM "+Ko+" WHERE doc_id=id)";t.executeSql(n,[],function(t){var n="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Vo+" (max_seq)";t.executeSql(n,[],e)})})}function h(t,e){t.executeSql('SELECT HEX("a") AS hex',[],function(t,n){var i=n.rows.item(0).hex;g=2===i.length?"UTF-8":"UTF-16",e()})}function d(){for(;x.length>0;){var t=x.pop();t(null,b)}}function f(t,e){if(0===e){var n="CREATE TABLE IF NOT EXISTS "+Xo+" (dbid, db_version INTEGER)",u="CREATE TABLE IF NOT EXISTS "+$o+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",l="CREATE TABLE IF NOT EXISTS "+Yo+" (digest, seq INTEGER)",h="CREATE TABLE IF NOT EXISTS "+Vo+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",f="CREATE TABLE IF NOT EXISTS "+Ko+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",p="CREATE TABLE IF NOT EXISTS "+Jo+" (id UNIQUE, rev, json)";t.executeSql(u),t.executeSql(p),t.executeSql(l,[],function(){t.executeSql(rr),t.executeSql(sr)}),t.executeSql(h,[],function(){t.executeSql(or),t.executeSql(f,[],function(){t.executeSql(nr),t.executeSql(ir),t.executeSql(n,[],function(){var e="INSERT INTO "+Xo+" (db_version, dbid) VALUES (?,?)";b=F();var n=[Ho,b];t.executeSql(e,n,function(){d()})})})})}else{var m=function(){var n=e<Ho;n&&t.executeSql("UPDATE "+Xo+" SET db_version = "+Ho);var i="SELECT dbid FROM "+Xo;t.executeSql(i,[],function(t,e){b=e.rows.item(0).dbid,d()})},_=[i,o,r,s,a,c,m],v=e,g=function(t){_[v-1](t,g),v++};g(t)}}function p(){S.transaction(function(t){h(t,function(){m(t)})},Ne(e),n)}function m(t){var e="SELECT sql FROM sqlite_master WHERE tbl_name = "+Xo;t.executeSql(e,[],function(t,e){e.rows.length?/db_version/.test(e.rows.item(0).sql)?t.executeSql("SELECT db_version FROM "+Xo,[],function(t,e){var n=e.rows.item(0).db_version;f(t,n)}):t.executeSql("ALTER TABLE "+Xo+" ADD COLUMN db_version INTEGER",[],function(){f(t,1)}):f(t,0)})}function _(t,e,n,i,o){var r=je(ur,[Vo,Ko],ar,Vo+".id=?"),s=[e];t.executeSql(r,s,function(t,e){if(!e.rows.length){var r=D(no,"missing");return o(r)}var s=e.rows.item(0),a=ie(s.metadata);i(lt(n,a))})}function v(t,e){if(y._docCount!==-1)return e(y._docCount);var n=je("COUNT("+Vo+".id) AS 'num'",[Vo,Ko],ar,Ko+".deleted=0");t.executeSql(n,[],function(t,n){y._docCount=n.rows.item(0).num,e(y._docCount)})}var g,y=this,b=null,L=Re(t),x=[];y._docCount=-1,y._name=t.name;var E=k({},t,{version:er,description:t.name,size:L}),C=Ge(E);if(C.error)return Ne(e)(C.error);var S=C.db;"function"!=typeof S.readTransaction&&(S.readTransaction=S.transaction),p(),y.type=function(){return"websql"},y._id=l(function(t){t(null,b)}),y._info=function(t){S.readTransaction(function(e){v(e,function(n){var i="SELECT MAX(seq) AS seq FROM "+Ko;e.executeSql(i,[],function(e,i){var o=i.rows.item(0).seq||0;t(null,{doc_count:n,update_seq:o,websql_encoding:g})})})},Ne(t))},y._bulkDocs=function(e,n,i){qe(t,e,n,y,S,tr,i)},y._get=function(t,e,n){function i(t){n(t,{doc:o,metadata:r,ctx:s})}var o,r,s=e.ctx;if(!s)return S.readTransaction(function(i){y._get(t,k({ctx:i},e),n)});var a,u;if(e.rev){if(e.latest)return void _(s,t,e.rev,function(i){e.latest=!1,e.rev=i,y._get(t,e,n)},i);a=je(ur,[Vo,Ko],Vo+".id="+Ko+".doc_id",[Ko+".doc_id=?",Ko+".rev=?"]),u=[t,e.rev]}else a=je(ur,[Vo,Ko],ar,Vo+".id=?"),u=[t];s.executeSql(a,u,function(t,n){if(!n.rows.length){var s=D(no,"missing");return i(s)}var a=n.rows.item(0);if(r=ie(a.metadata),a.deleted&&!e.rev){var u=D(no,"deleted");return i(u)}o=Ie(a.data,r.id,a.rev),i()})},y._allDocs=function(t,e){var n,i=[],o="startkey"in t&&t.startkey,r="endkey"in t&&t.endkey,s="key"in t&&t.key,a="descending"in t&&t.descending,u="limit"in t?t.limit:-1,c="skip"in t?t.skip:0,l=t.inclusive_end!==!1,h=[],d=[];if(s!==!1)d.push(Vo+".id = ?"),h.push(s);else if(o!==!1||r!==!1){if(o!==!1&&(d.push(Vo+".id "+(a?"<=":">=")+" ?"),h.push(o)),r!==!1){var f=a?">":"<";l&&(f+="="),d.push(Vo+".id "+f+" ?"),h.push(r)}s!==!1&&(d.push(Vo+".id = ?"),h.push(s))}"ok"!==t.deleted&&d.push(Ko+".deleted = 0"),S.readTransaction(function(e){v(e,function(o){if(n=o,0!==u){var r=je(ur,[Vo,Ko],ar,d,Vo+".id "+(a?"DESC":"ASC"));r+=" LIMIT "+u+" OFFSET "+c,e.executeSql(r,h,function(e,n){for(var o=0,r=n.rows.length;o<r;o++){var s=n.rows.item(o),a=ie(s.metadata),u=a.id,c=Ie(s.data,u,s.rev),l=c._rev,h={id:u,key:u,value:{rev:l}};if(t.include_docs){if(h.doc=c,h.doc._rev=l,t.conflicts){var d=K(a);d.length&&(h.doc._conflicts=d)}We(h.doc,t,y,e)}if(s.deleted){if("ok"!==t.deleted)continue;h.value.deleted=!0,h.doc=null}i.push(h)}})}})},Ne(e),function(){e(null,{total_rows:n,offset:t.skip,rows:i})})},y._changes=function(t){function e(){var e=Vo+".json AS metadata, "+Vo+".max_seq AS maxSeq, "+Ko+".json AS winningDoc, "+Ko+".rev AS winningRev ",n=Vo+" JOIN "+Ko,u=Vo+".id="+Ko+".doc_id AND "+Vo+".winningseq="+Ko+".seq",c=["maxSeq > ?"],l=[t.since];t.doc_ids&&(c.push(Vo+".id IN "+Ue(t.doc_ids.length)),l=l.concat(t.doc_ids));var h="maxSeq "+(i?"DESC":"ASC"),d=je(e,n,u,c,h),f=A(t);t.view||t.filter||(d+=" LIMIT "+o);var p=t.since||0;S.readTransaction(function(e){e.executeSql(d,l,function(e,n){function i(e){return function(){t.onChange(e)}}for(var u=0,c=n.rows.length;u<c;u++){var l=n.rows.item(u),h=ie(l.metadata);p=l.maxSeq;var d=Ie(l.winningDoc,h.id,l.winningRev),m=t.processChange(d,h,t);m.seq=l.maxSeq;var _=f(m);if("object"==typeof _)return t.complete(_);if(_&&(a++,r&&s.push(m),t.attachments&&t.include_docs?We(d,t,y,e,i(m)):i(m)()),a===o)break}})},Ne(t.complete),function(){t.continuous||t.complete(null,{results:s,last_seq:p})})}if(t=u(t),t.continuous){var n=y._name+":"+F();return tr.addListener(y._name,n,y,t),tr.notify(y._name),{cancel:function(){tr.removeListener(y._name,n)}}}var i=t.descending;t.since=t.since&&!i?t.since:0;var o="limit"in t?t.limit:-1;0===o&&(o=1);var r;r="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var s=[],a=0;e()},y._close=function(t){t()},y._getAttachment=function(t,e,n,i,o){var r,s=i.ctx,a=n.digest,u=n.content_type,c="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+$o+" WHERE digest=?";s.executeSql(c,[a],function(t,e){var n=e.rows.item(0),s=n.escaped?Ae(n.body):De(n.body,g);r=i.binary?Ut(s,u):Do(s),o(null,r)})},y._getRevisionTree=function(t,e){S.readTransaction(function(n){var i="SELECT json AS metadata FROM "+Vo+" WHERE id = ?";n.executeSql(i,[t],function(t,n){if(n.rows.length){var i=ie(n.rows.item(0).metadata);e(null,i.rev_tree)}else e(D(no))})})},y._doCompaction=function(t,e,n){return e.length?void S.transaction(function(n){var i="SELECT json AS metadata FROM "+Vo+" WHERE id = ?";n.executeSql(i,[t],function(n,i){var o=ie(i.rows.item(0).metadata);W(o.rev_tree,function(t,n,i,o,r){var s=n+"-"+i;e.indexOf(s)!==-1&&(r.status="missing")});var r="UPDATE "+Vo+" SET json = ? WHERE id = ?";n.executeSql(r,[oe(o),t])}),ze(e,t,n)},Ne(n),function(){n()}):n()},y._getLocal=function(t,e){S.readTransaction(function(n){var i="SELECT json, rev FROM "+Jo+" WHERE id=?";n.executeSql(i,[t],function(n,i){if(i.rows.length){var o=i.rows.item(0),r=Ie(o.json,t,o.rev);e(null,r)}else e(D(no))})})},y._putLocal=function(t,e,n){function i(t){var i,c;r?(i="UPDATE "+Jo+" SET rev=?, json=? WHERE id=? AND rev=?",c=[o,u,s,r]):(i="INSERT INTO "+Jo+" (id, rev, json) VALUES (?,?,?)",c=[s,o,u]),t.executeSql(i,c,function(t,i){i.rowsAffected?(a={ok:!0,id:s,rev:o},e.ctx&&n(null,a)):n(D(io))},function(){return n(D(io)),!1})}"function"==typeof e&&(n=e,e={}),delete t._revisions;var o,r=t._rev,s=t._id;o=r?t._rev="0-"+(parseInt(r.split("-")[1],10)+1):t._rev="0-1";var a,u=Be(t);e.ctx?i(e.ctx):S.transaction(i,Ne(n),function(){a&&n(null,a)})},y._removeLocal=function(t,e,n){function i(i){var r="DELETE FROM "+Jo+" WHERE id=? AND rev=?",s=[t._id,t._rev];i.executeSql(r,s,function(i,r){return r.rowsAffected?(o={ok:!0,id:t._id,rev:"0-0"},void(e.ctx&&n(null,o))):n(D(no))})}"function"==typeof e&&(n=e,e={});var o;e.ctx?i(e.ctx):S.transaction(i,Ne(n),function(){o&&n(null,o)})},y._destroy=function(t,e){tr.removeAllListeners(y._name),S.transaction(function(t){var e=[Vo,Ko,$o,Xo,Jo,Yo];e.forEach(function(e){t.executeSql("DROP TABLE IF EXISTS "+e,[])})},Ne(e),function(){w()&&(delete window.localStorage["_pouch__websqldb_"+y._name],delete window.localStorage[y._name]),e(null,{ok:!0})})}}function Ve(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(t){return!1}}function Ke(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var t=w(),e="_pouch__websqldb_valid_"+navigator.userAgent;if(t&&localStorage[e])return"1"===localStorage[e];var n=Ve();return t&&(localStorage[e]=n?"1":"0"),n}function $e(){return"function"==typeof openDatabase&&Ke()}function Je(t,e,n,i){return openDatabase(t,e,n,i)}function Xe(t,e){var n=k({websql:Je},t);He.call(this,n,e)}function Ye(t){t.adapter("websql",Xe,!0)}function Qe(){for(var t={},e=new Vi(function(e,n){t.resolve=e,t.reject=n}),n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return t.promise=e,Vi.resolve().then(function(){return fetch.apply(null,n)}).then(function(e){t.resolve(e)}).catch(function(e){t.reject(e)}),t}function tn(t,e){var n,i,o,r=new Headers,s={method:t.method,credentials:"include",headers:r};return t.json&&(r.set("Accept","application/json"),r.set("Content-Type",t.headers["Content-Type"]||"application/json")),t.body&&t.processData&&"string"!=typeof t.body?s.body=JSON.stringify(t.body):"body"in t?s.body=t.body:s.body=null,Object.keys(t.headers).forEach(function(e){t.headers.hasOwnProperty(e)&&r.set(e,t.headers[e])}),n=Qe(t.url,s),t.timeout>0&&(i=setTimeout(function(){n.reject(new Error("Load timeout for resource: "+t.url))},t.timeout)),n.promise.then(function(e){return o={statusCode:e.status},t.timeout>0&&clearTimeout(i),o.statusCode>=200&&o.statusCode<300?t.binary?e.blob():e.text():e.json()}).then(function(t){o.statusCode>=200&&o.statusCode<300?e(null,o,t):(t.status=o.statusCode,e(t))}).catch(function(t){t||(t=new Error("canceled")),e(t)}),{abort:n.reject}}function en(t,e){var n,i,o=!1,r=function(){n.abort(),u()},s=function(){o=!0,n.abort(),u()},a={abort:r},u=function(){clearTimeout(i),a.abort=function(){},n&&(n.onprogress=void 0,n.upload&&(n.upload.onprogress=void 0),n.onreadystatechange=void 0,n=void 0)};n=t.xhr?new t.xhr:new XMLHttpRequest;try{n.open(t.method,t.url)}catch(t){return e(new Error(t.name||"Url is invalid"))}n.withCredentials=!("withCredentials"in t)||t.withCredentials,"GET"===t.method?delete t.headers["Content-Type"]:t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.body&&t.processData&&"string"!=typeof t.body&&(t.body=JSON.stringify(t.body))),t.binary&&(n.responseType="arraybuffer"),"body"in t||(t.body=null);for(var c in t.headers)t.headers.hasOwnProperty(c)&&n.setRequestHeader(c,t.headers[c]);return t.timeout>0&&(i=setTimeout(s,t.timeout),n.onprogress=function(){clearTimeout(i),4!==n.readyState&&(i=setTimeout(s,t.timeout))},"undefined"!=typeof n.upload&&(n.upload.onprogress=n.onprogress)),n.onreadystatechange=function(){if(4===n.readyState){var i={statusCode:n.status};if(n.status>=200&&n.status<300){var r;r=t.binary?Bt([n.response||""],{type:n.getResponseHeader("Content-Type")}):n.responseText,e(null,i,r)}else{var s={};if(o)s=new Error("ETIMEDOUT"),s.code="ETIMEDOUT";else if("string"==typeof n.response)try{s=JSON.parse(n.response)}catch(t){}s.status=n.status,e(s)}u()}},t.body&&t.body instanceof Blob?Zt(t.body,function(t){n.send(t)}):n.send(t.body),a}function nn(){try{return new XMLHttpRequest,!0}catch(t){return!1}}function on(t,e){return cr||t.xhr?en(t,e):tn(t,e)}function rn(){return""}function sn(t,e){function n(e,n,i){if(!t.binary&&t.json&&"string"==typeof e)try{e=JSON.parse(e)}catch(t){return i(t)}Array.isArray(e)&&(e=e.map(function(t){return t.error||t.missing?O(t):t})),t.binary&&lr(e,n),i(null,e,n)}t=u(t);var i={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return t=k(i,t),t.json&&(t.binary||(t.headers.Accept="application/json"),t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),t.binary&&(t.encoding=null,t.json=!1),t.processData||(t.json=!1),on(t,function(i,o,r){if(i)return e(O(i));var s,a=o.headers&&o.headers["content-type"],u=r||rn();if(!t.binary&&(t.json||!t.processData)&&"object"!=typeof u&&(/json/.test(a)||/^[\s]*\{/.test(u)&&/\}[\s]*$/.test(u)))try{u=JSON.parse(u.toString())}catch(t){}o.statusCode>=200&&o.statusCode<300?n(u,o,e):(s=O(u),s.status=o.statusCode,e(s))})}function an(t,e){var n=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",i=n.indexOf("safari")!==-1&&n.indexOf("chrome")===-1,o=n.indexOf("msie")!==-1,r=n.indexOf("edge")!==-1,s=i||(o||r)&&"GET"===t.method,a=!("cache"in t)||t.cache,u=/^blob:/.test(t.url);if(!u&&(s||!a)){var c=t.url.indexOf("?")!==-1;t.url+=(c?"&":"?")+"_nonce="+Date.now()}return sn(t,e)}function un(t,e){return new Vi(function(n,i){function o(){l++,t[h++]().then(s,a)}function r(){++d===f?c?i(c):n():u()}function s(){l--,r()}function a(t){l--,c=c||t,r()}function u(){for(;l<e&&h<f;)o()}var c,l=0,h=0,d=0,f=t.length;u()})}function cn(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];n.data=jt(n.data,n.content_type)})}function ln(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function hn(t){return t._attachments&&Object.keys(t._attachments)?Vi.all(Object.keys(t._attachments).map(function(e){var n=t._attachments[e];if(n.data&&"string"!=typeof n.data)return new Vi(function(t){qt(n.data,t)}).then(function(t){n.data=t})})):Vi.resolve()}function dn(t){if(!t.prefix)return!1;var e=N(t.prefix).protocol;return"http"===e||"https"===e}function fn(t,e){if(dn(e)){var n=e.name.substr(e.prefix.length);t=e.prefix+encodeURIComponent(n)}var i=N(t);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var o=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=o.pop(),i.db.indexOf("%")===-1&&(i.db=encodeURIComponent(i.db)),i.path=o.join("/"),i}function pn(t,e){return mn(t,t.db+"/"+e)}function mn(t,e){var n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function _n(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function vn(t,e){function n(t,e,n){var i=t.ajax||{},o=k(u(f),i,e);return pr(o.method+" "+o.url),a._ajax(o,n)}function i(t,e){return new Vi(function(i,o){n(t,e,function(t,e){return t?o(t):void i(e)})})}function o(t,e){return h(t,Ni(function(t){r().then(function(){return e.apply(this,t)}).catch(function(e){var n=t.pop();n(e)})}))}function r(){if(t.skipSetup||t.skip_setup)return Vi.resolve();if(v)return v;var e={method:"GET",url:l};return v=i({},e).catch(function(t){return t&&t.status&&404===t.status?(T(404,"PouchDB is just detecting if the remote exists."),i({},{method:"PUT",url:l})):Vi.reject(t)}).catch(function(t){return!(!t||!t.status||412!==t.status)||Vi.reject(t)}),v.catch(function(){v=null}),v}function s(t){return t.split("/").map(encodeURIComponent).join("/")}var a=this,c=fn(t.name,t),l=pn(c,"");t=u(t);
var f=t.ajax||{};if(t.auth||c.auth){var p=t.auth||c.auth,m=p.username+":"+p.password,_=Do(unescape(encodeURIComponent(m)));f.headers=f.headers||{},f.headers.Authorization="Basic "+_}a._ajax=an;var v;Fi(function(){e(null,a)}),a.type=function(){return"http"},a.id=o("id",function(t){n({},{method:"GET",url:mn(c,"")},function(e,n){var i=n&&n.uuid?n.uuid+c.db:pn(c,"");t(null,i)})}),a.request=o("request",function(t,e){t.url=pn(c,t.url),n({},t,e)}),a.compact=o("compact",function(t,e){"function"==typeof t&&(e=t,t={}),t=u(t),n(t,{url:pn(c,"_compact"),method:"POST"},function(){function n(){a.info(function(i,o){o&&!o.compact_running?e(null,{ok:!0}):setTimeout(n,t.interval||200)})}n()})}),a.bulkGet=h("bulkGet",function(t,e){function i(e){var i={};t.revs&&(i.revs=!0),t.attachments&&(i.attachments=!0),t.latest&&(i.latest=!0),n(t,{url:pn(c,"_bulk_get"+_n(i)),method:"POST",body:{docs:t.docs}},e)}function o(){function n(t){return function(n,i){a[t]=i.results,++s===o&&e(null,{results:B(a)})}}for(var i=dr,o=Math.ceil(t.docs.length/i),s=0,a=new Array(o),u=0;u<o;u++){var c=d(t,["revs","attachments","latest"]);c.ajax=f,c.docs=t.docs.slice(u*i,Math.min(t.docs.length,(u+1)*i)),y(r,c,n(u))}}var r=this,s=mn(c,""),a=fr[s];"boolean"!=typeof a?i(function(t,n){if(t){var i=Math.floor(t.status/100);4===i||5===i?(fr[s]=!1,T(t.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):e(t)}else fr[s]=!0,e(null,n)}):a?i(e):o()}),a._info=function(t){r().then(function(){n({},{method:"GET",url:pn(c,"")},function(e,n){return e?t(e):(n.host=pn(c,""),void t(null,n))})}).catch(t)},a.get=o("get",function(t,e,n){function o(t){function n(n){var r=o[n],a=ln(t._id)+"/"+s(n)+"?rev="+t._rev;return i(e,{method:"GET",url:pn(c,a),binary:!0}).then(function(t){return e.binary?t:new Vi(function(e){qt(t,e)})}).then(function(t){delete r.stub,delete r.length,r.data=t})}var o=t._attachments,r=o&&Object.keys(o);if(o&&r.length){var a=r.map(function(t){return function(){return n(t)}});return un(a,5)}}function r(t){return Array.isArray(t)?Vi.all(t.map(function(t){if(t.ok)return o(t.ok)})):o(t)}"function"==typeof e&&(n=e,e={}),e=u(e);var a={};e.revs&&(a.revs=!0),e.revs_info&&(a.revs_info=!0),e.latest&&(a.latest=!0),e.open_revs&&("all"!==e.open_revs&&(e.open_revs=JSON.stringify(e.open_revs)),a.open_revs=e.open_revs),e.rev&&(a.rev=e.rev),e.conflicts&&(a.conflicts=e.conflicts),t=ln(t);var l={method:"GET",url:pn(c,t+_n(a))};i(e,l).then(function(t){return Vi.resolve().then(function(){if(e.attachments)return r(t)}).then(function(){n(null,t)})}).catch(n)}),a.remove=o("remove",function(t,e,i,o){var r;"string"==typeof e?(r={_id:t,_rev:e},"function"==typeof i&&(o=i,i={})):(r=t,"function"==typeof e?(o=e,i={}):(o=i,i=e));var s=r._rev||i.rev;n(i,{method:"DELETE",url:pn(c,ln(r._id))+"?rev="+s},o)}),a.getAttachment=o("getAttachment",function(t,e,i,o){"function"==typeof i&&(o=i,i={});var r=i.rev?"?rev="+i.rev:"",a=pn(c,ln(t))+"/"+s(e)+r;n(i,{method:"GET",url:a,binary:!0},o)}),a.removeAttachment=o("removeAttachment",function(t,e,i,o){var r=pn(c,ln(t)+"/"+s(e))+"?rev="+i;n({},{method:"DELETE",url:r},o)}),a.putAttachment=o("putAttachment",function(t,e,i,o,r,a){"function"==typeof r&&(a=r,r=o,o=i,i=null);var u=ln(t)+"/"+s(e),l=pn(c,u);if(i&&(l+="?rev="+i),"string"==typeof o){var h;try{h=Po(o)}catch(t){return a(D(co,"Attachment is not a valid base64 string"))}o=h?Ut(h,r):""}var d={headers:{"Content-Type":r},method:"PUT",url:l,processData:!1,body:o,timeout:f.timeout||6e4};n({},d,a)}),a._bulkDocs=function(t,e,i){t.new_edits=e.new_edits,r().then(function(){return Vi.all(t.docs.map(hn))}).then(function(){n(e,{method:"POST",url:pn(c,"_bulk_docs"),timeout:e.timeout,body:t},function(t,e){return t?i(t):(e.forEach(function(t){t.ok=!0}),void i(null,e))})}).catch(i)},a._put=function(t,e,i){r().then(function(){return hn(t)}).then(function(){n(e,{method:"PUT",url:pn(c,ln(t._id)),body:t},function(t,e){return t?i(t):void i(null,e)})}).catch(i)},a.allDocs=o("allDocs",function(t,e){"function"==typeof t&&(e=t,t={}),t=u(t);var n,o={},r="GET";t.conflicts&&(o.conflicts=!0),t.descending&&(o.descending=!0),t.include_docs&&(o.include_docs=!0),t.attachments&&(o.attachments=!0),t.key&&(o.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(o.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(o.endkey=JSON.stringify(t.endkey)),"undefined"!=typeof t.inclusive_end&&(o.inclusive_end=!!t.inclusive_end),"undefined"!=typeof t.limit&&(o.limit=t.limit),"undefined"!=typeof t.skip&&(o.skip=t.skip);var s=_n(o);"undefined"!=typeof t.keys&&(r="POST",n={keys:t.keys}),i(t,{method:r,url:pn(c,"_all_docs"+s),body:n}).then(function(n){t.include_docs&&t.attachments&&t.binary&&n.rows.forEach(cn),e(null,n)}).catch(e)}),a._changes=function(t){var e="batch_size"in t?t.batch_size:hr;t=u(t),t.timeout="timeout"in t?t.timeout:"timeout"in f?f.timeout:3e4;var i,o=t.timeout?{timeout:t.timeout-5e3}:{},s="undefined"!=typeof t.limit&&t.limit;i="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var a=s;if(t.style&&(o.style=t.style),(t.include_docs||t.filter&&"function"==typeof t.filter)&&(o.include_docs=!0),t.attachments&&(o.attachments=!0),t.continuous&&(o.feed="longpoll"),t.conflicts&&(o.conflicts=!0),t.descending&&(o.descending=!0),"heartbeat"in t?t.heartbeat&&(o.heartbeat=t.heartbeat):o.heartbeat=1e4,t.filter&&"string"==typeof t.filter&&(o.filter=t.filter),t.view&&"string"==typeof t.view&&(o.filter="_view",o.view=t.view),t.query_params&&"object"==typeof t.query_params)for(var l in t.query_params)t.query_params.hasOwnProperty(l)&&(o[l]=t.query_params[l]);var h,d="GET";t.doc_ids&&(o.filter="_doc_ids",d="POST",h={doc_ids:t.doc_ids});var p,m,_=function(i,u){if(!t.aborted){o.since=i,"object"==typeof o.since&&(o.since=JSON.stringify(o.since)),t.descending?s&&(o.limit=a):o.limit=!s||a>e?e:a;var l={method:d,url:pn(c,"_changes"+_n(o)),timeout:t.timeout,body:h};m=i,t.aborted||r().then(function(){p=n(t,l,u)}).catch(u)}},v={results:[]},g=function(n,o){if(!t.aborted){var r=0;if(o&&o.results){r=o.results.length,v.last_seq=o.last_seq;var u={};u.query=t.query_params,o.results=o.results.filter(function(e){a--;var n=A(t)(e);return n&&(t.include_docs&&t.attachments&&t.binary&&cn(e),i&&v.results.push(e),t.onChange(e)),n})}else if(n)return t.aborted=!0,void t.complete(n);o&&o.last_seq&&(m=o.last_seq);var c=s&&a<=0||o&&r<e||t.descending;(!t.continuous||s&&a<=0)&&c?t.complete(null,v):Fi(function(){_(m,g)})}};return _(t.since||0,g),{cancel:function(){t.aborted=!0,p&&p.abort()}}},a.revsDiff=o("revsDiff",function(t,e,i){"function"==typeof e&&(i=e,e={}),n(e,{method:"POST",url:pn(c,"_revs_diff"),body:t},i)}),a._close=function(t){t()},a._destroy=function(t,e){n(t,{url:pn(c,""),method:"DELETE"},function(t,n){return t&&t.status&&404!==t.status?e(t):void e(null,n)})}}function gn(t){t.adapter("http",vn,!1),t.adapter("https",vn,!1)}function yn(t,e,n){for(var i="",o=n-t.length;i.length<o;)i+=e;return i}function bn(t,e,n){var i=yn(t,e,n);return i+t}function wn(t,e){if(t===e)return 0;t=Ln(t),e=Ln(e);var n=On(t),i=On(e);if(n-i!==0)return n-i;if(null===t)return 0;switch(typeof t){case"number":return t-e;case"boolean":return t===e?0:t<e?-1:1;case"string":return Pn(t,e)}return Array.isArray(t)?kn(t,e):Dn(t,e)}function Ln(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-(1/0)||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var i=0;i<n;i++)t[i]=Ln(e[i])}else{if(t instanceof Date)return t.toJSON();if(null!==t){t={};for(var o in e)if(e.hasOwnProperty(o)){var r=e[o];"undefined"!=typeof r&&(t[o]=Ln(r))}}}}return t}function xn(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return Mn(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),i=-1,o=n.length,r="";if(e)for(;++i<o;)r+=En(n[i]);else for(;++i<o;){var s=n[i];r+=En(s)+En(t[s])}return r}return""}function En(t){var e="\0";return t=Ln(t),On(t)+vr+xn(t)+e}function Cn(t,e){var n,i=e,o="1"===t[e];if(o)n=0,e++;else{var r="0"===t[e];e++;var s="",a=t.substring(e,e+_r),u=parseInt(a,10)+mr;for(r&&(u=-u),e+=_r;;){var c=t[e];if("\0"===c)break;s+=c,e++}s=s.split("."),n=1===s.length?parseInt(s,10):parseFloat(s[0]+"."+s[1]),r&&(n-=10),0!==u&&(n=parseFloat(n+"e"+u))}return{num:n,length:e-i}}function Sn(t,e){var n=t.pop();if(e.length){var i=e[e.length-1];n===i.element&&(e.pop(),i=e[e.length-1]);var o=i.element,r=i.index;if(Array.isArray(o))o.push(n);else if(r===t.length-2){var s=t.pop();o[s]=n}else t.push(n)}}function Tn(t){for(var e=[],n=[],i=0;;){var o=t[i++];if("\0"!==o)switch(o){case"1":e.push(null);break;case"2":e.push("1"===t[i]),i++;break;case"3":var r=Cn(t,i);e.push(r.num),i+=r.length;break;case"4":for(var s="";;){var a=t[i];if("\0"===a)break;s+=a,i++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var u={element:[],index:e.length};e.push(u.element),n.push(u);break;case"6":var c={element:{},index:e.length};e.push(c.element),n.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+o)}else{if(1===e.length)return e.pop();Sn(e,n)}}}function kn(t,e){for(var n=Math.min(t.length,e.length),i=0;i<n;i++){var o=wn(t[i],e[i]);if(0!==o)return o}return t.length===e.length?0:t.length>e.length?1:-1}function Pn(t,e){return t===e?0:t>e?1:-1}function Dn(t,e){for(var n=Object.keys(t),i=Object.keys(e),o=Math.min(n.length,i.length),r=0;r<o;r++){var s=wn(n[r],i[r]);if(0!==s)return s;if(s=wn(t[n[r]],e[i[r]]),0!==s)return s}return n.length===i.length?0:n.length>i.length?1:-1}function On(t){var e=["boolean","number","string","object"],n=e.indexOf(typeof t);return~n?null===t?1:Array.isArray(t)?5:n<3?n+2:n+3:Array.isArray(t)?5:void 0}function Mn(t){if(0===t)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),i=t<0,o=i?"0":"2",r=(i?-n:n)-mr,s=bn(r.toString(),"0",_r);o+=vr+s;var a=Math.abs(parseFloat(e[0]));i&&(a=10-a);var u=a.toFixed(20);return u=u.replace(/\.?0+$/,""),o+=vr+u}function An(){this.promise=new Vi(function(t){t()})}function Bn(t){var e,n=t.db,i=t.viewName,o=t.map,r=t.reduce,s=t.temporary,a=o.toString()+(r&&r.toString())+"undefined";if(!s&&(e=n._cachedViews=n._cachedViews||{},e[a]))return e[a];var u=n.info().then(function(t){function u(t){t.views=t.views||{};var e=i;e.indexOf("/")===-1&&(e=i+"/"+i);var n=t.views[e]=t.views[e]||{};if(!n[c])return n[c]=!0,t}var c=t.db_name+"-mrview-"+(s?"temp":Kt(a));return R(n,"_local/mrviews",u).then(function(){return n.registerDependentDatabase(c).then(function(t){var i=t.db;i.auto_compaction=!0;var s={name:c,db:i,sourceDB:n,adapter:n.adapter,mapFun:o,reduceFun:r};return s.db.get("_local/lastSeq").catch(function(t){if(404!==t.status)throw t}).then(function(t){return s.seq=t?t.seq:0,e&&s.db.once("destroyed",function(){delete e[a]}),s})})})});return e&&(e[a]=u),u}function In(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,In)}catch(t){}}function Un(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Un)}catch(t){}}function jn(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,jn)}catch(t){}}function zn(t){var e="builtin "+t+" function requires map values to be numbers or number arrays";return new jn(e)}function Nn(t){for(var e=0,n=0,i=t.length;n<i;n++){var o=t[n];if("number"!=typeof o){if(!Array.isArray(o))throw zn("_sum");e="number"==typeof e?[e]:e;for(var r=0,s=o.length;r<s;r++){var a=o[r];if("number"!=typeof a)throw zn("_sum");"undefined"==typeof e[r]?e.push(a):e[r]+=a}}else"number"==typeof e?e+=o:e[0]+=o}return e}function Rn(t,e){return Gi("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:Nn,log:gr,isArray:yr,toJSON:br})}function qn(t){return t.indexOf("/")===-1?[t,t]:t.split("/")}function Zn(t){return 1===t.length&&/^1-/.test(t[0].rev)}function Fn(t,e){try{t.emit("error",e)}catch(t){E("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),E("error",e)}}function Gn(t,e,n){try{return{output:e.apply(null,n)}}catch(e){return Fn(t,e),{error:e}}}function Wn(t,e){var n=wn(t.key,e.key);return 0!==n?n:wn(t.value,e.value)}function Hn(t,e,n){return n=n||0,"number"==typeof e?t.slice(n,e+n):n>0?t.slice(n):t}function Vn(t){var e=t.value,n=e&&"object"==typeof e&&e._id||t.id;return n}function Kn(t){t.rows.forEach(function(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];e[t].data=jt(n.data,n.content_type)})})}function $n(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&Kn(e),e}}function Jn(t,e,n,i){var o=e[t];"undefined"!=typeof o&&(i&&(o=encodeURIComponent(JSON.stringify(o))),n.push(t+"="+o))}function Xn(t){if("undefined"!=typeof t){var e=Number(t);return isNaN(e)||e!==parseInt(t,10)?t:e}}function Yn(t){return t.group_level=Xn(t.group_level),t.limit=Xn(t.limit),t.skip=Xn(t.skip),t}function Qn(t){if(t){if("number"!=typeof t)return new In('Invalid value for integer: "'+t+'"');if(t<0)return new In('Invalid value for positive integer: "'+t+'"')}}function ti(t,e){var n=t.descending?"endkey":"startkey",i=t.descending?"startkey":"endkey";if("undefined"!=typeof t[n]&&"undefined"!=typeof t[i]&&wn(t[n],t[i])>0)throw new In("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&t.reduce!==!1){if(t.include_docs)throw new In("{include_docs:true} is invalid for reduce");if(t.keys&&t.keys.length>1&&!t.group&&!t.group_level)throw new In("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){var n=Qn(t[e]);if(n)throw n})}function ei(t,e,n){var i,o=[],r="GET";if(Jn("reduce",n,o),Jn("include_docs",n,o),Jn("attachments",n,o),Jn("limit",n,o),Jn("descending",n,o),Jn("group",n,o),Jn("group_level",n,o),Jn("skip",n,o),Jn("stale",n,o),Jn("conflicts",n,o),Jn("startkey",n,o,!0),Jn("start_key",n,o,!0),Jn("endkey",n,o,!0),Jn("end_key",n,o,!0),Jn("inclusive_end",n,o),Jn("key",n,o,!0),o=o.join("&"),o=""===o?"":"?"+o,"undefined"!=typeof n.keys){var s=2e3,a="keys="+encodeURIComponent(JSON.stringify(n.keys));a.length+o.length+1<=s?o+=("?"===o[0]?"&":"?")+a:(r="POST","string"==typeof e?i={keys:n.keys}:e.keys=n.keys)}if("string"==typeof e){var u=qn(e);return t.request({method:r,url:"_design/"+u[0]+"/_view/"+u[1]+o,body:i}).then($n(n))}return i=i||{},Object.keys(e).forEach(function(t){Array.isArray(e[t])?i[t]=e[t]:i[t]=e[t].toString()}),t.request({method:"POST",url:"_temp_view"+o,body:i}).then($n(n))}function ni(t,e,n){return new Vi(function(i,o){t._query(e,n,function(t,e){return t?o(t):void i(e)})})}function ii(t){return new Vi(function(e,n){t._viewCleanup(function(t,i){return t?n(t):void e(i)})})}function oi(t){return function(e){if(404===e.status)return t;throw e}}function ri(t,e,n){function i(){return Zn(l)?Vi.resolve(a):e.db.get(s).catch(oi(a))}function o(t){return t.keys.length?e.db.allDocs({keys:t.keys,include_docs:!0}):Vi.resolve({rows:[]})}function r(t,e){for(var n=[],i={},o=0,r=e.rows.length;o<r;o++){var s=e.rows[o],a=s.doc;if(a&&(n.push(a),i[a._id]=!0,a._deleted=!c[a._id],!a._deleted)){var u=c[a._id];"value"in u&&(a.value=u.value)}}var l=Object.keys(c);return l.forEach(function(t){if(!i[t]){var e={_id:t},o=c[t];"value"in o&&(e.value=o.value),n.push(e)}}),t.keys=Cr(l.concat(t.keys)),n.push(t),n}var s="_local/doc_"+t,a={_id:s,keys:[]},u=n[t],c=u.indexableKeysToKeyValues,l=u.changes;return i().then(function(t){return o(t).then(function(e){return r(t,e)})})}function si(t,e,n){var i="_local/lastSeq";return t.db.get(i).catch(oi({_id:i,seq:0})).then(function(i){var o=Object.keys(e);return Vi.all(o.map(function(n){return ri(n,t,e)})).then(function(e){var o=B(e);return i.seq=n,o.push(i),t.db.bulkDocs({docs:o})})})}function ai(t){var e="string"==typeof t?t:t.name,n=Sr[e];return n||(n=Sr[e]=new An),n}function ui(t){return Er(ai(t),function(){return ci(t)})()}function ci(t){function e(t,e){var n={id:o._id,key:Ln(t)};"undefined"!=typeof e&&null!==e&&(n.value=Ln(e)),i.push(n)}function n(e,n){return function(){return si(t,e,n)}}var i,o,r;if("function"==typeof t.mapFun&&2===t.mapFun.length){var s=t.mapFun;r=function(t){return s(t,e)}}else r=Rn(t.mapFun.toString(),e);var a=t.seq||0,u=new An;return new Vi(function(e,s){function c(){u.finish().then(function(){t.seq=a,e()})}function l(){function e(t){s(t)}t.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:a,limit:kr}).on("complete",function(e){var s=e.results;if(!s.length)return c();for(var h={},d=0,f=s.length;d<f;d++){var p=s[d];if("_"!==p.doc._id[0]){i=[],o=p.doc,o._deleted||Gn(t.sourceDB,r,[o]),i.sort(Wn);for(var m,_={},v=0,g=i.length;v<g;v++){var y=i[v],b=[y.key,y.id];0===wn(y.key,m)&&b.push(v);var w=En(b);_[w]=y,m=y.key}h[p.doc._id]={indexableKeysToKeyValues:_,changes:p.changes}}a=p.seq}return u.add(n(h,a)),s.length<kr?c():l()}).on("error",e)}l()})}function li(t,e,n){0===n.group_level&&delete n.group_level;var i,o=n.group||n.group_level;i=Pr[t.reduceFun]?Pr[t.reduceFun]:Rn(t.reduceFun.toString());var r=[],s=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;e.forEach(function(t){var e=r[r.length-1],n=o?t.key:null;return o&&Array.isArray(n)&&(n=n.slice(0,s)),e&&0===wn(e.groupKey,n)?(e.keys.push([t.key,t.id]),void e.values.push(t.value)):void r.push({keys:[[t.key,t.id]],values:[t.value],groupKey:n})}),e=[];for(var a=0,u=r.length;a<u;a++){var c=r[a],l=Gn(t.sourceDB,i,[c.keys,c.values,!1]);if(l.error&&l.error instanceof jn)throw l.error;e.push({value:l.error?null:l.output,key:c.groupKey})}return{rows:Hn(e,n.limit,n.skip)}}function hi(t,e){return Er(ai(t),function(){return di(t,e)})()}function di(t,e){function n(e){return e.include_docs=!0,t.db.allDocs(e).then(function(t){return o=t.total_rows,t.rows.map(function(t){if("value"in t.doc&&"object"==typeof t.doc.value&&null!==t.doc.value){var e=Object.keys(t.doc.value).sort(),n=["id","key","value"];if(!(e<n||e>n))return t.doc.value}var i=Tn(t.doc._id);return{key:i[0],id:i[1],value:"value"in t.doc?t.doc.value:null}})})}function i(n){var i;if(i=r?li(t,n,e):{total_rows:o,offset:s,rows:n},e.include_docs){var a=Cr(n.map(Vn));return t.sourceDB.allDocs({keys:a,include_docs:!0,conflicts:e.conflicts,attachments:e.attachments,binary:e.binary}).then(function(t){var e={};return t.rows.forEach(function(t){t.doc&&(e["$"+t.id]=t.doc)}),n.forEach(function(t){var n=Vn(t),i=e["$"+n];i&&(t.doc=i)}),i})}return i}var o,r=t.reduceFun&&e.reduce!==!1,s=e.skip||0;if("undefined"==typeof e.keys||e.keys.length||(e.limit=0,delete e.keys),"undefined"!=typeof e.keys){var a=e.keys,u=a.map(function(t){var e={startkey:En([t]),endkey:En([t,{}])};return n(e)});return Vi.all(u).then(B).then(i)}var c={descending:e.descending};if(e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"undefined"!=typeof e.startkey&&(c.startkey=En(e.descending?[e.startkey,{}]:[e.startkey])),"undefined"!=typeof e.endkey){var l=e.inclusive_end!==!1;e.descending&&(l=!l),c.endkey=En(l?[e.endkey,{}]:[e.endkey])}if("undefined"!=typeof e.key){var h=En([e.key]),d=En([e.key,{}]);c.descending?(c.endkey=h,c.startkey=d):(c.startkey=h,c.endkey=d)}return r||("number"==typeof e.limit&&(c.limit=e.limit),c.skip=s),n(c).then(i)}function fi(t){return t.request({method:"POST",url:"_view_cleanup"})}function pi(t){return t.get("_local/mrviews").then(function(e){var n={};Object.keys(e.views).forEach(function(t){var e=qn(t),i="_design/"+e[0],o=e[1];n[i]=n[i]||{},n[i][o]=!0});var i={keys:Object.keys(n),include_docs:!0};return t.allDocs(i).then(function(i){var o={};i.rows.forEach(function(t){var i=t.key.substring(8);Object.keys(n[t.key]).forEach(function(n){var r=i+"/"+n;e.views[r]||(r=n);var s=Object.keys(e.views[r]),a=t.doc&&t.doc.views&&t.doc.views[n];s.forEach(function(t){o[t]=o[t]||a})})});var r=Object.keys(o).filter(function(t){return!o[t]}),s=r.map(function(e){return Er(ai(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return Vi.all(s).then(function(){return{ok:!0}})})},oi({ok:!0}))}function mi(t,e,n){if("http"===t.type())return ei(t,e,n);if("function"==typeof t._query)return ni(t,e,n);if("string"!=typeof e){ti(n,e);var i={db:t,viewName:"temp_view/temp_view",map:e.map,reduce:e.reduce,temporary:!0};return Tr.add(function(){return Bn(i).then(function(t){function e(){return t.db.destroy()}return xr(ui(t).then(function(){return hi(t,n)}),e)})}),Tr.finish()}var o=e,r=qn(o),s=r[0],a=r[1];return t.get("_design/"+s).then(function(e){var i=e.views&&e.views[a];if(!i||"string"!=typeof i.map)throw new Un("ddoc "+s+" has no view named "+a);ti(n,i);var r={db:t,viewName:o,map:i.map,reduce:i.reduce};return Bn(r).then(function(t){return"ok"===n.stale||"update_after"===n.stale?("update_after"===n.stale&&Fi(function(){ui(t)}),hi(t,n)):ui(t).then(function(){return hi(t,n)})})})}function _i(t){return/^1-/.test(t)}function vi(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}function gi(t,e){var n=Object.keys(e._attachments);return Vi.all(n.map(function(n){return t.getAttachment(e._id,n,{rev:e._rev})}))}function yi(t,e,n){var i="http"===e.type()&&"http"!==t.type(),o=Object.keys(n._attachments);return i?t.get(n._id).then(function(i){return Vi.all(o.map(function(o){return vi(i,n,o)?e.getAttachment(n._id,o):t.getAttachment(i._id,o)}))}).catch(function(t){if(404!==t.status)throw t;return gi(e,n)}):gi(e,n)}function bi(t){var e=[];return Object.keys(t).forEach(function(n){var i=t[n].missing;i.forEach(function(t){e.push({id:n,rev:t})})}),{docs:e,revs:!0,latest:!0}}function wi(t,e,n,i){function o(){var o=bi(n);if(o.docs.length)return t.bulkGet(o).then(function(n){if(i.cancelled)throw new Error("cancelled");return Vi.all(n.results.map(function(n){return Vi.all(n.docs.map(function(n){var i=n.ok;return n.error&&(d=!1),i&&i._attachments?yi(e,t,i).then(function(t){var e=Object.keys(i._attachments);return t.forEach(function(t,n){var o=i._attachments[e[n]];delete o.stub,delete o.length,o.data=t}),i}):i}))})).then(function(t){h=h.concat(B(t).filter(Boolean))})})}function r(t){return t._attachments&&Object.keys(t._attachments).length>0}function s(t){return t._conflicts&&t._conflicts.length>0}function a(e){return t.allDocs({keys:e,include_docs:!0,conflicts:!0}).then(function(t){if(i.cancelled)throw new Error("cancelled");t.rows.forEach(function(t){t.deleted||!t.doc||!_i(t.value.rev)||r(t.doc)||s(t.doc)||(t.doc._conflicts&&delete t.doc._conflicts,h.push(t.doc),delete n[t.id])})})}function c(){var t=Object.keys(n).filter(function(t){var e=n[t].missing;return 1===e.length&&_i(e[0])});if(t.length>0)return a(t)}function l(){return{ok:d,docs:h}}n=u(n);var h=[],d=!0;return Vi.resolve().then(c).then(o).then(l)}function Li(t,e,n,i,o){return t.get(e).catch(function(n){if(404===n.status)return"http"===t.type()&&T(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:i,_id:e,history:[],replicator:Br,version:Ar};throw n}).then(function(r){if(!o.cancelled&&r.last_seq!==n)return r.history=(r.history||[]).filter(function(t){return t.session_id!==i}),r.history.unshift({last_seq:n,session_id:i}),r.history=r.history.slice(0,Ir),r.version=Ar,r.replicator=Br,r.session_id=i,r.last_seq=n,t.put(r).catch(function(r){if(409===r.status)return Li(t,e,n,i,o);throw r})})}function xi(t,e,n,i){this.src=t,this.target=e,this.id=n,this.returnValue=i}function Ei(t,e){return t.session_id===e.session_id?{last_seq:t.last_seq,history:t.history}:Ci(t.history,e.history)}function Ci(t,e){var n=t[0],i=t.slice(1),o=e[0],r=e.slice(1);if(!n||0===e.length)return{last_seq:Ur,history:[]};var s=n.session_id;if(Si(s,e))return{last_seq:n.last_seq,history:t};var a=o.session_id;return Si(a,i)?{last_seq:o.last_seq,history:r}:Ci(i,r)}function Si(t,e){var n=e[0],i=e.slice(1);return!(!t||0===e.length)&&(t===n.session_id||Si(t,i))}function Ti(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}function ki(t,e,n,i){if(t.retry===!1)return e.emit("error",n),void e.removeAllListeners();if("function"!=typeof t.back_off_function&&(t.back_off_function=S),e.emit("requestError",n),"active"===e.state||"pending"===e.state){e.emit("paused",n),e.state="stopped";var o=function(){t.current_back_off=zr},r=function(){e.removeListener("active",o)};e.once("paused",r),e.once("active",o)}t.current_back_off=t.current_back_off||zr,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(i,t.current_back_off)}function Pi(t){return Object.keys(t).sort(wn).reduce(function(e,n){return e[n]=t[n],e},{})}function Di(t,e,n){var i=n.doc_ids?n.doc_ids.sort(wn):"",o=n.filter?n.filter.toString():"",r="",s="";return n.filter&&n.query_params&&(r=JSON.stringify(Pi(n.query_params))),n.filter&&"_view"===n.filter&&(s=n.view.toString()),Vi.all([t.id(),e.id()]).then(function(t){var e=t[0]+t[1]+o+s+r+i;return new Vi(function(t){Vt(e,t)})}).then(function(t){return t=t.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+t})}function Oi(t,e,n,i,o){function r(){return x?Vi.resolve():Di(t,e,n).then(function(n){L=n,x=new xi(t,e,L,i)})}function s(){if(U=[],0!==w.docs.length){var t=w.docs,r={timeout:n.timeout};return e.bulkDocs({docs:t,new_edits:!1},r).then(function(e){if(i.cancelled)throw p(),new Error("cancelled");var n=Object.create(null);e.forEach(function(t){t.error&&(n[t.id]=t)});var r=Object.keys(n).length;o.doc_write_failures+=r,o.docs_written+=t.length-r,t.forEach(function(t){var e=n[t._id];if(e){if(o.errors.push(e),"unauthorized"!==e.name&&"forbidden"!==e.name)throw e;i.emit("denied",u(e))}else U.push(t)})},function(e){throw o.doc_write_failures+=t.length,e})}}function a(){if(w.error)throw new Error("There was a problem getting docs.");o.last_seq=P=w.seq;var t=u(o);return U.length&&(t.docs=U,i.emit("change",t)),S=!0,x.writeCheckpoint(w.seq,j).then(function(){if(S=!1,i.cancelled)throw p(),new Error("cancelled");w=void 0,g()}).catch(function(t){throw b(t),t})}function c(){var t={};return w.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(t){return t.rev}))}),e.revsDiff(t).then(function(t){if(i.cancelled)throw p(),new Error("cancelled");w.diffs=t})}function l(){return wi(t,e,w.diffs,i).then(function(t){w.error=!t.ok,t.docs.forEach(function(t){delete w.diffs[t._id],o.docs_read++,w.docs.push(t)})})}function h(){if(!i.cancelled&&!w){if(0===E.length)return void d(!0);w=E.shift(),c().then(l).then(s).then(a).then(h).catch(function(t){f("batch processing terminated with error",t)})}}function d(t){return 0===C.changes.length?void(0!==E.length||w||((D&&z.live||T)&&(i.state="pending",i.emit("paused")),T&&p())):void((t||T||C.changes.length>=O)&&(E.push(C),C={seq:0,changes:[],docs:[]},"pending"!==i.state&&"stopped"!==i.state||(i.state="active",i.emit("active")),h()))}function f(t,e){k||(e.message||(e.message=t),o.ok=!1,o.status="aborting",E=[],C={seq:0,changes:[],docs:[]},p(e))}function p(r){k||i.cancelled&&(o.status="cancelled",S)||(o.status=o.status||"complete",o.end_time=new Date,o.last_seq=P,k=!0,r?(r.result=o,"unauthorized"===r.name||"forbidden"===r.name?(i.emit("error",r),i.removeAllListeners()):ki(n,i,r,function(){Oi(t,e,n,i)})):(i.emit("complete",o),i.removeAllListeners()))}function m(t){if(i.cancelled)return p();var e=A(n)(t);e&&(C.seq=t.seq,C.changes.push(t),d(0===E.length&&z.live))}function _(t){if(B=!1,i.cancelled)return p();if(t.results.length>0)z.since=t.last_seq,g(),d(!0);else{var e=function(){D?(z.live=!0,g()):T=!0,d(!0)};w||0!==t.results.length?e():(S=!0,x.writeCheckpoint(t.last_seq,j).then(function(){S=!1,o.last_seq=P=t.last_seq,e()}).catch(b))}}function v(t){return B=!1,i.cancelled?p():void f("changes rejected",t)}function g(){function e(){r.cancel()}function o(){i.removeListener("cancel",e)}if(!B&&!T&&E.length<M){B=!0,i._changes&&(i.removeListener("cancel",i._abortChanges),i._changes.cancel()),i.once("cancel",e);var r=t.changes(z).on("change",m);r.then(o,o),r.then(_).catch(v),n.retry&&(i._changes=r,i._abortChanges=e)}}function y(){r().then(function(){return i.cancelled?void p():x.getCheckpoint().then(function(t){P=t,z={since:P,limit:O,batch_size:O,style:"all_docs",doc_ids:I,return_docs:!0},n.filter&&("string"!=typeof n.filter?z.include_docs=!0:z.filter=n.filter),"heartbeat"in n&&(z.heartbeat=n.heartbeat),"timeout"in n&&(z.timeout=n.timeout),n.query_params&&(z.query_params=n.query_params),n.view&&(z.view=n.view),g()})}).catch(function(t){f("getCheckpoint rejected with ",t)})}function b(t){S=!1,f("writeCheckpoint completed with error",t)}var w,L,x,E=[],C={seq:0,changes:[],docs:[]},S=!1,T=!1,k=!1,P=0,D=n.continuous||n.live||!1,O=n.batch_size||100,M=n.batches_limit||10,B=!1,I=n.doc_ids,U=[],j=F();o=o||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var z={};return i.ready(t,e),i.cancelled?void p():(i._addedListeners||(i.once("cancel",p),"function"==typeof n.complete&&(i.once("error",n.complete),i.once("complete",function(t){n.complete(null,t)})),i._addedListeners=!0),void("undefined"==typeof n.since?y():r().then(function(){return S=!0,x.writeCheckpoint(n.since,j)}).then(function(){return S=!1,i.cancelled?void p():(P=n.since,void y())}).catch(b)))}function Mi(){qi.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var t=this,e=new Vi(function(e,n){t.once("complete",e),t.once("error",n)});t.then=function(t,n){return e.then(t,n)},t.catch=function(t){return e.catch(t)},t.catch(function(){})}function Ai(t,e){var n=e.PouchConstructor;return"string"==typeof t?new n(t,e):t}function Bi(t,e,n,i){if("function"==typeof n&&(i=n,n={}),"undefined"==typeof n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw D(fo,"`doc_ids` filter parameter is not a list.");n.complete=i,n=u(n),n.continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var o=new Mi(n),r=Ai(t,n),s=Ai(e,n);return Oi(r,s,n,o),o}function Ii(t,e,n,i){return"function"==typeof n&&(i=n,n={}),"undefined"==typeof n&&(n={}),n=u(n),n.PouchConstructor=n.PouchConstructor||this,t=Ai(t,n),e=Ai(e,n),new Ui(t,e,n,i)}function Ui(t,e,n,i){function o(t){p.emit("change",{direction:"pull",change:t})}function r(t){p.emit("change",{direction:"push",change:t})}function s(t){p.emit("denied",{direction:"push",doc:t})}function a(t){p.emit("denied",{direction:"pull",doc:t})}function u(){p.pushPaused=!0,p.pullPaused&&p.emit("paused")}function c(){p.pullPaused=!0,p.pushPaused&&p.emit("paused")}function l(){p.pushPaused=!1,p.pullPaused&&p.emit("active",{direction:"push"})}function h(){p.pullPaused=!1,p.pushPaused&&p.emit("active",{direction:"pull"})}function d(t){return function(e,n){var i="change"===e&&(n===o||n===r),d="denied"===e&&(n===a||n===s),f="paused"===e&&(n===c||n===u),m="active"===e&&(n===h||n===l);(i||d||f||m)&&(e in v||(v[e]={}),v[e][t]=!0,2===Object.keys(v[e]).length&&p.removeAllListeners(e))}}function f(t,e,n){t.listeners(e).indexOf(n)==-1&&t.on(e,n)}var p=this;this.canceled=!1;var m=n.push?k({},n,n.push):n,_=n.pull?k({},n,n.pull):n;this.push=Bi(t,e,m),this.pull=Bi(e,t,_),this.pushPaused=!0,this.pullPaused=!0;var v={};n.live&&(this.push.on("complete",p.pull.cancel.bind(p.pull)),this.pull.on("complete",p.push.cancel.bind(p.push))),this.on("newListener",function(t){"change"===t?(f(p.pull,"change",o),f(p.push,"change",r)):"denied"===t?(f(p.pull,"denied",a),f(p.push,"denied",s)):"active"===t?(f(p.pull,"active",h),f(p.push,"active",l)):"paused"===t&&(f(p.pull,"paused",c),f(p.push,"paused",u))}),this.on("removeListener",function(t){"change"===t?(p.pull.removeListener("change",o),p.push.removeListener("change",r)):"denied"===t?(p.pull.removeListener("denied",a),p.push.removeListener("denied",s)):"active"===t?(p.pull.removeListener("active",h),p.push.removeListener("active",l)):"paused"===t&&(p.pull.removeListener("paused",c),p.push.removeListener("paused",u))}),this.pull.on("removeListener",d("pull")),
this.push.on("removeListener",d("push"));var g=Vi.all([this.push,this.pull]).then(function(t){var e={push:t[0],pull:t[1]};return p.emit("complete",e),i&&i(null,e),p.removeAllListeners(),e},function(t){if(p.cancel(),i?i(t):p.emit("error",t),p.removeAllListeners(),i)throw t});this.then=function(t,e){return g.then(t,e)},this.catch=function(t){return g.catch(t)}}function ji(t){t.replicate=Bi,t.sync=Ii,Object.defineProperty(t.prototype,"replicate",{get:function(){var t=this;return{from:function(e,n,i){return t.constructor.replicate(e,t,n,i)},to:function(e,n,i){return t.constructor.replicate(t,e,n,i)}}}}),t.prototype.sync=function(t,e,n){return this.constructor.sync(this,t,e,n)}}var zi=i(n(36)),Ni=i(n(19)),Ri=i(n(20)),qi=n(22),Zi=i(n(26)),Fi=i(n(11)),Gi=i(n(45)),Wi=i(n(47)),Hi=i(n(57)),Vi="function"==typeof Promise?Promise:zi,Ki=Function.prototype.toString,$i=Ki.call(Object),Ji=Ri("pouchdb:api");m.prototype.get=function(t){var e=f(t);return this._store[e]},m.prototype.set=function(t,e){var n=f(t);return this._store[n]=e,!0},m.prototype.has=function(t){var e=f(t);return e in this._store},m.prototype.delete=function(t){var e=f(t),n=e in this._store;return delete this._store[e],n},m.prototype.forEach=function(t){for(var e=Object.keys(this._store),n=0,i=e.length;n<i;n++){var o=e[n],r=this._store[o];o=p(o),t(r,o)}},Object.defineProperty(m.prototype,"size",{get:function(){return Object.keys(this._store).length}}),_.prototype.add=function(t){return this._store.set(t,!0)},_.prototype.has=function(t){return this._store.has(t)};var Xi,Yi=6;if(b())Xi=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),Xi=!!localStorage.getItem("_pouch_check_localstorage")}catch(t){Xi=!1}Zi(x,qi.EventEmitter),x.prototype.addListener=function(t,e,n,i){function o(){function t(){s=!1}if(r._listeners[e]){if(s)return void(s="waiting");s=!0;var a=d(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(a).on("change",function(t){t.seq>i.since&&!i.cancelled&&(i.since=t.seq,i.onChange(t))}).on("complete",function(){"waiting"===s&&Fi(o),s=!1}).on("error",t)}}if(!this._listeners[e]){var r=this,s=!1;this._listeners[e]=o,this.on(t,o)}},x.prototype.removeListener=function(t,e){e in this._listeners&&(qi.EventEmitter.prototype.removeListener.call(this,t,this._listeners[e]),delete this._listeners[e])},x.prototype.notifyLocalWindows=function(t){b()?chrome.storage.local.set({dbName:t}):w()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},x.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)};var Qi=Array.prototype.slice,to=Array.prototype.forEach;Zi(P,Error),P.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var eo=(new P(401,"unauthorized","Name or password is incorrect."),new P(400,"bad_request","Missing JSON list of 'docs'")),no=new P(404,"not_found","missing"),io=new P(409,"conflict","Document update conflict"),oo=new P(400,"bad_request","_id field must contain a string"),ro=new P(412,"missing_id","_id is required for puts"),so=new P(400,"bad_request","Only reserved document ids may start with underscore."),ao=new P(412,"precondition_failed","Database not open"),uo=new P(500,"unknown_error","Database encountered an unknown error"),co=new P(500,"badarg","Some query argument is invalid"),lo=(new P(400,"invalid_request","Request was invalid"),new P(400,"query_parse_error","Some query parameter is invalid")),ho=new P(500,"doc_validation","Bad special document member"),fo=new P(400,"bad_request","Something wrong with the request"),po=new P(400,"bad_request","Document must be a JSON object"),mo=(new P(404,"not_found","Database not found"),new P(500,"indexed_db_went_bad","unknown")),_o=new P(500,"web_sql_went_bad","unknown"),vo=(new P(500,"levelDB_went_went_bad","unknown"),new P(403,"forbidden","Forbidden by design doc validate_doc_update function"),new P(400,"bad_request","Invalid rev format")),go=(new P(412,"file_exists","The database could not be created, the file already exists."),new P(412,"missing_stub","A pre-existing attachment stub wasn't found")),yo=(new P(413,"invalid_url","Provided URL is invalid"),["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"]),bo="queryKey",wo=/(?:^|&)([^&=]*)=?([^&]*)/g,Lo=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,xo="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Zi(pt,qi.EventEmitter),pt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},pt.prototype.doChanges=function(t){var e=this,n=t.complete;if(t=u(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=mt,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"===t.since)return void this.db.info().then(function(i){return e.isCancelled?void n(null,{status:"cancelled"}):(t.since=i.update_seq,void e.doChanges(t))},n);if(t.view&&!t.filter&&(t.filter="_view"),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=z(t.view):t.filter=z(t.filter),"http"!==this.db.type()&&!t.doc_ids))return this.filterChanges(t);"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=n;var i=this.db._changes(t);if(i&&"function"==typeof i.cancel){var o=e.cancel;e.cancel=Ni(function(t){i.cancel(),o.apply(this,t)})}},pt.prototype.filterChanges=function(t){var e=this,n=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var i=D(fo,"`view` filter parameter not found or invalid.");return n(i)}var o=j(t.view);this.db.get("_design/"+o[0],function(i,r){if(e.isCancelled)return n(null,{status:"cancelled"});if(i)return n(O(i));var s=r&&r.views&&r.views[o[1]]&&r.views[o[1]].map;return s?(t.filter=dt(s),void e.doChanges(t)):n(D(no,r.views?"missing json key: "+o[1]:"missing json key: views"))})}else{var r=j(t.filter);if(!r)return e.doChanges(t);this.db.get("_design/"+r[0],function(i,o){if(e.isCancelled)return n(null,{status:"cancelled"});if(i)return n(O(i));var s=o&&o.filters&&o.filters[r[1]];return s?(t.filter=ht(s),void e.doChanges(t)):n(D(no,o&&o.filters?"missing json key: "+r[1]:"missing json key: filters"))})}},Zi(Et,qi.EventEmitter),Et.prototype.post=h("post",function(t,e,n){return"function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t)?n(D(po)):void this.bulkDocs({docs:[t]},e,vt(n))}),Et.prototype.put=h("put",function(t,e,n){return"function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t)?n(D(po)):(I(t._id),ct(t._id)&&"function"==typeof this._putLocal?t._deleted?this._removeLocal(t,n):this._putLocal(t,n):void("function"==typeof this._put&&e.new_edits!==!1?this._put(t,e,n):this.bulkDocs({docs:[t]},e,vt(n))))}),Et.prototype.putAttachment=h("putAttachment",function(t,e,n,i,o){function r(t){var n="_rev"in t?parseInt(t._rev,10):0;return t._attachments=t._attachments||{},t._attachments[e]={content_type:o,data:i,revpos:++n},s.put(t)}var s=this;return"function"==typeof o&&(o=i,i=n,n=null),"undefined"==typeof o&&(o=i,i=n,n=null),o||E("warn","Attachment",e,"on document",t,"is missing content_type"),s.get(t).then(function(t){if(t._rev!==n)throw D(io);return r(t)},function(e){if(e.reason===no.message)return r({_id:t});throw e})}),Et.prototype.removeAttachment=h("removeAttachment",function(t,e,n,i){var o=this;o.get(t,function(t,r){return t?void i(t):r._rev!==n?void i(D(io)):r._attachments?(delete r._attachments[e],0===Object.keys(r._attachments).length&&delete r._attachments,void o.put(r,i)):i()})}),Et.prototype.remove=h("remove",function(t,e,n,i){var o;"string"==typeof e?(o={_id:t,_rev:e},"function"==typeof n&&(i=n,n={})):(o=t,"function"==typeof e?(i=e,n={}):(i=n,n=e)),n=n||{},n.was_delete=!0;var r={_id:o._id,_rev:o._rev||n.rev};return r._deleted=!0,ct(r._id)&&"function"==typeof this._removeLocal?this._removeLocal(o,i):void this.bulkDocs({docs:[r]},n,vt(i))}),Et.prototype.revsDiff=h("revsDiff",function(t,e,n){function i(t,e){a.has(t)||a.set(t,{missing:[]}),a.get(t).missing.push(e)}function o(e,n){var o=t[e].slice(0);W(n,function(t,n,r,s,a){var u=n+"-"+r,c=o.indexOf(u);c!==-1&&(o.splice(c,1),"available"!==a.status&&i(e,u))}),o.forEach(function(t){i(e,t)})}"function"==typeof e&&(n=e,e={});var r=Object.keys(t);if(!r.length)return n(null,{});var s=0,a=new m;r.map(function(e){this._getRevisionTree(e,function(i,u){if(i&&404===i.status&&"missing"===i.message)a.set(e,{missing:t[e]});else{if(i)return n(i);o(e,u)}if(++s===r.length){var c={};return a.forEach(function(t,e){c[e]=t}),n(null,c)}})},this)}),Et.prototype.bulkGet=h("bulkGet",function(t,e){y(this,t,e)}),Et.prototype.compactDocument=h("compactDocument",function(t,e,n){var i=this;this._getRevisionTree(t,function(o,r){if(o)return n(o);var s=bt(r),a=[],u=[];Object.keys(s).forEach(function(t){s[t]>e&&a.push(t)}),W(r,function(t,e,n,i,o){var r=e+"-"+n;"available"===o.status&&a.indexOf(r)!==-1&&u.push(r)}),i._doCompaction(t,u,n)})}),Et.prototype.compact=h("compact",function(t,e){"function"==typeof t&&(e=t,t={});var n=this;t=t||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:t,callback:e}),1===n._compactionQueue.length&&Lt(n)}),Et.prototype._compact=function(t,e){function n(t){s.push(o.compactDocument(t.id,0))}function i(t){var n=t.last_seq;Vi.all(s).then(function(){return R(o,"_local/compaction",function(t){return(!t.last_seq||t.last_seq<n)&&(t.last_seq=n,t)})}).then(function(){e(null,{ok:!0})}).catch(e)}var o=this,r={return_docs:!1,last_seq:t.last_seq||0},s=[];o.changes(r).on("change",n).on("complete",i).on("error",e)},Et.prototype.get=h("get",function(t,e,n){function i(){var i=[],s=o.length;return s?void o.forEach(function(o){r.get(t,{rev:o,revs:e.revs,latest:e.latest,attachments:e.attachments},function(t,e){if(t)i.push({missing:o});else{for(var r,a=0,u=i.length;a<u;a++)if(i[a].ok&&i[a].ok._rev===e._rev){r=!0;break}r||i.push({ok:e})}s--,s||n(null,i)})}):n(null,i)}if("function"==typeof e&&(n=e,e={}),"string"!=typeof t)return n(D(oo));if(ct(t)&&"function"==typeof this._getLocal)return this._getLocal(t,n);var o=[],r=this;if(!e.open_revs)return this._get(t,e,function(t,i){if(t)return n(t);var o=i.doc,s=i.metadata,a=i.ctx;if(e.conflicts){var u=K(s);u.length&&(o._conflicts=u)}if(ut(s,o._rev)&&(o._deleted=!0),e.revs||e.revs_info){for(var c=o._rev.split("-"),l=parseInt(c[0],10),h=c[1],d=J(s.rev_tree),f=null,p=0;p<d.length;p++){var m=d[p],_=m.ids.map(function(t){return t.id}).indexOf(h),v=_===l-1;(v||!f&&_!==-1)&&(f=m)}var g=f.ids.map(function(t){return t.id}).indexOf(o._rev.split("-")[1])+1,y=f.ids.length-g;if(f.ids.splice(g,y),f.ids.reverse(),e.revs&&(o._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map(function(t){return t.id})}),e.revs_info){var b=f.pos+f.ids.length;o._revs_info=f.ids.map(function(t){return b--,{rev:b+"-"+t.id,status:t.opts.status}})}}if(e.attachments&&o._attachments){var w=o._attachments,L=Object.keys(w).length;if(0===L)return n(null,o);Object.keys(w).forEach(function(t){this._getAttachment(o._id,t,w[t],{rev:o._rev,binary:e.binary,ctx:a},function(e,i){var r=o._attachments[t];r.data=i,delete r.stub,delete r.length,--L||n(null,o)})},r)}else{if(o._attachments)for(var x in o._attachments)o._attachments.hasOwnProperty(x)&&(o._attachments[x].stub=!0);n(null,o)}});if("all"===e.open_revs)this._getRevisionTree(t,function(t,e){return t?n(t):(o=V(e).map(function(t){return t.rev}),void i())});else{if(!Array.isArray(e.open_revs))return n(D(uo,"function_clause"));o=e.open_revs;for(var s=0;s<o.length;s++){var a=o[s];if("string"!=typeof a||!/^\d+-/.test(a))return n(D(vo))}i()}}),Et.prototype.getAttachment=h("getAttachment",function(t,e,n,i){var o=this;n instanceof Function&&(i=n,n={}),this._get(t,n,function(r,s){return r?i(r):s.doc._attachments&&s.doc._attachments[e]?(n.ctx=s.ctx,n.binary=!0,o._getAttachment(t,e,s.doc._attachments[e],n,i),void 0):i(D(no))})}),Et.prototype.allDocs=h("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip="undefined"!=typeof t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(n)return void e(D(lo,"Query parameter `"+n+"` is not compatible with multi-get"));if("http"!==this.type())return wt(this,t,e)}return this._allDocs(t,e)}),Et.prototype.changes=function(t,e){return"function"==typeof t&&(e=t,t={}),new pt(this,t,e)},Et.prototype.close=h("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}),Et.prototype.info=h("info",function(t){var e=this;this._info(function(n,i){return n?t(n):(i.db_name=i.db_name||e.name,i.auto_compaction=!(!e.auto_compaction||"http"===e.type()),i.adapter=e.type(),void t(null,i))})}),Et.prototype.id=h("id",function(t){return this._id(t)}),Et.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Et.prototype.bulkDocs=h("bulkDocs",function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return n(D(eo));for(var i=0;i<t.docs.length;++i)if("object"!=typeof t.docs[i]||Array.isArray(t.docs[i]))return n(D(po));var o;return t.docs.forEach(function(t){t._attachments&&Object.keys(t._attachments).forEach(function(e){o=o||xt(e),t._attachments[e].content_type||E("warn","Attachment",e,"on document",t._id,"is missing content_type")})}),o?n(D(fo,o)):("new_edits"in e||("new_edits"in t?e.new_edits=t.new_edits:e.new_edits=!0),e.new_edits||"http"===this.type()||t.docs.sort(yt),gt(t.docs),this._bulkDocs(t,e,function(t,i){return t?n(t):(e.new_edits||(i=i.filter(function(t){return t.error})),void n(null,i))}))}),Et.prototype.registerDependentDatabase=h("registerDependentDatabase",function(t,e){function n(e){return e.dependentDbs=e.dependentDbs||{},!e.dependentDbs[t]&&(e.dependentDbs[t]=!0,e)}var i=new this.constructor(t,this.__opts);R(this,"_local/_pouch_dependentDbs",n).then(function(){e(null,{db:i})}).catch(e)}),Et.prototype.destroy=h("destroy",function(t,e){function n(){i._destroy(t,function(t,n){return t?e(t):(i._destroyed=!0,i.emit("destroyed"),void e(null,n||{ok:!0}))})}"function"==typeof t&&(e=t,t={});var i=this,o=!("use_prefix"in i)||i.use_prefix;return"http"===i.type()?n():void i.get("_local/_pouch_dependentDbs",function(t,r){if(t)return 404!==t.status?e(t):n();var s=r.dependentDbs,a=i.constructor,u=Object.keys(s).map(function(t){var e=o?t.replace(new RegExp("^"+a.prefix),""):t;return new a(e,i.__opts).destroy()});Vi.all(u).then(n,e)})}),Ct.prototype.execute=function(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()},Ct.prototype.fail=function(t){this.failed=t,this.execute()},Ct.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},Ct.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},Zi(kt,Et),kt.debug=Ri,kt.adapters={},kt.preferredAdapters=[],kt.prefix="_pouch_";var Eo=new qi.EventEmitter;Pt(kt),kt.adapter=function(t,e,n){e.valid()&&(kt.adapters[t]=e,n&&kt.preferredAdapters.push(t))},kt.plugin=function(t){if("function"==typeof t)t(kt);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){kt.prototype[e]=t[e]})}return kt},kt.defaults=function(t){function e(t,n){return this instanceof e?(n=n||{},t&&"object"==typeof t&&(n=t,t=n.name,delete n.name),n=k({},e.__defaults,n),void kt.call(this,t,n)):new e(t,n)}return Zi(e,kt),e.preferredAdapters=kt.preferredAdapters.slice(),Object.keys(kt).forEach(function(t){t in e||(e[t]=kt[t])}),e.__defaults=k({},this.__defaults,t),e};var Co="6.1.0";kt.version=Co;var So,To=Dt(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ko=Dt(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),Po=function(t){return atob(t)},Do=function(t){return btoa(t)},Oo=e.setImmediate||e.setTimeout,Mo=32768,Ao=5,Bo="document-store",Io="by-sequence",Uo="attach-store",jo="attach-seq-store",zo="meta-store",No="local-store",Ro="detect-blob-support",qo=!1,Zo=[],Fo=new m,Go=new x,Wo=new m;Le.valid=function(){var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!t&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var Ho=7,Vo=Oe("document-store"),Ko=Oe("by-sequence"),$o=Oe("attach-store"),Jo=Oe("local-store"),Xo=Oe("metadata-store"),Yo=Oe("attach-seq-store"),Qo=new m,tr=new x,er=1,nr="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+Ko+" (seq, deleted)",ir="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+Ko+" (doc_id, rev)",or="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Vo+" (winningseq)",rr="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+Yo+" (seq)",sr="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+Yo+" (digest, seq)",ar=Ko+".seq = "+Vo+".winningseq",ur=Ko+".seq AS seq, "+Ko+".deleted AS deleted, "+Ko+".json AS data, "+Ko+".rev AS rev, "+Vo+".json AS metadata";Xe.valid=$e,Xe.use_prefix=!0;var cr=nn(),lr=function(){},hr=25,dr=50,fr={},pr=Ri("pouchdb:http");vn.valid=function(){return!0};var mr=-324,_r=3,vr="";An.prototype.add=function(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise},An.prototype.finish=function(){return this.promise},Zi(In,Error),Zi(Un,Error),Zi(jn,Error);var gr=E.bind(null,"log"),yr=Array.isArray,br=JSON.parse,wr=function(t,e){return e&&t.then(function(t){Fi(function(){e(null,t)})},function(t){Fi(function(){e(t)})}),t},Lr=function(t){return Ni(function(e){var n=e.pop(),i=t.apply(this,e);return"function"==typeof n&&wr(i,n),i})},xr=function(t,e){return t.then(function(t){return e().then(function(){return t})},function(t){return e().then(function(){throw t})})},Er=function(t,e){return function(){var n=arguments,i=this;return t.add(function(){return e.apply(i,n)})}},Cr=function(t){for(var e={},n=0,i=t.length;n<i;n++)e["$"+t[n]]=!0;var o=Object.keys(e),r=new Array(o.length);for(n=0,i=o.length;n<i;n++)r[n]=o[n].substring(1);return r},Sr={},Tr=new An,kr=50,Pr={_sum:function(t,e){return Nn(e)},_count:function(t,e){return e.length},_stats:function(t,e){function n(t){for(var e=0,n=0,i=t.length;n<i;n++){var o=t[n];e+=o*o}return e}return{sum:Nn(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:n(e)}}},Dr=Lr(function(){var t=this;return"http"===t.type()?fi(t):"function"==typeof t._viewCleanup?ii(t):pi(t)}),Or=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e?Yn(e):{},"function"==typeof t&&(t={map:t});var i=this,o=Vi.resolve().then(function(){return mi(i,t,e)});return wr(o,n),o},Mr={query:Or,viewCleanup:Dr},Ar=1,Br="pouchdb",Ir=5,Ur=0;xi.prototype.writeCheckpoint=function(t,e){var n=this;return this.updateTarget(t,e).then(function(){return n.updateSource(t,e)})},xi.prototype.updateTarget=function(t,e){return Li(this.target,this.id,t,e,this.returnValue)},xi.prototype.updateSource=function(t,e){var n=this;return this.readOnlySource?Vi.resolve(!0):Li(this.src,this.id,t,e,this.returnValue).catch(function(t){if(Ti(t))return n.readOnlySource=!0,!0;throw t})};var jr={undefined:function(t,e){return 0===wn(t.last_seq,e.last_seq)?e.last_seq:0},1:function(t,e){return Ei(e,t).last_seq}};xi.prototype.getCheckpoint=function(){var t=this;return t.target.get(t.id).then(function(e){return t.readOnlySource?Vi.resolve(e.last_seq):t.src.get(t.id).then(function(t){if(e.version!==t.version)return Ur;var n;return n=e.version?e.version.toString():"undefined",n in jr?jr[n](e,t):Ur},function(n){if(404===n.status&&e.last_seq)return t.src.put({_id:t.id,last_seq:Ur}).then(function(){return Ur},function(n){return Ti(n)?(t.readOnlySource=!0,e.last_seq):Ur});throw n})}).catch(function(t){if(404!==t.status)throw t;return Ur})};var zr=0;Zi(Mi,qi.EventEmitter),Mi.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Mi.prototype.ready=function(t,e){function n(){o.cancel()}function i(){t.removeListener("destroyed",n),e.removeListener("destroyed",n)}var o=this;o._readyCalled||(o._readyCalled=!0,t.once("destroyed",n),e.once("destroyed",n),o.once("complete",i))},Zi(Ui,qi.EventEmitter),Ui.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},kt.plugin(Ce).plugin(Ye).plugin(gn).plugin(Mr).plugin(ji),t.exports=kt}).call(e,function(){return this}())},function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 63"><path d="M19.35 54.22s-4.298-3.144-.991-8.932c3.307-5.787 2.976-10.582 1.984-12.566s-.661-6.118 5.622-5.125c6.283.993 4.133-3.472 8.102-1.984 3.968 1.488 2.812 5.787 8.928 8.267 6.117 2.48-.331 12.731.66 16.038.993 3.31 4.136 5.457 3.805 8.93-.332 3.473-6.283 6.447-10.581 1.324-4.3-5.127-.166-10.089-4.96-11.412-4.797-1.322-5.623 9.427-12.568 5.46zM1.495 32.557S.007 34.541.834 35.864c.827 1.322 1.323 4.96 1.819 5.787.496.828 3.472 2.315 5.456 2.315 1.984 0 3.14.661 4.794.165 1.654-.496-5.291-10.747-8.101-10.58-2.811.163-1.49-1.325-3.307-.994zM6.786 4.615s-2.15-.496-2.315.827c-.13 1.038 1.654 5.125 1.488 7.771-.08 1.256 0 3.141 1.819 3.968s3.968 3.637 4.464 3.968c.496.331 3.307 4.465 4.464 4.3 1.157-.167 1.818-2.647.165-4.465s-1.654-6.613-2.976-9.424c-1.322-2.81-5.786-6.945-7.11-6.945zM31.422 21.48s1.488.495 1.984-2.48c.219-1.316.99-8.93 2.313-10.087 1.323-1.157.166-7.77-.992-8.763-1.157-.992-7.44 8.432-7.11 11.077.332 2.646 2.316.151 2.316 8.93 0 1.322 1.489 1.322 1.489 1.322zM44.152 28.59s.89-9.012.828-10.086c-.043-.739 5.29-7.275 6.283-6.944.992.331-.89 12.958-5.126 17.195-2.314 2.314-1.985-.166-1.985-.166zM49.279 40.328s-.124.84 1.32 1.322c.497.166 7.193-3.06 8.185-8.845.992-5.787.703-5.29-.08-5.043 0 0-3.287 1.323-5.105 3.968-1.82 2.645-2.973 4.605-3.494 5.788-.538 1.218-.662 1.218-.826 2.81z"/></svg>'},function(t,e){(function(){var e={}.hasOwnProperty,n=[].slice;t.exports=function(t,i){var o,r,s,a;r=[],a=[];for(o in i)e.call(i,o)&&(s=i[o],"this"!==o&&(r.push(o),a.push(s)));return Function.apply(null,n.call(r).concat([t])).apply(i.this,a)}}).call(this)},function(t,e,n){(function(t,e){!function(t,n){"use strict";function i(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return m[p]=i,f(p),p++}function o(t){delete m[t]}function r(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}function s(t){if(_)setTimeout(s,0,t);else{var e=m[t];if(e){_=!0;try{r(e)}finally{o(t),_=!1}}}}function a(){f=function(t){e.nextTick(function(){s(t)})}}function u(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}function c(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&s(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),f=function(n){t.postMessage(e+n,"*")}}function l(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;s(e)},f=function(e){t.port2.postMessage(e)}}function h(){var t=v.documentElement;f=function(e){var n=v.createElement("script");n.onreadystatechange=function(){s(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}function d(){f=function(t){setTimeout(s,0,t)}}if(!t.setImmediate){var f,p=1,m={},_=!1,v=t.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(t);g=g&&g.setTimeout?g:t,"[object process]"==={}.toString.call(t.process)?a():u()?c():t.MessageChannel?l():v&&"onreadystatechange"in v.createElement("script")?h():d(),g.setImmediate=i,g.clearImmediate=o}}("undefined"==typeof self?"undefined"==typeof t?this:t:self)}).call(e,function(){return this}(),n(9))},function(t,e,n){!function(e){t.exports=e()}(function(t){"use strict";function e(t,e){var n=t[0],i=t[1],o=t[2],r=t[3];n+=(i&o|~i&r)+e[0]-680876936|0,n=(n<<7|n>>>25)+i|0,r+=(n&i|~n&o)+e[1]-389564586|0,r=(r<<12|r>>>20)+n|0,o+=(r&n|~r&i)+e[2]+606105819|0,o=(o<<17|o>>>15)+r|0,i+=(o&r|~o&n)+e[3]-1044525330|0,i=(i<<22|i>>>10)+o|0,n+=(i&o|~i&r)+e[4]-176418897|0,n=(n<<7|n>>>25)+i|0,r+=(n&i|~n&o)+e[5]+1200080426|0,r=(r<<12|r>>>20)+n|0,o+=(r&n|~r&i)+e[6]-1473231341|0,o=(o<<17|o>>>15)+r|0,i+=(o&r|~o&n)+e[7]-45705983|0,i=(i<<22|i>>>10)+o|0,n+=(i&o|~i&r)+e[8]+1770035416|0,n=(n<<7|n>>>25)+i|0,r+=(n&i|~n&o)+e[9]-1958414417|0,r=(r<<12|r>>>20)+n|0,o+=(r&n|~r&i)+e[10]-42063|0,o=(o<<17|o>>>15)+r|0,i+=(o&r|~o&n)+e[11]-1990404162|0,i=(i<<22|i>>>10)+o|0,n+=(i&o|~i&r)+e[12]+1804603682|0,n=(n<<7|n>>>25)+i|0,r+=(n&i|~n&o)+e[13]-40341101|0,r=(r<<12|r>>>20)+n|0,o+=(r&n|~r&i)+e[14]-1502002290|0,o=(o<<17|o>>>15)+r|0,i+=(o&r|~o&n)+e[15]+1236535329|0,i=(i<<22|i>>>10)+o|0,n+=(i&r|o&~r)+e[1]-165796510|0,n=(n<<5|n>>>27)+i|0,r+=(n&o|i&~o)+e[6]-1069501632|0,r=(r<<9|r>>>23)+n|0,o+=(r&i|n&~i)+e[11]+643717713|0,o=(o<<14|o>>>18)+r|0,i+=(o&n|r&~n)+e[0]-373897302|0,i=(i<<20|i>>>12)+o|0,n+=(i&r|o&~r)+e[5]-701558691|0,n=(n<<5|n>>>27)+i|0,r+=(n&o|i&~o)+e[10]+38016083|0,r=(r<<9|r>>>23)+n|0,o+=(r&i|n&~i)+e[15]-660478335|0,o=(o<<14|o>>>18)+r|0,i+=(o&n|r&~n)+e[4]-405537848|0,i=(i<<20|i>>>12)+o|0,n+=(i&r|o&~r)+e[9]+568446438|0,n=(n<<5|n>>>27)+i|0,r+=(n&o|i&~o)+e[14]-1019803690|0,r=(r<<9|r>>>23)+n|0,o+=(r&i|n&~i)+e[3]-187363961|0,o=(o<<14|o>>>18)+r|0,i+=(o&n|r&~n)+e[8]+1163531501|0,i=(i<<20|i>>>12)+o|0,n+=(i&r|o&~r)+e[13]-1444681467|0,n=(n<<5|n>>>27)+i|0,r+=(n&o|i&~o)+e[2]-51403784|0,r=(r<<9|r>>>23)+n|0,o+=(r&i|n&~i)+e[7]+1735328473|0,o=(o<<14|o>>>18)+r|0,i+=(o&n|r&~n)+e[12]-1926607734|0,i=(i<<20|i>>>12)+o|0,n+=(i^o^r)+e[5]-378558|0,n=(n<<4|n>>>28)+i|0,r+=(n^i^o)+e[8]-2022574463|0,r=(r<<11|r>>>21)+n|0,o+=(r^n^i)+e[11]+1839030562|0,o=(o<<16|o>>>16)+r|0,i+=(o^r^n)+e[14]-35309556|0,i=(i<<23|i>>>9)+o|0,n+=(i^o^r)+e[1]-1530992060|0,n=(n<<4|n>>>28)+i|0,r+=(n^i^o)+e[4]+1272893353|0,r=(r<<11|r>>>21)+n|0,o+=(r^n^i)+e[7]-155497632|0,o=(o<<16|o>>>16)+r|0,i+=(o^r^n)+e[10]-1094730640|0,i=(i<<23|i>>>9)+o|0,n+=(i^o^r)+e[13]+681279174|0,n=(n<<4|n>>>28)+i|0,r+=(n^i^o)+e[0]-358537222|0,r=(r<<11|r>>>21)+n|0,o+=(r^n^i)+e[3]-722521979|0,o=(o<<16|o>>>16)+r|0,i+=(o^r^n)+e[6]+76029189|0,i=(i<<23|i>>>9)+o|0,n+=(i^o^r)+e[9]-640364487|0,n=(n<<4|n>>>28)+i|0,r+=(n^i^o)+e[12]-421815835|0,r=(r<<11|r>>>21)+n|0,o+=(r^n^i)+e[15]+530742520|0,o=(o<<16|o>>>16)+r|0,i+=(o^r^n)+e[2]-995338651|0,i=(i<<23|i>>>9)+o|0,n+=(o^(i|~r))+e[0]-198630844|0,n=(n<<6|n>>>26)+i|0,r+=(i^(n|~o))+e[7]+1126891415|0,r=(r<<10|r>>>22)+n|0,o+=(n^(r|~i))+e[14]-1416354905|0,o=(o<<15|o>>>17)+r|0,i+=(r^(o|~n))+e[5]-57434055|0,i=(i<<21|i>>>11)+o|0,n+=(o^(i|~r))+e[12]+1700485571|0,n=(n<<6|n>>>26)+i|0,r+=(i^(n|~o))+e[3]-1894986606|0,r=(r<<10|r>>>22)+n|0,o+=(n^(r|~i))+e[10]-1051523|0,o=(o<<15|o>>>17)+r|0,i+=(r^(o|~n))+e[1]-2054922799|0,i=(i<<21|i>>>11)+o|0,n+=(o^(i|~r))+e[8]+1873313359|0,n=(n<<6|n>>>26)+i|0,r+=(i^(n|~o))+e[15]-30611744|0,r=(r<<10|r>>>22)+n|0,o+=(n^(r|~i))+e[6]-1560198380|0,o=(o<<15|o>>>17)+r|0,i+=(r^(o|~n))+e[13]+1309151649|0,i=(i<<21|i>>>11)+o|0,n+=(o^(i|~r))+e[4]-145523070|0,n=(n<<6|n>>>26)+i|0,r+=(i^(n|~o))+e[11]-1120210379|0,r=(r<<10|r>>>22)+n|0,o+=(n^(r|~i))+e[2]+718787259|0,o=(o<<15|o>>>17)+r|0,i+=(r^(o|~n))+e[9]-343485551|0,i=(i<<21|i>>>11)+o|0,t[0]=n+t[0]|0,t[1]=i+t[1]|0,t[2]=o+t[2]|0,t[3]=r+t[3]|0}function n(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function i(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n}function o(t){var i,o,r,s,a,u,c=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=c;i+=64)e(l,n(t.substring(i-64,i)));for(t=t.substring(i-64),o=t.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<o;i+=1)r[i>>2]|=t.charCodeAt(i)<<(i%4<<3);if(r[i>>2]|=128<<(i%4<<3),i>55)for(e(l,r),i=0;i<16;i+=1)r[i]=0;return s=8*c,s=s.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,r[14]=a,r[15]=u,e(l,r),l}function r(t){var n,o,r,s,a,u,c=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)e(l,i(t.subarray(n-64,n)));for(t=n-64<c?t.subarray(n-64):new Uint8Array(0),o=t.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<o;n+=1)r[n>>2]|=t[n]<<(n%4<<3);if(r[n>>2]|=128<<(n%4<<3),n>55)for(e(l,r),n=0;n<16;n+=1)r[n]=0;return s=8*c,s=s.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,r[14]=a,r[15]=u,e(l,r),l}function s(t){var e,n="";for(e=0;e<4;e+=1)n+=m[t>>8*e+4&15]+m[t>>8*e&15];return n}function a(t){var e;for(e=0;e<t.length;e+=1)t[e]=s(t[e]);return t.join("")}function u(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function c(t,e){var n,i=t.length,o=new ArrayBuffer(i),r=new Uint8Array(o);for(n=0;n<i;n+=1)r[n]=t.charCodeAt(n);return e?r:o}function l(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function h(t,e,n){var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t)),i.set(new Uint8Array(e),t.byteLength),n?i:i.buffer}function d(t){var e,n=[],i=t.length;for(e=0;e<i-1;e+=2)n.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,n)}function f(){this.reset()}var p=function(t,e){return t+e&4294967295},m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==a(o("hello"))&&(p=function(t,e){var n=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(n>>16);return i<<16|65535&n}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function e(t,e){return t=0|t||0,t<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(n,i){var o,r,s,a,u=this.byteLength,c=e(n,u),l=u;return i!==t&&(l=e(i,u)),c>l?new ArrayBuffer(0):(o=l-c,r=new ArrayBuffer(o),s=new Uint8Array(r),a=new Uint8Array(this,c,o),s.set(a),r)}}(),f.prototype.append=function(t){return this.appendBinary(u(t)),this},f.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var i,o=this._buff.length;for(i=64;i<=o;i+=64)e(this._hash,n(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},f.prototype.end=function(t){var e,n,i=this._buff,o=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<o;e+=1)r[e>>2]|=i.charCodeAt(e)<<(e%4<<3);return this._finish(r,o),n=a(this._hash),t&&(n=d(n)),this.reset(),n},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},f.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(t,n){var i,o,r,s=n;if(t[s>>2]|=128<<(s%4<<3),s>55)for(e(this._hash,t),s=0;s<16;s+=1)t[s]=0;i=8*this._length,i=i.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),r=parseInt(i[1],16)||0,t[14]=o,t[15]=r,e(this._hash,t)},f.hash=function(t,e){return f.hashBinary(u(t),e)},f.hashBinary=function(t,e){var n=o(t),i=a(n);return e?d(i):i},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(t){var n,o=h(this._buff.buffer,t,!0),r=o.length;for(this._length+=t.byteLength,n=64;n<=r;n+=64)e(this._hash,i(o.subarray(n-64,n)));return this._buff=n-64<r?new Uint8Array(o.buffer.slice(n-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(t){var e,n,i=this._buff,o=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
for(e=0;e<o;e+=1)r[e>>2]|=i[e]<<(e%4<<3);return this._finish(r,o),n=a(this._hash),t&&(n=d(n)),this.reset(),n},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var t=f.prototype.getState.call(this);return t.buff=l(t.buff),t},f.ArrayBuffer.prototype.setState=function(t){return t.buff=c(t.buff,!0),f.prototype.setState.call(this,t)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(t,e){var n=r(new Uint8Array(t)),i=a(n);return e?d(i):i},f})},function(t,e,n){function i(t,e){this._id=t,this._clearFn=e}var o=Function.prototype.apply;e.setTimeout=function(){return new i(o.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new i(o.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(46),e.setImmediate=setImmediate,e.clearImmediate=clearImmediate},function(t,e,n){"use strict";function i(t,e){var n=t.select(function(t){return t.username===e});return n[0]}function o(t){var e=new f.User(t._id);return e.setLocation(t.location),null!=t.lastAccess&&e.setLastAccessTimestamp(new Date(t.lastAccess)),e}function r(t,e){return t.setLocation(e.location),null!=e.lastAccess?t.setLastAccessTimestamp(new Date(e.lastAccess)):t.unsetLastAccessTimestamp(),t}function s(t,e){var n=i(t,e._id);return null!=n?r(n,e):(n=o(e),t.addUser(o(e))),n}function a(){var t=this;p.allDocs({include_docs:!0}).then(function(e){for(var n=0,i=e.rows;n<i.length;n++){var r=i[n].doc;null!=r&&t.addUser(o(r))}}),p.changes({since:"now",live:!0,timeout:!1,include_docs:!0}).on("change",function(e){var n=e.doc,o=i(t,n._id);e.deleted&&null!=o?t.removeUser(o):s(t,n)}).on("error",function(t){h.show(d.trimIndent("\n      Um, it seems our connection to the database was severed!\n      Please reload to see new changes.\n    ",void 0," "),"danger")})}function u(t,e,n){var i=this;p.get(t).then(function(n){var o={_id:t,_rev:n._rev,location:e,lastAccess:n.lastAccess};return s(i,o),p.put(o)},function(n){if(404!==n.status)throw n;var o={_id:t,location:e,lastAccess:null};return s(i,o),p.put(o)}).then(n,function(){h.show(d.trimIndent("\n      Oops!  Something prevented us from sending your location to the database.\n      Do you mind trying again?\n    ",void 0," "),"danger")})}var c=n(43),l=n(15),h=n(18),d=n(10),f=n(16),p=new c("ottermap");null!=l.dbUrl&&p.sync(l.dbUrl,{live:!0,retry:!0}).on("error",function(t){h.show(d.trimIndent("\n      We have lost connection with the mothership.\n      Please reload to see new changes and upload your location.\n    ",void 0," "),"danger")}),Object.defineProperty(e,"__esModule",{value:!0}),e.default={fetchUsers:a,syncUserLocation:u}},function(t,e,n){"use strict";var i=n(8),o=n(2),r=n(4),s=11;window.addEventListener("hashchange",function(){var t=window.location.hash.slice(1);if(t){var e=i.users.select(function(e){return e.username===t})[0];null!=e&&o.default.setView(e.location,s)}});var a=window.location.hash.slice(1);a&&r.listenOnce(i.users,"useradd",function(t){var e=t.detail;e.username===a&&o.default.setView(e.location,s)})},function(t,e,n){"use strict";function i(t){return u.$sel(t,"input[name=username]").value}function o(t,e){var n=u.$sel("[name="+t+"]");n.value=localStorage[e]||"",n.addEventListener("change",function(){localStorage[e]=n.value})}var r,s=n(8),a=n(17),u=n(3),c=n(4),l=u.$id("update-form");c.listenOnce(l,"submit",function(){r=a.placeUserMarker(i(this))}),c.listenOnce(l,"submit",function(){this.addEventListener("submit",function(){var t=u.$sel(this,"button[type=submit]");u.$removeClass(t,"btn-success"),u.$addClass(t,"btn-primary"),s.syncUserLocation(i(this),r.getLatLng(),function(){u.$removeClass(t,"btn-primary"),u.$addClass(t,"btn-success")})})}),o("setting-base-tiles","last tile provider"),o("setting-overlays","overlay providers"),o("setting-marker-style-default","default marker style"),o("setting-marker-style-online","online marker style"),o("setting-marker-style-offline","offline marker style")},function(t,e,n){"use strict";function i(t){try{var e=r.tileLayer.provider(t);return d.set(e,t),e}catch(t){var n=t.toString();return n=""+n[0].toLowerCase()+n.substr(1),u.show(c.trimIndent("\n      Failed to get tile provider data: "+n+".\n      Please check your settings and reload the page.\n    ",void 0," "),"danger"),null}}function o(t){return t.replace(/\./g,": ").replace(/([a-z])([A-Z0-9])/g,"$1 $2")}var r=n(1);n(34);var s=n(37),a=n(2),u=n(18),c=n(10),l=["OpenStreetMap.Mapnik","Esri.WorldImagery","NASAGIBS.ViirsEarthAtNight2012","Stamen.Watercolor"],h="Esri.WorldImagery",d=new WeakMap;a.default.addEventListener("baselayerchange",function(t){localStorage["last tile provider"]=d.get(t.layer)});var f=localStorage["last tile provider"]||h;~l.indexOf(f)||l.push(f);for(var p=r.control.layers().addTo(a.default),m=0,_=l;m<_.length;m++){var v=_[m],g=i(v);if(g&&(p.addBaseLayer(g,o(v)),v===f)){a.default.addLayer(g);var y=g.options;a.default.setZoom(s(a.default.getZoom(),y.minZoom,y.maxZoom))}}if(localStorage["overlay providers"])for(var b=0,w=localStorage["overlay providers"].split(/\s+/);b<w.length;b++){var v=w[b],g=i(v);g&&(a.default.addLayer(g),p.addOverlay(g,o(v)))}},function(t,e,n){"use strict";function i(t,e){return'<a href="'+t+'" rel="nofollow">'+e+"</a>"}function o(t){return new l.DivIcon({html:f,iconSize:[42,44],className:t})}function r(t){var e=(n={},n["&"]="&amp;",n["<"]="&lt;",n[">"]="&gt;",n['"']="&quot;",n["'"]="&apos;",n);return t.replace(/[&<>"']/g,function(t){return e[t]});var n}function s(t){return t.trim().replace(/[-\s]+/g,"-").replace(/[^\w-]/g,"").toLowerCase()}function a(t){var e=r(t),n="http://upperattic.at/Time/api/avatar/img/"+s(t)+"/";return l.popup({closeButton:!1}).setContent(d.trimIndent('\n    <figure class="avatar">\n      <img src="'+n+'" alt="'+e+'\'s avatar">\n      <figcaption class="text-center">'+e+"</figcaption>\n    </figure>\n  "))}function u(t,e){return new l.Marker(t.location,{icon:e,title:t.username}).bindPopup(a(t.username))}function c(t){var e=u(t,m);return t.addEventListener("locationchange",function(t){var n=t.detail;e.setLatLng(n.newValue)}),t.addEventListener("statuschange",function(t){var n=t.detail;switch(n.newValue){case"online":e.setIcon(_);break;case"offline":e.setIcon(v);break;default:e.setIcon(m)}}),e}var l=n(1),h=n(2),d=n(10),f=n(44),p="Marker ([Otter Track][1])  Katie M Westbrook, [The Noun Project][2]".replace(/\[(.+?)\]\[1\]/,i("http://thenounproject.com/term/otter-track/3498/","$1")).replace(/\[(.+?)\]\[2\]/,i("http://thenounproject.com/","$1")),m=o("marker-default"),_=o("marker-online"),v=o("marker-offline");l.Icon.Default.imagePath="img",n(24),n(23),n(25),h.default.attributionControl.addAttribution(p),e.buildMemberMarker=c},function(t,e,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=n(1);n(59),n(35);var r=n(8),s=n(2),a=n(3),u=n(4),c=n(53),l=10,h=o.markerClusterGroup();s.default.addLayer(h),r.users.addEventListener("useradd",function(t){var e=t.detail,n=c.buildMemberMarker(e);h.addLayer(n),u.listenOnce(e,"unperson",function(){return h.removeLayer(n)})});var d=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.onAdd=function(){var e=t.prototype.onAdd.apply(this,arguments);e.setAttribute("aria-haspopup","true"),a.$sel(e,".search-input").type="search";var n=a.$sel(e,".search-cancel");return n.parentNode.removeChild(n),a.$sel(e,".search-button").title="Locate OTTer",e},e}(o.Control.Search);Object.defineProperty(e,"__esModule",{value:!0}),e.default=new d({layer:h,marker:!1,initial:!1,zoom:l}).addTo(s.default)},function(t,e,n){"use strict";function i(){var t=a.$id("map"),e=document.documentElement.clientHeight,n=parseInt(window.getComputedStyle(t).top,10);t.style.height=e-n+"px";var i=document.createEvent("Event");i.initEvent("resize",!1,!1),t.dispatchEvent(i)}function o(t,e){var n=s({content:a.$id(t)||void 0,closeHtml:'<button type="button" class="close">&times;</button>',width:window.innerWidth<768?window.innerWidth:600});n.afterCreate(function(){n.modalElem().firstElementChild.hidden=!1}),a.$id(e).addEventListener("click",function(){return n.show()})}for(var r=n(14),s=n(42),a=n(3),u=n(4),c=40,l=0,h=a.$all("form");l<h.length;l++){var d=h[l];d.addEventListener("submit",function(t){return t.preventDefault()})}var f=a.$id("update-form"),p=a.$sel(f,"button[type=submit]"),m=a.$sel(p,"span.button-text");m.textContent="Add yourself to the map";var _=a.$sel(p,"span.glyphicon");a.$addClass(_,"glyphicon-map-marker"),u.listenOnce(f,"submit",function(){m.textContent="Upload location",a.$toggleClass(_,"glyphicon-map-marker","glyphicon-cloud-upload");var t=a.$sel(f,"input[name=username]");a.$removeClass(t,"hidden"),t.required=!0,t.focus(),t.select(),a.$addClass(m,"hidden-xs")}),setTimeout(i,c),window.addEventListener("resize",r(i,c));var v=document.createElement("style");v.innerHTML=["default","online","offline"].filter(function(t){return localStorage[t+" marker style"]}).map(function(t){return".marker-"+t.replace(/\s/g,"")+" { "+localStorage[t+" marker style"]+" }"}).join("\n"),document.head.appendChild(v),o("about-modal","about-button"),o("settings-modal","settings-button"),u.listenOnce(a.$id("map"),"DOMSubtreeModified",function(){var t=a.$id("noscript-msg");t.parentNode.removeChild(t)})},function(t,e){"use strict";var n,i;/\bChrome\//.test(navigator.userAgent)?(n=[].unshift,i=[].pop):(n=[].push,i=[].shift);var o=function(){function t(){this.data=[]}return t.prototype.enqueue=function(t){n.call(this.data,t)},t.prototype.dequeue=function(){return i.call(this.data)},t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=o},function(t,e){"use strict";function n(t,e,n){var i=n[n.length-1];t===i.element&&(n.pop(),i=n[n.length-1]);var o=i.element,r=i.index;if(Array.isArray(o))o.push(t);else if(r===e.length-2){var s=e.pop();o[s]=t}else e.push(t)}e.stringify=function(t){var e=[];e.push({obj:t});for(var n,i,o,r,s,a,u,c,l,h,d,f="";n=e.pop();)if(i=n.obj,o=n.prefix||"",r=n.val||"",f+=o,r)f+=r;else if("object"!=typeof i)f+="undefined"==typeof i?null:JSON.stringify(i);else if(null===i)f+="null";else if(Array.isArray(i)){for(e.push({val:"]"}),s=i.length-1;s>=0;s--)a=0===s?"":",",e.push({obj:i[s],prefix:a});e.push({val:"["})}else{u=[];for(c in i)i.hasOwnProperty(c)&&u.push(c);for(e.push({val:"}"}),s=u.length-1;s>=0;s--)l=u[s],h=i[l],d=s>0?",":"",d+=JSON.stringify(l)+":",e.push({obj:h,prefix:d});e.push({val:"{"})}return f},e.parse=function(t){for(var e,i,o,r,s,a,u,c,l,h=[],d=[],f=0;;)if(e=t[f++],"}"!==e&&"]"!==e&&"undefined"!=typeof e)switch(e){case" ":case"\t":case"\n":case":":case",":break;case"n":f+=3,n(null,h,d);break;case"t":f+=3,n(!0,h,d);break;case"f":f+=4,n(!1,h,d);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(i="",f--;;){if(o=t[f++],!/[\d\.\-e\+]/.test(o)){f--;break}i+=o}n(parseFloat(i),h,d);break;case'"':for(r="",s=void 0,a=0;;){if(u=t[f++],'"'===u&&("\\"!==s||a%2!==1))break;r+=u,s=u,"\\"===s?a++:a=0}n(JSON.parse('"'+r+'"'),h,d);break;case"[":c={element:[],index:h.length},h.push(c.element),d.push(c);break;case"{":l={element:{},index:h.length},h.push(l.element),d.push(l);break;default:throw new Error("unexpectedly reached end of input: "+e)}else{if(1===h.length)return h.pop();n(h.pop(),h,d)}}},function(t,e){!function(t,e,n){"use strict";function i(){function t(t){for(var i=Object.keys(t);i.length;){var o=i.shift();if(e.style[o]!==n)return t[o]}}if(!c){c=!0;var i={animation:["animationstart","animationiteration","animationend"],webkitAnimation:["webkitAnimationStart","webkitAnimationIteration","webkitAnimationEnd"]},o={transition:"transitionend",webkitTransition:"webkitTransitionEnd"};d=t(i),d&&(l=d[0],h=d[1],d=d[2]),f=t(o)}}function o(t,e,n){return t.addEventListener(e,n,!1),!0}function r(t,e,n){return t.removeEventListener(e,n,!1),!0}function s(t,e){var i=e[p];return i!==n&&w[t][i]!==n&&i}function a(t,e,n){n=n||s(t,e),n!==!1&&(delete w[t][n],delete e[p],e.className=(" "+e.className+" ").replace(" "+m+" "," ").trim())}function u(t,n,i,r,u){if(!t)return setTimeout(function(){r(i,u)});w[n]||(w[n]={},o(e,t,function(t){if(t.target){var e=t.target,i=s(n,e);if(i!==!1){var o=w[n][i];a(n,e,i),o[0](e,o[1])}}})),a(n,i);for(var c;!c||w[n][c];)for(c="";c.length<g;)c+=String.fromCharCode(Math.floor(Math.random()*(b-y))+y);i[p]=c,w[n][c]=[r,u],i.className=i.className.trim()+" "+m}var c,l,h,d,f,p="picohCSSAnimID",m="cssanimactive",_=0,v=1,g=3,y=97,b=122,w=[n,n];t.CSSAnimEvent={animationSupport:function(){return i(),!!d},transitionSupport:function(){return i(),!!f},addAnimationStart:function(t,e){return i(),!!l&&o(t,l,e)},removeAnimationStart:function(t,e){return i(),!!l&&r(t,l,e)},addAnimationIteration:function(t,e){return i(),!!h&&o(t,h,e)},removeAnimationIteration:function(t,e){return i(),!!h&&r(t,h,e)},addAnimationEnd:function(t,e){return i(),!!d&&o(t,d,e)},removeAnimationEnd:function(t,e){return i(),!!d&&r(t,d,e)},addTransitionEnd:function(t,e){return i(),!!f&&o(t,f,e)},removeTransitionEnd:function(t,e){return i(),!!f&&r(t,f,e)},onAnimationEnd:function(t,e,n){i(),u(d,_,t,e,n)},cancelAnimationEnd:function(t){a(_,t)},onTransitionEnd:function(t,e,n){i(),u(f,v,t,e,n)},cancelTransitionEnd:function(t){a(v,t)}}}(window,document.documentElement)},function(t,e){!function(t,e,n){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[];var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this;if(!this._map)return this._needsClustering.push(t),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,n=this._zoom;if(t.__parent)for(;e.__parent._zoom>=n;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off("move",this._childMarkerMoved,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push(t),this):(this._nonPointGroup.removeLayer(t),this)},addLayers:function(t){if(!L.Util.isArray(t))return this.addLayer(t);var e,n=this._featureGroup,i=this._nonPointGroup,o=this.options.chunkedLoading,r=this.options.chunkInterval,s=this.options.chunkProgress,a=t.length,u=0,c=!0;if(this._map){var l=(new Date).getTime(),h=L.bind(function(){for(var d=(new Date).getTime();u<a;u++){if(o&&u%200===0){var f=(new Date).getTime()-d;if(f>r)break}if(e=t[u],e instanceof L.LayerGroup)c&&(t=t.slice(),c=!1),this._extractNonGroupLayers(e,t),a=t.length;else if(e.getLatLng){if(!this.hasLayer(e)&&(this._addLayer(e,this._maxZoom),e.__parent&&2===e.__parent.getChildCount())){var p=e.__parent.getAllChildMarkers(),m=p[0]===e?p[1]:p[0];n.removeLayer(m)}}else i.addLayer(e)}s&&s(u,a,(new Date).getTime()-l),u===a?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(h,this.options.chunkDelay)},this);h()}else for(var d=this._needsClustering;u<a;u++)e=t[u],e instanceof L.LayerGroup?(c&&(t=t.slice(),c=!1),this._extractNonGroupLayers(e,t),a=t.length):e.getLatLng?this.hasLayer(e)||d.push(e):i.addLayer(e);return this},removeLayers:function(t){var e,n,i=t.length,o=this._featureGroup,r=this._nonPointGroup,s=!0;if(!this._map){for(e=0;e<i;e++)n=t[e],n instanceof L.LayerGroup?(s&&(t=t.slice(),s=!1),this._extractNonGroupLayers(n,t),i=t.length):(this._arraySplice(this._needsClustering,n),r.removeLayer(n),this.hasLayer(n)&&this._needsRemoving.push(n));return this}if(this._unspiderfy){this._unspiderfy();var a=t.slice(),u=i;for(e=0;e<u;e++)n=a[e],n instanceof L.LayerGroup?(this._extractNonGroupLayers(n,a),u=a.length):this._unspiderfyLayer(n)}for(e=0;e<i;e++)n=t[e],n instanceof L.LayerGroup?(s&&(t=t.slice(),s=!1),this._extractNonGroupLayers(n,t),i=t.length):n.__parent?(this._removeLayer(n,!0,!0),o.hasLayer(n)&&(o.removeLayer(n),n.clusterShow&&n.clusterShow())):r.removeLayer(n);return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off("move",this._childMarkerMoved,this),delete t.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var n,i=this._needsClustering.slice(),o=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(i),n=i.length-1;n>=0;n--)o.indexOf(i[n])===-1&&t.call(e,i[n]);this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(n){L.stamp(n)===t&&(e=n)}),e},hasLayer:function(t){if(!t)return!1;var e,n=this._needsClustering;for(e=n.length-1;e>=0;e--)if(n[e]===t)return!0;for(n=this._needsRemoving,e=n.length-1;e>=0;e--)if(n[e]===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){"function"!=typeof e&&(e=function(){});var n=function(){!t._icon&&!t.__parent._icon||this._inZoomAnimation||(this._map.off("moveend",n,this),this.off("animationend",n,this),t._icon?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};if(t._icon&&this._map.getBounds().contains(t.getLatLng()))e();else if(t.__parent._zoom<Math.round(this._map._zoom))this._map.on("moveend",n,this),this._map.panTo(t.getLatLng());else{var i=function(){this._map.off("movestart",i,this),i=null};this._map.on("movestart",i,this),this._map.on("moveend",n,this),this.on("animationend",n,this),t.__parent.zoomToBounds(),i&&n.call(this)}},onAdd:function(t){this._map=t;var e,n,i;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,n=this._needsRemoving.length;e<n;e++)i=this._needsRemoving[e],this._removeLayer(i,!0);this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),n=this._needsClustering,this._needsClustering=[],this.addLayers(n)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var n=t.length-1;n>=0;n--)if(t[n]===e)return t.splice(n,1),!0},_removeFromGridUnclustered:function(t,e){for(var n=this._map,i=this._gridUnclustered;e>=0&&i[e].removeObject(t,n.project(t.getLatLng(),e));e--);},_childMarkerMoved:function(t){this._ignoreMove||(t.target._latlng=t.oldLatLng,this.removeLayer(t.target),t.target._latlng=t.latlng,this.addLayer(t.target))},_removeLayer:function(t,e,n){var i=this._gridClusters,o=this._gridUnclustered,r=this._featureGroup,s=this._map;e&&this._removeFromGridUnclustered(t,this._maxZoom);var a,u=t.__parent,c=u._markers;for(this._arraySplice(c,t);u&&(u._childCount--,u._boundsNeedUpdate=!0,!(u._zoom<0));)e&&u._childCount<=1?(a=u._markers[0]===t?u._markers[1]:u._markers[0],i[u._zoom].removeObject(u,s.project(u._cLatLng,u._zoom)),o[u._zoom].addObject(a,s.project(a.getLatLng(),u._zoom)),this._arraySplice(u.__parent._childClusters,u),u.__parent._markers.push(a),a.__parent=u.__parent,u._icon&&(r.removeLayer(u),n||r.addLayer(a))):u._iconNeedsUpdate=!0,u=u.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,n){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,n)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),n=" marker-cluster-";return n+=e<10?"small":e<100?"medium":"large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick;(e||i)&&this.on("clusterclick",this._zoomOrSpiderfy,this),n&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){for(var e=t.layer,n=e;1===n._childClusters.length;)n=n._childClusters[0];n._zoom===this._maxZoom&&n._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),t.originalEvent&&13===t.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,i=this._map;(t||n)&&this.off("clusterclick",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),i.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=this._map.getMaxZoom(),e=this.options.maxClusterRadius,n=e;"function"!=typeof e&&(n=function(){return e}),this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var i=t;i>=0;i--)this._gridClusters[i]=new L.DistanceGrid(n(i)),this._gridUnclustered[i]=new L.DistanceGrid(n(i));this._topClusterLevel=new this._markerCluster(this,-1)},_addLayer:function(t,e){var n,i,o=this._gridClusters,r=this._gridUnclustered;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on("move",this._childMarkerMoved,this);e>=0;e--){n=this._map.project(t.getLatLng(),e);var s=o[e].getNearObject(n);if(s)return s._addChild(t),void(t.__parent=s);if(s=r[e].getNearObject(n)){var a=s.__parent;a&&this._removeLayer(s,!1);var u=new this._markerCluster(this,e,s,t);o[e].addObject(u,this._map.project(u._cLatLng,e)),s.__parent=u,t.__parent=u;var c=u;for(i=e-1;i>a._zoom;i--)c=new this._markerCluster(this,i,c),o[i].addObject(c,this._map.project(s.getLatLng(),i));return a._addChild(c),void this._removeFromGridUnclustered(s,e)}r[e].addObject(t,n)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(t){var e=this._maxLat;return e!==n&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-(1/0))),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var n=e.getAllChildMarkers();this._featureGroup.removeLayer(n[0]),this._featureGroup.removeLayer(n[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var n,i=t.getLayers(),o=0;for(e=e||[];o<i.length;o++)n=i[o],n instanceof L.LayerGroup?this._extractNonGroupLayers(n,e):e.push(n);return e},_overrideMarkerIcon:function(t){var e=t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}});return e}}),L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-(1/0),-(1/0)),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var n,i=this._getExpandedVisibleBounds(),o=this._featureGroup;this._ignoreMove=!0,this._topClusterLevel._recursively(i,t,0,function(r){var s,a=r._latlng,u=r._markers;for(i.contains(a)||(a=null),r._isSingleParent()&&t+1===e?(o.removeLayer(r),r._recursivelyAddChildrenToMap(null,e,i)):(r.clusterHide(),r._recursivelyAddChildrenToMap(a,e,i)),n=u.length-1;n>=0;n--)s=u[n],i.contains(s._latlng)||o.removeLayer(s)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(i,e),o.eachLayer(function(t){t instanceof L.MarkerCluster||!t._icon||t.clusterShow()}),this._topClusterLevel._recursively(i,t,e,function(t){t._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(i,t,0,function(t){o.removeLayer(t),t.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var n=this,i=this._featureGroup;i.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){i.removeLayer(t),t.clusterShow(),n._animationEnd()})):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,n){var i=this._getExpandedVisibleBounds();t._recursivelyAnimateChildrenInAndAddSelfToMap(i,e+1,n);var o=this;this._forceLayout(),t._recursivelyBecomeVisible(i,n),this._enqueue(function(){if(1===t._childCount){var r=t._markers[0];this._ignoreMove=!0,r.setLatLng(r.getLatLng()),this._ignoreMove=!1,r.clusterShow&&r.clusterShow()}else t._recursively(i,n,0,function(t){t._recursivelyRemoveChildrenFromMap(i,e+1)});o._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(e.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)},L.MarkerCluster=L.Marker.extend({initialize:function(t,e,n,i){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),i&&this._addChild(i)},getAllChildMarkers:function(t){t=t||[];for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e].getAllChildMarkers(t);
for(var n=this._markers.length-1;n>=0;n--)t.push(this._markers[n]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var t,e=this._childClusters.slice(),n=this._group._map,i=n.getBoundsZoom(this._bounds),o=this._zoom+1,r=n.getZoom();e.length>0&&i>o;){o++;var s=[];for(t=0;t<e.length;t++)s=s.concat(e[t]._childClusters);e=s}i>o?this._group._map.setView(this._latlng,o):i<=r?this._group._map.setView(this._latlng,r+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-(1/0),t._northEast.lng=-(1/0))},_recalculateBounds:function(){var t,e,n,i,o=this._markers,r=this._childClusters,s=0,a=0,u=this._childCount;if(0!==u){for(this._resetBounds(),t=0;t<o.length;t++)n=o[t]._latlng,this._bounds.extend(n),s+=n.lat,a+=n.lng;for(t=0;t<r.length;t++)e=r[t],e._boundsNeedUpdate&&e._recalculateBounds(),this._bounds.extend(e._bounds),n=e._wLatLng,i=e._childCount,s+=n.lat*i,a+=n.lng*i;this._latlng=this._wLatLng=new L.LatLng(s/u,a/u),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,n){this._recursively(t,0,n-1,function(t){var n,i,o=t._markers;for(n=o.length-1;n>=0;n--)i=o[n],i._icon&&(i._setPos(e),i.clusterHide())},function(t){var n,i,o=t._childClusters;for(n=o.length-1;n>=0;n--)i=o[n],i._icon&&(i._setPos(e),i.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,n){this._recursively(t,n,0,function(i){i._recursivelyAnimateChildrenIn(t,i._group._map.latLngToLayerPoint(i.getLatLng()).round(),e),i._isSingleParent()&&e-1===n?(i.clusterShow(),i._recursivelyRemoveChildrenFromMap(t,e)):i.clusterHide(),i._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,0,e,null,function(t){t.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,n){this._recursively(n,-1,e,function(i){if(e!==i._zoom)for(var o=i._markers.length-1;o>=0;o--){var r=i._markers[o];n.contains(r._latlng)&&(t&&(r._backupLatlng=r.getLatLng(),r.setLatLng(t),r.clusterHide&&r.clusterHide()),i._group._featureGroup.addLayer(r))}},function(e){e._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var n=this._markers[e];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(t-1===this._zoom)for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i]._restorePosition();else for(var o=this._childClusters.length-1;o>=0;o--)this._childClusters[o]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,n){var i,o;this._recursively(t,-1,e-1,function(t){for(o=t._markers.length-1;o>=0;o--)i=t._markers[o],n&&n.contains(i._latlng)||(t._group._featureGroup.removeLayer(i),i.clusterShow&&i.clusterShow())},function(t){for(o=t._childClusters.length-1;o>=0;o--)i=t._childClusters[o],n&&n.contains(i._latlng)||(t._group._featureGroup.removeLayer(i),i.clusterShow&&i.clusterShow())})},_recursively:function(t,e,n,i,o){var r,s,a=this._childClusters,u=this._zoom;if(e<=u&&(i&&i(this),o&&u===n&&o(this)),u<e||u<n)for(r=a.length-1;r>=0;r--)s=a[r],t.intersects(s._bounds)&&s._recursively(t,e,n,i,o)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.Marker.include({clusterHide:function(){return this.options.opacityWhenUnclustered=this.options.opacity||1,this.setOpacity(0)},clusterShow:function(){var t=this.setOpacity(this.options.opacity||this.options.opacityWhenUnclustered);return delete this.options.opacityWhenUnclustered,t}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var n=this._getCoord(e.x),i=this._getCoord(e.y),o=this._grid,r=o[i]=o[i]||{},s=r[n]=r[n]||[],a=L.Util.stamp(t);this._objectPoint[a]=e,s.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var n,i,o=this._getCoord(e.x),r=this._getCoord(e.y),s=this._grid,a=s[r]=s[r]||{},u=a[o]=a[o]||[];for(delete this._objectPoint[L.Util.stamp(t)],n=0,i=u.length;n<i;n++)if(u[n]===t)return u.splice(n,1),1===i&&delete a[o],!0},eachObject:function(t,e){var n,i,o,r,s,a,u,c=this._grid;for(n in c){s=c[n];for(i in s)for(a=s[i],o=0,r=a.length;o<r;o++)u=t.call(e,a[o]),u&&(o--,r--)}},getNearObject:function(t){var e,n,i,o,r,s,a,u,c=this._getCoord(t.x),l=this._getCoord(t.y),h=this._objectPoint,d=this._sqCellSize,f=null;for(e=l-1;e<=l+1;e++)if(o=this._grid[e])for(n=c-1;n<=c+1;n++)if(r=o[n])for(i=0,s=r.length;i<s;i++)a=r[i],u=this._sqDist(h[L.Util.stamp(a)],t),u<d&&(d=u,f=a);return f},_getCoord:function(t){return Math.floor(t/this._cellSize)},_sqDist:function(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}},function(){L.QuickHull={getDistant:function(t,e){var n=e[1].lat-e[0].lat,i=e[0].lng-e[1].lng;return i*(t.lat-e[0].lat)+n*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var n,i,o,r=0,s=null,a=[];for(n=e.length-1;n>=0;n--)i=e[n],o=this.getDistant(i,t),o>0&&(a.push(i),o>r&&(r=o,s=i));return{maxPoint:s,newPoints:a}},buildConvexHull:function(t,e){var n=[],i=this.findMostDistantPointFromBaseLine(t,e);return i.maxPoint?(n=n.concat(this.buildConvexHull([t[0],i.maxPoint],i.newPoints)),n=n.concat(this.buildConvexHull([i.maxPoint,t[1]],i.newPoints))):[t[0]]},getConvexHull:function(t){var e,n=!1,i=!1,o=!1,r=!1,s=null,a=null,u=null,c=null,l=null,h=null;for(e=t.length-1;e>=0;e--){var d=t[e];(n===!1||d.lat>n)&&(s=d,n=d.lat),(i===!1||d.lat<i)&&(a=d,i=d.lat),(o===!1||d.lng>o)&&(u=d,o=d.lng),(r===!1||d.lng<r)&&(c=d,r=d.lng)}i!==n?(h=a,l=s):(h=c,l=u);var f=[].concat(this.buildConvexHull([h,l],t),this.buildConvexHull([l,h],t));return f}}}(),L.MarkerCluster.include({getConvexHull:function(){var t,e,n=this.getAllChildMarkers(),i=[];for(e=n.length-1;e>=0;e--)t=n[e].getLatLng(),i.push(t);return L.QuickHull.getConvexHull(i)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(),n=this._group,i=n._map,o=i.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,o):(o.y+=10,t=this._generatePointsCircle(e.length,o)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var n,i,o=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),r=o/this._2PI,s=this._2PI/t,a=[];for(a.length=t,n=t-1;n>=0;n--)i=this._circleStartAngle+n*s,a[n]=new L.Point(e.x+r*Math.cos(i),e.y+r*Math.sin(i))._round();return a},_generatePointsSpiral:function(t,e){var n,i=this._group.options.spiderfyDistanceMultiplier,o=i*this._spiralLengthStart,r=i*this._spiralFootSeparation,s=i*this._spiralLengthFactor*this._2PI,a=0,u=[];for(u.length=t,n=t-1;n>=0;n--)a+=r/o+5e-4*n,u[n]=new L.Point(e.x+o*Math.cos(a),e.y+o*Math.sin(a))._round(),o+=s/a;return u},_noanimationUnspiderfy:function(){var t,e,n=this._group,i=n._map,o=n._featureGroup,r=this.getAllChildMarkers();for(n._ignoreMove=!0,this.setOpacity(1),e=r.length-1;e>=0;e--)t=r[e],o.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(i.removeLayer(t._spiderLeg),delete t._spiderLeg);n.fire("unspiderfied",{cluster:this,markers:r}),n._ignoreMove=!1,n._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var n,i,o,r,s=this._group,a=s._map,u=s._featureGroup,c=this._group.options.spiderLegPolylineOptions;for(s._ignoreMove=!0,n=0;n<t.length;n++)r=a.layerPointToLatLng(e[n]),i=t[n],o=new L.Polyline([this._latlng,r],c),a.addLayer(o),i._spiderLeg=o,i._preSpiderfyLatlng=i._latlng,i.setLatLng(r),i.setZIndexOffset&&i.setZIndexOffset(1e6),u.addLayer(i);this.setOpacity(.3),s._ignoreMove=!1,s.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var i,o,r,s,a,u,c=this,l=this._group,h=l._map,d=l._featureGroup,f=this._latlng,p=h.latLngToLayerPoint(f),m=L.Path.SVG,_=L.extend({},this._group.options.spiderLegPolylineOptions),v=_.opacity;for(v===n&&(v=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),m?(_.opacity=0,_.className=(_.className||"")+" leaflet-cluster-spider-leg"):_.opacity=v,l._ignoreMove=!0,i=0;i<t.length;i++)o=t[i],u=h.layerPointToLatLng(e[i]),r=new L.Polyline([f,u],_),h.addLayer(r),o._spiderLeg=r,m&&(s=r._path,a=s.getTotalLength()+.1,s.style.strokeDasharray=a,s.style.strokeDashoffset=a),o.setZIndexOffset&&o.setZIndexOffset(1e6),o.clusterHide&&o.clusterHide(),d.addLayer(o),o._setPos&&o._setPos(p);for(l._forceLayout(),l._animationStart(),i=t.length-1;i>=0;i--)u=h.layerPointToLatLng(e[i]),o=t[i],o._preSpiderfyLatlng=o._latlng,o.setLatLng(u),o.clusterShow&&o.clusterShow(),m&&(r=o._spiderLeg,s=r._path,s.style.strokeDashoffset=0,r.setStyle({opacity:v}));this.setOpacity(.3),l._ignoreMove=!1,setTimeout(function(){l._animationEnd(),l.fire("spiderfied",{cluster:c,markers:t})},200)},_animationUnspiderfy:function(t){var e,n,i,o,r,s,a=this,u=this._group,c=u._map,l=u._featureGroup,h=t?c._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):c.latLngToLayerPoint(this._latlng),d=this.getAllChildMarkers(),f=L.Path.SVG;for(u._ignoreMove=!0,u._animationStart(),this.setOpacity(1),n=d.length-1;n>=0;n--)e=d[n],e._preSpiderfyLatlng&&(e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,s=!0,e._setPos&&(e._setPos(h),s=!1),e.clusterHide&&(e.clusterHide(),s=!1),s&&l.removeLayer(e),f&&(i=e._spiderLeg,o=i._path,r=o.getTotalLength()+.1,o.style.strokeDashoffset=r,i.setStyle({opacity:0})));u._ignoreMove=!1,setTimeout(function(){var t=0;for(n=d.length-1;n>=0;n--)e=d[n],e._spiderLeg&&t++;for(n=d.length-1;n>=0;n--)e=d[n],e._spiderLeg&&(e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),t>1&&l.removeLayer(e),c.removeLayer(e._spiderLeg),delete e._spiderLeg);u._animationEnd(),u.fire("unspiderfied",{cluster:a,markers:d})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}})}(window,document)}]);